{"remainingRequest":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/node_modules/babel-loader/lib/index.js!/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/src/lib/neat.js","dependencies":[{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/src/lib/neat.js","mtime":1766857470851},{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/babel.config.js","mtime":1766857498915},{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/node_modules/cache-loader/dist/cjs.js","mtime":1766857611540},{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/node_modules/babel-loader/lib/index.js","mtime":1766857611782}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCi8qZ2xvYmFscyBwYXBlciwgJCAqLwovKmpzbGludCBub21lbjogdHJ1ZSwgdW5kZWY6IHRydWUsIHNsb3BweTogdHJ1ZSAqLwoKLy8gbmV0d29yayBhcnQgbGlicmFyeQoKLyoNCg0KQGxpY3N0YXJ0ICBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQ0KSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZS4NCg0KQ29weXJpZ2h0IChDKSAyMDE1IGRhdmlkIGhhLCBvdG9yby5uZXQsIG90b3JvIGxhYnMNCg0KVGhlIEphdmFTY3JpcHQgY29kZSBpbiB0aGlzIHBhZ2UgaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbg0KcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUNCkdlbmVyYWwgUHVibGljIExpY2Vuc2UgKEdOVSBHUEwpIGFzIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZQ0KRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKQ0KYW55IGxhdGVyIHZlcnNpb24uICBUaGUgY29kZSBpcyBkaXN0cmlidXRlZCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsNCndpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUw0KRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZSBHTlUgR1BMIGZvciBtb3JlIGRldGFpbHMuDQoNCkFzIGFkZGl0aW9uYWwgcGVybWlzc2lvbiB1bmRlciBHTlUgR1BMIHZlcnNpb24gMyBzZWN0aW9uIDcsIHlvdQ0KbWF5IGRpc3RyaWJ1dGUgbm9uLXNvdXJjZSAoZS5nLiwgbWluaW1pemVkIG9yIGNvbXBhY3RlZCkgZm9ybXMgb2YNCnRoYXQgY29kZSB3aXRob3V0IHRoZSBjb3B5IG9mIHRoZSBHTlUgR1BMIG5vcm1hbGx5IHJlcXVpcmVkIGJ5DQpzZWN0aW9uIDQsIHByb3ZpZGVkIHlvdSBpbmNsdWRlIHRoaXMgbGljZW5zZSBub3RpY2UgYW5kIGEgVVJMDQp0aHJvdWdoIHdoaWNoIHJlY2lwaWVudHMgY2FuIGFjY2VzcyB0aGUgQ29ycmVzcG9uZGluZyBTb3VyY2UuDQoNCg0KQGxpY2VuZCAgVGhlIGFib3ZlIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UNCmZvciB0aGUgSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZS4NCiovCgovLyBpbXBsZW1lbnRhdGlvbiBvZiBuZWF0IGFsZ29yaXRobSB3aXRoIHJlY3VycmVudC5qcyBncmFwaHMgdG8gc3VwcG9ydCBiYWNrcHJvcAovLyB1c2VkIGZvciBnZW5ldGljIGFydC4KLy8gY29kZSBpcyBub3QgbW9kdWxhciBvciBvb3AsIGFkIGRvbmUgaW4gYSBmb3J0cmFuL3NjaWVudGlmaWMgY29tcHV0aW5nIHN0eWxlCi8vIGFwb2xvZ2llcyBpbiBhZHZhbmNlIGlmIHRoYXQgYWluJ3QgdXIgdGFzdGUuCmlmICh0eXBlb2YgbW9kdWxlICE9ICJ1bmRlZmluZWQiKSB7CiAgdmFyIFIgPSByZXF1aXJlKCcuL3JlY3VycmVudC5qcycpOwogIC8vdmFyIE5ldEFydCA9IHJlcXVpcmUoJy4vbmV0YXJ0LmpzJyk7Cn0KdmFyIE4gPSB7fTsKCi8vKGZ1bmN0aW9uKGdsb2JhbCkgewoidXNlIHN0cmljdCI7CgovLyBVdGlsaXR5IGZ1bgpmdW5jdGlvbiBhc3NlcnQoY29uZGl0aW9uLCBtZXNzYWdlKSB7CiAgLy8gZnJvbSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE1MzEzNDE4L2phdmFzY3JpcHQtYXNzZXJ0CiAgaWYgKCFjb25kaXRpb24pIHsKICAgIG1lc3NhZ2UgPSBtZXNzYWdlIHx8ICJBc3NlcnRpb24gZmFpbGVkIjsKICAgIGlmICh0eXBlb2YgRXJyb3IgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgIH0KICAgIHRocm93IG1lc3NhZ2U7IC8vIEZhbGxiYWNrCiAgfQp9CgovLyBjb25zdGFudHMKdmFyIE5PREVfSU5QVVQgPSAwOwp2YXIgTk9ERV9PVVRQVVQgPSAxOwp2YXIgTk9ERV9CSUFTID0gMjsKLy8gaGlkZGVuIGxheWVycwp2YXIgTk9ERV9TSUdNT0lEID0gMzsKdmFyIE5PREVfVEFOSCA9IDQ7CnZhciBOT0RFX1JFTFUgPSA1Owp2YXIgTk9ERV9HQVVTU0lBTiA9IDY7CnZhciBOT0RFX1NJTiA9IDc7CnZhciBOT0RFX0NPUyA9IDg7CnZhciBOT0RFX0FCUyA9IDk7CnZhciBOT0RFX01VTFQgPSAxMDsKdmFyIE5PREVfQUREID0gMTE7CnZhciBOT0RFX01HQVVTU0lBTiA9IDEyOyAvLyBtdWx0aS1kaW0gZ2F1c3NpYW4gKGRvIGdhdXNzaWFuIHRvIGVhY2ggaW5wdXQgdGhlbiBtdWx0KQp2YXIgTk9ERV9TUVVBUkUgPSAxMzsKdmFyIE5PREVfSU5JVCA9IE5PREVfQUREOwp2YXIgTUFYX1RJQ0sgPSAxMDA7CnZhciBvcGVyYXRvcnMgPSBbbnVsbCwgbnVsbCwgbnVsbCwgJ3NpZ21vaWQnLCAndGFuaCcsICdyZWx1JywgJ2dhdXNzaWFuJywgJ3NpbicsICdjb3MnLCAnYWJzJywgJ211bHQnLCAnYWRkJywgJ211bHQnLCAnYWRkJ107CgovLyBmb3IgY29ubmVjdGlvbnMKdmFyIElEWF9DT05ORUNUSU9OID0gMDsKdmFyIElEWF9XRUlHSFQgPSAxOwp2YXIgSURYX0FDVElWRSA9IDI7CgovL3ZhciBhY3RpdmF0aW9ucyA9IFtOT0RFX1NJR01PSUQsIE5PREVfVEFOSCwgTk9ERV9SRUxVLCBOT0RFX0dBVVNTSUFOLCBOT0RFX1NJTiwgTk9ERV9DT1MsIE5PREVfTVVMVCwgTk9ERV9BQlMsIE5PREVfQURELCBOT0RFX01HQVVTU0lBTiwgTk9ERV9TUVVBUkVdOwp2YXIgYWN0aXZhdGlvbnMgPSBbTk9ERV9TSUdNT0lELCBOT0RFX1RBTkgsIE5PREVfUkVMVSwgTk9ERV9HQVVTU0lBTiwgTk9ERV9TSU4sIE5PREVfQ09TLCBOT0RFX0FERF07CnZhciBnZXRSYW5kb21BY3RpdmF0aW9uID0gZnVuY3Rpb24gKCkgewogIHZhciBpeCA9IFIucmFuZGkoMCwgYWN0aXZhdGlvbnMubGVuZ3RoKTsKICByZXR1cm4gYWN0aXZhdGlvbnNbaXhdOwp9Owp2YXIgZ2lkID0gMDsKdmFyIGdldEdJRCA9IGZ1bmN0aW9uICgpIHsKICB2YXIgcmVzdWx0ID0gZ2lkOwogIGdpZCArPSAxOwogIHJldHVybiByZXN1bHQ7Cn07CnZhciBub2RlcyA9IFtdOyAvLyB0aGlzIGFycmF5IGhvbGRzIGFsbCBub2Rlcwp2YXIgY29ubmVjdGlvbnMgPSBbXTsgLy8gaW5kZXggb2YgY29ubmVjdGlvbnMgaGVyZSBpcyB0aGUgJ2lubm92YXRpb24nIHZhbHVlCgp2YXIgY29weUFycmF5ID0gZnVuY3Rpb24gKHgpIHsKICAvLyByZXR1cm5zIGEgY29weSBvZiBmbG9hdEFycmF5CiAgdmFyIG4gPSB4Lmxlbmd0aDsKICB2YXIgcmVzdWx0ID0gbmV3IEFycmF5KG4pOwogIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICByZXN1bHRbaV0gPSB4W2ldOwogIH0KICByZXR1cm4gcmVzdWx0Owp9OwpmdW5jdGlvbiBjb3B5Q29ubmVjdGlvbnMobmV3QykgewogIHZhciBpLCBuOwogIG4gPSBuZXdDLmxlbmd0aDsKICB2YXIgY29weUMgPSBbXTsKICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAvLyBjb25uZWN0cyBpbnB1dCBhbmQgYmlhcyB0byBpbml0IGR1bW15IG5vZGUKICAgIGNvcHlDLnB1c2goW25ld0NbaV1bMF0sIG5ld0NbaV1bMV1dKTsKICB9CiAgcmV0dXJuIGNvcHlDOwp9CnZhciBnZXROb2RlcyA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gY29weUFycmF5KG5vZGVzKTsKfTsKdmFyIGdldENvbm5lY3Rpb25zID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBjb3B5Q29ubmVjdGlvbnMoY29ubmVjdGlvbnMpOwp9Owp2YXIgbklucHV0ID0gMTsKdmFyIG5PdXRwdXQgPSAxOwp2YXIgb3V0cHV0SW5kZXggPSAyOyAvLyBbYmlhcywgaW5wdXQsIG91dHB1dF0KdmFyIGluaXROb2RlcyA9IFtdOwp2YXIgaW5pdE11ID0gMC4wLAogIGluaXRTdGRldiA9IDEuMDsgLy8gcmFuZG9taXNlZCBwYXJhbSBpbml0aWFsaXNhdGlvbi4KdmFyIG11dGF0aW9uUmF0ZSA9IDAuMjsKdmFyIG11dGF0aW9uU2l6ZSA9IDAuNTsKZnVuY3Rpb24gZ2V0UmFuZG9tUmVuZGVyTW9kZSgpIHsKICAvLyBtb3JlIGNoYW5jZSB0byBiZSAwICgxLzIpLCBhbmQgdGhlbiAxLzMgdG8gYmUgMSwgYW5kIDEvNiB0byBiZSAyCiAgdmFyIHogPSBSLnJhbmRpKDAsIDYpOwogIGlmICh6IDwgMykgcmV0dXJuIDA7CiAgaWYgKHogPCA1KSByZXR1cm4gMTsKICByZXR1cm4gMjsKfQp2YXIgcmVuZGVyTW9kZSA9IGdldFJhbmRvbVJlbmRlck1vZGUoKTsgLy8gMCA9IHNpZ21vaWQgKDEgPSBnYXVzc2lhbiwgMiA9IHRhbmgrYWJzCgp2YXIgcmFuZG9taXplUmVuZGVyTW9kZSA9IGZ1bmN0aW9uICgpIHsKICByZW5kZXJNb2RlID0gZ2V0UmFuZG9tUmVuZGVyTW9kZSgpOwogIGNvbnNvbGUubG9nKCdyZW5kZXIgbW9kZSA9ICcgKyByZW5kZXJNb2RlKTsKfTsKdmFyIHNldFJlbmRlck1vZGUgPSBmdW5jdGlvbiAock1vZGUpIHsKICByZW5kZXJNb2RlID0gck1vZGU7Cn07CnZhciBnZXRSZW5kZXJNb2RlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiByZW5kZXJNb2RlOwp9OwpmdW5jdGlvbiBnZXRPcHRpb24ob3B0LCBpbmRleCwgb3JpZykgewogIGlmIChvcHQgJiYgdHlwZW9mIG9wdFtpbmRleF0gIT09ICJ1bmRlZmluZWQiKSB7CiAgICByZXR1cm4gb3B0W2luZGV4XTsKICB9CiAgcmV0dXJuIG9yaWc7Cn0KdmFyIGluaXQgPSBmdW5jdGlvbiAob3B0KSB7CiAgdmFyIGksIGo7CiAgbklucHV0ID0gZ2V0T3B0aW9uKG9wdCwgJ25JbnB1dCcsIG5JbnB1dCk7CiAgbk91dHB1dCA9IGdldE9wdGlvbihvcHQsICduT3V0cHV0Jywgbk91dHB1dCk7CiAgb3V0cHV0SW5kZXggPSBuSW5wdXQgKyAxOyAvLyBpbmRleCBvZiBvdXRwdXQgc3RhcnQgKGJpYXMgc28gYWRkIDEpCiAgLy8gaW5pdGlhbGlzZSBub2RlcwogIGZvciAoaSA9IDA7IGkgPCBuSW5wdXQ7IGkrKykgewogICAgbm9kZXMucHVzaChOT0RFX0lOUFVUKTsKICB9CiAgbm9kZXMucHVzaChOT0RFX0JJQVMpOwogIGZvciAoaSA9IDA7IGkgPCBuT3V0cHV0OyBpKyspIHsKICAgIG5vZGVzLnB1c2goTk9ERV9PVVRQVVQpOwogIH0KICAvLyBpbml0aWFsaXNlIGNvbm5lY3Rpb25zLiBhdCBiZWdpbm5pbmcgb25seSBjb25uZWN0IGlucHV0cyB0byBvdXRwdXRzCiAgLy8gaW5pdGlhbGx5LCBiaWFzIGhhcyBubyBjb25uZWN0aW9ucyBhbmQgdGhhdCBtdXN0IGJlIGdyb3duLgoKICAvKg0KICAgICAgZm9yIChqPTA7ajxuT3V0cHV0O2orKykgew0KICAgICAgICBmb3IgKGk9MDtpPG5JbnB1dCsxO2krKykgew0KICAgICAgICAgIGNvbm5lY3Rpb25zLnB1c2goW2ksIG91dHB1dEluZGV4K2pdKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAqLwoKICAvLyBwdXNoIGluaXRpYWwgZHVtbXkgbm9kZQogIG5vZGVzLnB1c2goTk9ERV9BREQpOwogIHZhciBkdW1teUluZGV4ID0gbm9kZXMubGVuZ3RoIC0gMTsKICBmb3IgKGkgPSAwOyBpIDwgbklucHV0ICsgMTsgaSsrKSB7CiAgICAvLyBjb25uZWN0cyBpbnB1dCBhbmQgYmlhcyB0byBpbml0IGR1bW15IG5vZGUKICAgIGNvbm5lY3Rpb25zLnB1c2goW2ksIGR1bW15SW5kZXhdKTsKICB9CiAgZm9yIChpID0gMDsgaSA8IG5PdXRwdXQ7IGkrKykgewogICAgLy8gY29ubmVjdHMgZHVtbXkgbm9kZSB0byBvdXRwdXQKICAgIGNvbm5lY3Rpb25zLnB1c2goW2R1bW15SW5kZXgsIG91dHB1dEluZGV4ICsgaV0pOwogIH0KfTsKZnVuY3Rpb24gZ2V0Tm9kZUxpc3Qobm9kZV90eXBlKSB7CiAgLy8gcmV0dXJucyBhIGxpc3Qgb2YgbG9jYXRpb25zIChpbmRleCBvZiBnbG9iYWwgbm9kZSBhcnJheSkgY29udGFpbmluZwogIC8vIHdoZXJlIGFsbCB0aGUgb3V0cHV0IG5vZGVzIGFyZQogIHZhciBpLCBuOwogIHZhciByZXN1bHQgPSBbXTsKICBmb3IgKGkgPSAwLCBuID0gbm9kZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICBpZiAobm9kZXNbaV0gPT09IG5vZGVfdHlwZSkgewogICAgICByZXN1bHQucHVzaChpKTsKICAgIH0KICB9CiAgcmV0dXJuIHJlc3VsdDsKfQp2YXIgR2Vub21lID0gZnVuY3Rpb24gKGluaXRHZW5vbWUpIHsKICB2YXIgaSwgajsKICB2YXIgbjsKICB2YXIgYzsgLy8gY29ubmVjdGlvbiBzdG9yYWdlLgoKICB0aGlzLmNvbm5lY3Rpb25zID0gW107CiAgLy8gY3JlYXRlIG9yIGNvcHkgaW5pdGlhbCBjb25uZWN0aW9ucwogIGlmIChpbml0R2Vub21lICYmIHR5cGVvZiBpbml0R2Vub21lLmNvbm5lY3Rpb25zICE9PSAidW5kZWZpbmVkIikgewogICAgZm9yIChpID0gMCwgbiA9IGluaXRHZW5vbWUuY29ubmVjdGlvbnMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIHRoaXMuY29ubmVjdGlvbnMucHVzaChSLmNvcHkoaW5pdEdlbm9tZS5jb25uZWN0aW9uc1tpXSkpOwogICAgfQogIH0gZWxzZSB7CiAgICAvKg0KICAgICAgICAgIC8vIGNvcHkgb3ZlciBpbml0aWFsIGNvbm5lY3Rpb25zIChuSW5wdXQgKyBjb25uZWN0QmlhcykgKiBuT3V0cHV0DQogICAgICAgICAgZm9yIChpPTAsbj0obklucHV0KzEpKm5PdXRwdXQ7aTxuO2krKykgew0KICAgICAgICAgICAgYyA9IFIuemVyb3MoMyk7IC8vIGlubm92YXRpb24gbnVtYmVyLCB3ZWlnaHQsIGVuYWJsZWQgKDEpDQogICAgICAgICAgICBjW0lEWF9DT05ORUNUSU9OXSA9IGk7DQogICAgICAgICAgICBjW0lEWF9XRUlHSFRdID0gUi5yYW5kbihpbml0TXUsIGluaXRTdGRldik7DQogICAgICAgICAgICBjW0lEWF9BQ1RJVkVdID0gMTsNCiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbnMucHVzaChjKTsNCiAgICAgICAgICB9DQogICAgKi8KCiAgICBmb3IgKGkgPSAwLCBuID0gbklucHV0ICsgMSArIG5PdXRwdXQ7IGkgPCBuOyBpKyspIHsKICAgICAgYyA9IFIuemVyb3MoMyk7IC8vIGlubm92YXRpb24gbnVtYmVyLCB3ZWlnaHQsIGVuYWJsZWQgKDEpCiAgICAgIGNbSURYX0NPTk5FQ1RJT05dID0gaTsKICAgICAgLy8gdGhlIGJlbG93IGxpbmUgYXNzaWducyAxIHRvIGluaXRpYWwgd2VpZ2h0cyBmcm9tIGR1bW15IG5vZGUgdG8gb3V0cHV0CiAgICAgIGNbSURYX1dFSUdIVF0gPSBpIDwgbklucHV0ICsgMSA/IFIucmFuZG4oaW5pdE11LCBpbml0U3RkZXYpIDogMS4wOwogICAgICAvL2NbSURYX1dFSUdIVF0gPSBSLnJhbmRuKGluaXRNdSwgaW5pdFN0ZGV2KTsKICAgICAgY1tJRFhfQUNUSVZFXSA9IDE7CiAgICAgIHRoaXMuY29ubmVjdGlvbnMucHVzaChjKTsKICAgIH0KICB9Cn07Ckdlbm9tZS5wcm90b3R5cGUgPSB7CiAgY29weTogZnVuY3Rpb24gKCkgewogICAgLy8gbWFrZXMgYSBjb3B5IG9mIGl0c2VsZiBhbmQgcmV0dXJuIGl0IChyZXR1cm5zIGEgR2Vub21lIGNsYXNzKQogICAgcmV0dXJuIG5ldyBHZW5vbWUodGhpcyk7CiAgfSwKICBpbXBvcnRDb25uZWN0aW9uczogZnVuY3Rpb24gKGNBcnJheSkgewogICAgdmFyIGksIG47CiAgICB0aGlzLmNvbm5lY3Rpb25zID0gW107CiAgICB2YXIgdGVtcDsKICAgIGZvciAoaSA9IDAsIG4gPSBjQXJyYXkubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIHRlbXAgPSBuZXcgUi56ZXJvcygzKTsKICAgICAgdGVtcFswXSA9IGNBcnJheVtpXVswXTsKICAgICAgdGVtcFsxXSA9IGNBcnJheVtpXVsxXTsKICAgICAgdGVtcFsyXSA9IGNBcnJheVtpXVsyXTsKICAgICAgdGhpcy5jb25uZWN0aW9ucy5wdXNoKHRlbXApOwogICAgfQogIH0sCiAgbXV0YXRlV2VpZ2h0czogZnVuY3Rpb24gKG11dGF0aW9uUmF0ZV8sIG11dGF0aW9uU2l6ZV8pIHsKICAgIC8vIG11dGF0ZXMgZWFjaCB3ZWlnaHQgb2YgY3VycmVudCBnZW5vbWUgd2l0aCBhIHByb2JhYmlsaXR5IG9mIG11dGF0aW9uUmF0ZQogICAgLy8gYnkgYWRkaW5nIGEgZ2F1c3NpYW4gbm9pc2Ugb2YgemVybyBtZWFuIGFuZCBtdXRhdGlvblNpemUgc3RkZXYgdG8gaXQKICAgIHZhciBtUmF0ZSA9IG11dGF0aW9uUmF0ZV8gfHwgbXV0YXRpb25SYXRlOwogICAgdmFyIG1TaXplID0gbXV0YXRpb25TaXplXyB8fCBtdXRhdGlvblNpemU7CiAgICB2YXIgaSwgbjsKICAgIGZvciAoaSA9IDAsIG4gPSB0aGlzLmNvbm5lY3Rpb25zLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IG1SYXRlKSB7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uc1tpXVtJRFhfV0VJR0hUXSArPSBSLnJhbmRuKDAsIG1TaXplKTsKICAgICAgfQogICAgfQogIH0sCiAgYWRkUmFuZG9tTm9kZTogZnVuY3Rpb24gKCkgewogICAgLy8gYWRkcyBhIG5ldyByYW5kb20gbm9kZSBhbmQgYXNzaWducyBpdCBhIHJhbmRvbSBhY3RpdmF0aW9uIGdhdGUKICAgIHZhciBjID0gUi5yYW5kaSgwLCB0aGlzLmNvbm5lY3Rpb25zLmxlbmd0aCk7IC8vIGNob29zZSByYW5kb20gY29ubmVjdGlvbgogICAgdmFyIHcgPSB0aGlzLmNvbm5lY3Rpb25zW2NdWzFdOyAvL3dlaWdodD8KCiAgICB0aGlzLmNvbm5lY3Rpb25zW2NdWzJdID0gMDsgLy8gZGlzYWJsZSB0aGUgY29ubmVjdGlvbgogICAgdmFyIG5vZGVJbmRleCA9IG5vZGVzLmxlbmd0aDsKICAgIG5vZGVzLnB1c2goZ2V0UmFuZG9tQWN0aXZhdGlvbigpKTsgLy8gY3JlYXRlIHRoZSBuZXcgbm9kZSBnbG9iYWxseQoKICAgIHZhciBpbm5vdmF0aW9uTnVtID0gdGhpcy5jb25uZWN0aW9uc1tjXVswXTsgLy9qdXN0IHRoZSBpbmRleAogICAgdmFyIGZyb21Ob2RlSW5kZXggPSBjb25uZWN0aW9uc1tpbm5vdmF0aW9uTnVtXVswXTsKICAgIHZhciB0b05vZGVJbmRleCA9IGNvbm5lY3Rpb25zW2lubm92YXRpb25OdW1dWzFdOwogICAgdmFyIGNvbm5lY3Rpb25JbmRleCA9IGNvbm5lY3Rpb25zLmxlbmd0aDsKICAgIC8vIG1ha2UgMiBuZXcgY29ubmVjdGlvbiBnbG9iYWxseQogICAgY29ubmVjdGlvbnMucHVzaChbZnJvbU5vZGVJbmRleCwgbm9kZUluZGV4XSk7CiAgICBjb25uZWN0aW9ucy5wdXNoKFtub2RlSW5kZXgsIHRvTm9kZUluZGV4XSk7CgogICAgLy8gcHV0IGluIHRoaXMgbm9kZSBsb2NhbGx5IGludG8gZ2Vub21lCiAgICB2YXIgYzEgPSBSLnplcm9zKDMpOwogICAgYzFbSURYX0NPTk5FQ1RJT05dID0gY29ubmVjdGlvbkluZGV4OwogICAgYzFbSURYX1dFSUdIVF0gPSAxLjA7IC8vIHVzZSAxLjAgYXMgZmlyc3QgY29ubmVjdGlvbiB3ZWlnaHQKICAgIGMxW0lEWF9BQ1RJVkVdID0gMTsKICAgIHZhciBjMiA9IFIuemVyb3MoMyk7CiAgICBjMltJRFhfQ09OTkVDVElPTl0gPSBjb25uZWN0aW9uSW5kZXggKyAxOwogICAgYzJbSURYX1dFSUdIVF0gPSB3OyAvLyB1c2Ugb2xkIHdlaWdodCBmb3IgMm5kIGNvbm5lY3Rpb24KICAgIGMyW0lEWF9BQ1RJVkVdID0gMTsKICAgIHRoaXMuY29ubmVjdGlvbnMucHVzaChjMSk7CiAgICB0aGlzLmNvbm5lY3Rpb25zLnB1c2goYzIpOwogIH0sCiAgYWRkUmFuZG9tQ29ubmVjdGlvbjogZnVuY3Rpb24gKCkgewogICAgLy8gYXR0ZW1wdHMgdG8gYWRkIGEgcmFuZG9tIGNvbm5lY3Rpb24uCiAgICAvLyBpZiBjb25uZWN0aW9uIGV4aXN0cywgdGhlbiBkb2VzIG5vdGhpbmcgKGFoIHdlbGwpCgogICAgdmFyIGksIG4sIGNvbm5lY3Rpb25JbmRleCwgbm9kZUluZGV4OwogICAgdmFyIG5vZGVzSW5Vc2VGbGFnID0gUi56ZXJvcyhub2Rlcy5sZW5ndGgpOwogICAgdmFyIG5vZGVzSW5Vc2UgPSBbXTsKICAgIGZvciAoaSA9IDAsIG4gPSB0aGlzLmNvbm5lY3Rpb25zLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICBjb25uZWN0aW9uSW5kZXggPSB0aGlzLmNvbm5lY3Rpb25zW2ldWzBdOwogICAgICBub2RlSW5kZXggPSBjb25uZWN0aW9uc1tjb25uZWN0aW9uSW5kZXhdWzBdOwogICAgICBub2Rlc0luVXNlRmxhZ1tub2RlSW5kZXhdID0gMTsKICAgICAgbm9kZUluZGV4ID0gY29ubmVjdGlvbnNbY29ubmVjdGlvbkluZGV4XVsxXTsKICAgICAgbm9kZXNJblVzZUZsYWdbbm9kZUluZGV4XSA9IDE7CiAgICB9CiAgICBmb3IgKGkgPSAwLCBuID0gbm9kZXMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIGlmIChub2Rlc0luVXNlRmxhZ1tpXSA9PT0gMSkgewogICAgICAgIG5vZGVzSW5Vc2UucHVzaChpKTsKICAgICAgfQogICAgfQoKICAgIC8vdmFyIGZyb21Ob2RlSW5kZXggPSBSLnJhbmRpKDAsIG5vZGVzLmxlbmd0aCk7CiAgICAvL3ZhciB0b05vZGVJbmRleCA9IFIucmFuZGkob3V0cHV0SW5kZXgsIG5vZGVzLmxlbmd0aCk7IC8vIGluY2x1ZGVzIGJpYXMuCgogICAgdmFyIGZyb21Ob2RlSW5kZXggPSBub2Rlc0luVXNlW1IucmFuZGkoMCwgbm9kZXNJblVzZS5sZW5ndGgpXTsgLy9yYW5kb20gbm9kZXMKICAgIHZhciB0b05vZGVJbmRleCA9IG5vZGVzSW5Vc2VbUi5yYW5kaShvdXRwdXRJbmRleCwgbm9kZXNJblVzZS5sZW5ndGgpXTsKICAgIHZhciBmcm9tTm9kZVVzZWQgPSBmYWxzZTsKICAgIHZhciB0b05vZGVVc2VkID0gZmFsc2U7CiAgICBpZiAoZnJvbU5vZGVJbmRleCA9PT0gdG9Ob2RlSW5kZXgpIHJldHVybjsgLy8gY2FuJ3QgYmUgdGhlIHNhbWUgaW5kZXguCiAgICAvLyBjYW5ub3QgbG9vcCBiYWNrIG91dCBmcm9tIHRoZSBvdXRwdXQuCiAgICBpZiAoZnJvbU5vZGVJbmRleCA+PSBvdXRwdXRJbmRleCAmJiBmcm9tTm9kZUluZGV4IDwgb3V0cHV0SW5kZXggKyBuT3V0cHV0KSByZXR1cm47CgogICAgLy8gdGhlIGJlbG93IHNldCBvZiBjb2RlIHdpbGwgdGVzdCBpZiBzZWxlY3RlZCBub2RlcyBhcmUgYWN0dWFsbHkgdXNlZCBpbiBuZXR3b3JrIGNvbm5lY3Rpb25zCiAgICBmb3IgKGkgPSAwLCBuID0gdGhpcy5jb25uZWN0aW9ucy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgY29ubmVjdGlvbkluZGV4ID0gdGhpcy5jb25uZWN0aW9uc1tpXVswXTsKICAgICAgaWYgKGNvbm5lY3Rpb25zW2Nvbm5lY3Rpb25JbmRleF1bMF0gPT09IGZyb21Ob2RlSW5kZXggfHwgY29ubmVjdGlvbnNbY29ubmVjdGlvbkluZGV4XVsxXSA9PT0gZnJvbU5vZGVJbmRleCkgewogICAgICAgIGZyb21Ob2RlVXNlZCA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGZvciAoaSA9IDAsIG4gPSB0aGlzLmNvbm5lY3Rpb25zLmxlbmd0aDsgaSA8IG47IGkrKykgewogICAgICBjb25uZWN0aW9uSW5kZXggPSB0aGlzLmNvbm5lY3Rpb25zW2ldWzBdOwogICAgICBpZiAoY29ubmVjdGlvbnNbY29ubmVjdGlvbkluZGV4XVswXSA9PT0gdG9Ob2RlSW5kZXggfHwgY29ubmVjdGlvbnNbY29ubmVjdGlvbkluZGV4XVsxXSA9PT0gdG9Ob2RlSW5kZXgpIHsKICAgICAgICB0b05vZGVVc2VkID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKCFmcm9tTm9kZVVzZWQgfHwgIXRvTm9kZVVzZWQpIHJldHVybjsgLy8gb25seSBjb25zaWRlciBjb25uZWN0aW9ucyBpbiBjdXJyZW50IG5ldC4KCiAgICB2YXIgc2VhcmNoSW5kZXggPSAtMTsgLy8gc2VlIGlmIGNvbm5lY3Rpb24gYWxyZWFkeSBleGlzdC4KICAgIGZvciAoaSA9IDAsIG4gPSBjb25uZWN0aW9ucy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgaWYgKGNvbm5lY3Rpb25zW2ldWzBdID09PSBmcm9tTm9kZUluZGV4ICYmIGNvbm5lY3Rpb25zW2ldWzFdID09PSB0b05vZGVJbmRleCkgewogICAgICAgIHNlYXJjaEluZGV4ID0gaTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKHNlYXJjaEluZGV4IDwgMCkgewogICAgICAvLyBncmVhdCwgdGhpcyBjb25uZWN0aW9uIGRvZXNuJ3QgZXhpc3QgeWV0IQogICAgICBjb25uZWN0aW9uSW5kZXggPSBjb25uZWN0aW9ucy5sZW5ndGg7CiAgICAgIGNvbm5lY3Rpb25zLnB1c2goW2Zyb21Ob2RlSW5kZXgsIHRvTm9kZUluZGV4XSk7CiAgICAgIHZhciBjID0gUi56ZXJvcygzKTsgLy8gaW5ub3ZhdGlvbiBudW1iZXIsIHdlaWdodCwgZW5hYmxlZCAoMSkKICAgICAgY1tJRFhfQ09OTkVDVElPTl0gPSBjb25uZWN0aW9uSW5kZXg7CiAgICAgIGNbSURYX1dFSUdIVF0gPSBSLnJhbmRuKGluaXRNdSwgaW5pdFN0ZGV2KTsKICAgICAgY1tJRFhfQUNUSVZFXSA9IDE7CiAgICAgIHRoaXMuY29ubmVjdGlvbnMucHVzaChjKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBjb25uZWN0aW9uSXNJbkdlbm9tZSA9IGZhbHNlOwogICAgICBmb3IgKGkgPSAwLCBuID0gdGhpcy5jb25uZWN0aW9ucy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uc1tpXVtJRFhfQ09OTkVDVElPTl0gPT09IHNlYXJjaEluZGV4KSB7CiAgICAgICAgICAvLyBlbmFibGUgYmFjayB0aGUgaW5kZXggKGlmIG5vdCBlbmFibGVkKQogICAgICAgICAgdGhpcy5jb25uZWN0aW9uc1tpXVtJRFhfQUNUSVZFXSA9IDE7CiAgICAgICAgICBjb25uZWN0aW9uSXNJbkdlbm9tZSA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFjb25uZWN0aW9uSXNJbkdlbm9tZSkgewogICAgICAgIC8vIGV2ZW4gdGhvdWdoIGNvbm5lY3Rpb24gZXhpc3RzIGdsb2JhbGx5LCBpdCBpc24ndCBpbiB0aGlzIGdlbmUuCiAgICAgICAgLy9jb25zb2xlLmxvZygnZXZlbiB0aG91Z2ggY29ubmVjdGlvbiBleGlzdHMgZ2xvYmFsbHksIGl0IGlzbnQgaW4gdGhpcyBnZW5lLicpOwogICAgICAgIHZhciBjMSA9IFIuemVyb3MoMyk7IC8vIGlubm92YXRpb24gbnVtYmVyLCB3ZWlnaHQsIGVuYWJsZWQgKDEpCiAgICAgICAgYzFbSURYX0NPTk5FQ1RJT05dID0gc2VhcmNoSW5kZXg7CiAgICAgICAgYzFbSURYX1dFSUdIVF0gPSBSLnJhbmRuKGluaXRNdSwgaW5pdFN0ZGV2KTsKICAgICAgICBjMVtJRFhfQUNUSVZFXSA9IDE7CiAgICAgICAgdGhpcy5jb25uZWN0aW9ucy5wdXNoKGMxKTsKICAgICAgICAvL2NvbnNvbGUubG9nKCdhZGRlZCBjb25uZWN0aW9uIHRoYXQgZXhpc3RzIHNvbWV3aGVyZSBlbHNlIGJ1dCBub3QgaGVyZS4nKTsKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlVW5yb2xsZWRDb25uZWN0aW9uczogZnVuY3Rpb24gKCkgewogICAgLy8gY3JlYXRlIGEgbGFyZ2UgYXJyYXkgdGhhdCBpcyB0aGUgc2l6ZSBvZiBHZW5vbWUuY29ubmVjdGlvbnMKICAgIC8vIGVsZW1lbnQ6CiAgICAvLyAwOiAxIG9yIDAsIHdoZXRoZXIgdGhpcyBjb25uZWN0aW9uIGV4aXN0cyBpbiB0aGlzIGdlbm9tZSBvciBub3QKICAgIC8vIDE6IHdlaWdodAogICAgLy8gMjogYWN0aXZlPyAoMSBvciAwKQogICAgdmFyIGksIG4sIG0sIGNJbmRleCwgYzsKICAgIHRoaXMudW5yb2xsZWRDb25uZWN0aW9ucyA9IFtdOwogICAgbiA9IGNvbm5lY3Rpb25zLmxlbmd0aDsgLy8gZ2xvYmFsIGNvbm5lY3Rpb24gbGVuZ3RoCiAgICBtID0gdGhpcy5jb25uZWN0aW9ucy5sZW5ndGg7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgIHRoaXMudW5yb2xsZWRDb25uZWN0aW9ucy5wdXNoKFIuemVyb3MoMykpOwogICAgfQogICAgZm9yIChpID0gMDsgaSA8IG07IGkrKykgewogICAgICBjID0gdGhpcy5jb25uZWN0aW9uc1tpXTsKICAgICAgY0luZGV4ID0gY1tJRFhfQ09OTkVDVElPTl07CiAgICAgIHRoaXMudW5yb2xsZWRDb25uZWN0aW9uc1tjSW5kZXhdW0lEWF9DT05ORUNUSU9OXSA9IDE7CiAgICAgIHRoaXMudW5yb2xsZWRDb25uZWN0aW9uc1tjSW5kZXhdW0lEWF9XRUlHSFRdID0gY1tJRFhfV0VJR0hUXTsKICAgICAgdGhpcy51bnJvbGxlZENvbm5lY3Rpb25zW2NJbmRleF1bSURYX0FDVElWRV0gPSBjW0lEWF9BQ1RJVkVdOwogICAgfQogIH0sCiAgY3Jvc3NvdmVyOiBmdW5jdGlvbiAodGhhdCkgewogICAgLy8gaW5wdXQgaXMgYW5vdGhlciBnZW5vbWUgLy9kZWFyIGZ1Y2sgd2h5IGlzIGl0IGNhbGxlZCAndGhhdCcKICAgIC8vIHJldHVybnMgYSBuZXdseSBjcmVhdGUgZ2Vub21lIHRoYXQgaXMgdGhlIG9mZnNwcmluZy4KICAgIHZhciBpLCBuLCBjOwogICAgdmFyIGNoaWxkID0gbmV3IEdlbm9tZSgpOwogICAgY2hpbGQuY29ubmVjdGlvbnMgPSBbXTsgLy8gZW1wdHkgaW5pdGlhbCBjb25uZWN0aW9ucwogICAgdmFyIGc7CiAgICB2YXIgY291bnQ7CiAgICBuID0gY29ubmVjdGlvbnMubGVuZ3RoOwogICAgdGhpcy5jcmVhdGVVbnJvbGxlZENvbm5lY3Rpb25zKCk7CiAgICB0aGF0LmNyZWF0ZVVucm9sbGVkQ29ubmVjdGlvbnMoKTsKCiAgICAvL2EgZ2Vub21lIGNvbnNpc3RzIG9mIGp1c3QgY29ubmVjdGlvbnMgPz8/CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgIC8vbG9vcHMgdGhyb3VnaCBhbGwgY29ubmVjdGlvbnMKICAgICAgY291bnQgPSAwOwogICAgICBnID0gdGhpczsgLy9vbWcKICAgICAgaWYgKHRoaXMudW5yb2xsZWRDb25uZWN0aW9uc1tpXVtJRFhfQ09OTkVDVElPTl0gPT09IDEpIHsKICAgICAgICAvL2NoZWNrcyBpZiB0aGUgY29ubmVjdGlvbiBpcyBhY3RpdmUgaW4gdGhlIHBhcmVudCBnZW5vbWUKICAgICAgICBjb3VudCsrOwogICAgICB9CiAgICAgIGlmICh0aGF0LnVucm9sbGVkQ29ubmVjdGlvbnNbaV1bSURYX0NPTk5FQ1RJT05dID09PSAxKSB7CiAgICAgICAgLy9jaGVja3MgaWYgaXRzIGFjdGl2ZSBpbiB0aGUgb3RoZXIgcGFyZW50CiAgICAgICAgZyA9IHRoYXQ7CiAgICAgICAgY291bnQrKzsKICAgICAgfQogICAgICBpZiAoY291bnQgPT09IDIgJiYgTWF0aC5yYW5kb20oKSA8IDAuNSkgewogICAgICAgIC8vaWYgYm90aCBjb25uZWN0aW9ucyBhcmUgYWN0aXZlIGNob29zZXMgb25lIGF0IHJhbmRvbQogICAgICAgIGcgPSB0aGlzOwogICAgICB9CiAgICAgIGlmIChjb3VudCA9PT0gMCkgY29udGludWU7IC8vIGJvdGggZ2Vub21lIGRvZXNuJ3QgY29udGFpbiB0aGlzIGNvbm5lY3Rpb24KICAgICAgYyA9IFIuemVyb3MoMyk7CiAgICAgIGNbSURYX0NPTk5FQ1RJT05dID0gaTsKICAgICAgY1tJRFhfV0VJR0hUXSA9IGcudW5yb2xsZWRDb25uZWN0aW9uc1tpXVtJRFhfV0VJR0hUXTsKICAgICAgLy8gaW4gdGhlIGZvbGxvd2luZyBsaW5lLCB0aGUgY29ubmVjdGlvbiBpcyBkaXNhYmxlZCBvbmx5IG9mIGl0IGlzIGRpc2FibGVkIG9uIGJvdGggcGFyZW50cwogICAgICBjW0lEWF9BQ1RJVkVdID0gMTsKICAgICAgaWYgKHRoaXMudW5yb2xsZWRDb25uZWN0aW9uc1tpXVtJRFhfQUNUSVZFXSA9PT0gMCAmJiB0aGF0LnVucm9sbGVkQ29ubmVjdGlvbnNbaV1bSURYX0FDVElWRV0gPT09IDApIHsKICAgICAgICBjW0lEWF9BQ1RJVkVdID0gMDsKICAgICAgfQogICAgICBjaGlsZC5jb25uZWN0aW9ucy5wdXNoKGMpOwogICAgfQogICAgcmV0dXJuIGNoaWxkOwogIH0sCiAgc2V0dXBNb2RlbDogZnVuY3Rpb24gKGlucHV0RGVwdGgpIHsKICAgIC8vIHNldHVwIHJlY3VycmVudC5qcyBtb2RlbAogICAgdmFyIGk7CiAgICB2YXIgbk5vZGVzID0gbm9kZXMubGVuZ3RoOwogICAgdmFyIG5Db25uZWN0aW9ucyA9IGNvbm5lY3Rpb25zLmxlbmd0aDsKICAgIHRoaXMuY3JlYXRlVW5yb2xsZWRDb25uZWN0aW9ucygpOwogICAgdGhpcy5tb2RlbCA9IFtdOwogICAgdmFyIG5vZGVNb2RlbCA9IFtdOwogICAgdmFyIGNvbm5lY3Rpb25Nb2RlbCA9IFtdOwogICAgdmFyIGM7CiAgICBmb3IgKGkgPSAwOyBpIDwgbk5vZGVzOyBpKyspIHsKICAgICAgbm9kZU1vZGVsLnB1c2gobmV3IFIuTWF0KGlucHV0RGVwdGgsIDEpKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBuQ29ubmVjdGlvbnM7IGkrKykgewogICAgICBjID0gbmV3IFIuTWF0KDEsIDEpOwogICAgICBjLndbMF0gPSB0aGlzLnVucm9sbGVkQ29ubmVjdGlvbnNbaV1bSURYX1dFSUdIVF07CiAgICAgIGNvbm5lY3Rpb25Nb2RlbC5wdXNoKGMpOwogICAgfQogICAgdGhpcy5tb2RlbC5ub2RlcyA9IG5vZGVNb2RlbDsKICAgIHRoaXMubW9kZWwuY29ubmVjdGlvbnMgPSBjb25uZWN0aW9uTW9kZWw7CiAgfSwKICB6ZXJvT3V0Tm9kZXM6IGZ1bmN0aW9uICgpIHsKICAgIFIuemVyb091dE1vZGVsKHRoaXMubW9kZWwubm9kZXMpOwogIH0sCiAgc2V0SW5wdXQ6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgLy8gaW5wdXQgaXMgYW4gbiB4IGQgUi5tYXQsIHdoZXJlIG4gaXMgdGhlIGlucHV0RGVwdGgsIGFuZCBkIGlzIG51bWJlciBvZiBpbnB1dHMKICAgIC8vIGZvciBnZW5lcmF0aXZlIGFydCwgZCBpcyB0eXBpY2FsbHkganVzdCAoeCwgeSkKICAgIC8vIGFsc28gc2V0cyBhbGwgdGhlIGJpYXNlcyB0byBiZSAxLjAKICAgIC8vIHJ1biB0aGlzIGZ1bmN0aW9uIF9hZnRlcl8gc2V0dXBNb2RlbCgpIGlzIGNhbGxlZCEKICAgIHZhciBpLCBqOwogICAgdmFyIG4gPSBpbnB1dC5uOyAvL3Jvd3MKICAgIHZhciBkID0gaW5wdXQuZDsgLy9jb2x1bW5zCiAgICB2YXIgaW5wdXROb2RlTGlzdCA9IGdldE5vZGVMaXN0KE5PREVfSU5QVVQpOyAvL2xpc3Qgb2Ygbm9kZXMgd2l0aCB0eXBlIDAKICAgIHZhciBiaWFzTm9kZUxpc3QgPSBnZXROb2RlTGlzdChOT0RFX0JJQVMpOyAvL2xpc3Qgb2Ygbm9kZXMgd2l0aCB0eXBlIDIKICAgIHZhciBkQmlhcyA9IGJpYXNOb2RlTGlzdC5sZW5ndGg7CgogICAgLy9SLmFzc2VydChpbnB1dE5vZGVMaXN0Lmxlbmd0aCA9PT0gZCk7ICAgLy90aGlzIGZhaWxzIGJ1dC4uLiBzZWVtcyB0byBiZSB3b3JraW5nIHdpdGhvdXQgaXQKICAgIFIuYXNzZXJ0KHRoaXMubW9kZWwubm9kZXNbMF0ubiA9PT0gbik7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCBkOyBqKyspIHsKICAgICAgICB0aGlzLm1vZGVsLm5vZGVzW2lucHV0Tm9kZUxpc3Rbal1dLnNldChpLCAwLCBpbnB1dC5nZXQoaSwgaikpOwogICAgICB9CiAgICAgIGZvciAoaiA9IDA7IGogPCBkQmlhczsgaisrKSB7CiAgICAgICAgdGhpcy5tb2RlbC5ub2Rlc1tiaWFzTm9kZUxpc3Rbal1dLnNldChpLCAwLCAxLjApOwogICAgICB9CiAgICB9CiAgfSwKICBnZXRPdXRwdXQ6IGZ1bmN0aW9uICgpIHsKICAgIC8vIHJldHVybnMgYW4gYXJyYXkgb2YgcmVjdXJyZW50LmpzIE1hdCdzIHJlcHJlc2VudGluZyB0aGUgb3V0cHV0CiAgICB2YXIgaTsKICAgIHZhciBvdXRwdXROb2RlTGlzdCA9IGdldE5vZGVMaXN0KE5PREVfT1VUUFVUKTsKICAgIHZhciBkID0gb3V0cHV0Tm9kZUxpc3QubGVuZ3RoOwogICAgdmFyIG91dHB1dCA9IFtdOwogICAgZm9yIChpID0gMDsgaSA8IGQ7IGkrKykgewogICAgICBvdXRwdXQucHVzaCh0aGlzLm1vZGVsLm5vZGVzW291dHB1dE5vZGVMaXN0W2ldXSk7CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH0sCiAgcm91bmRXZWlnaHRzOiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgcHJlY2lzaW9uID0gMTAwMDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29ubmVjdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgdGhpcy5jb25uZWN0aW9uc1tpXVtJRFhfV0VJR0hUXSA9IE1hdGgucm91bmQodGhpcy5jb25uZWN0aW9uc1tpXVtJRFhfV0VJR0hUXSAqIHByZWNpc2lvbikgLyBwcmVjaXNpb247CiAgICB9CiAgfSwKICB0b0pTT046IGZ1bmN0aW9uIChkZXNjcmlwdGlvbikgewogICAgdmFyIGRhdGEgPSB7CiAgICAgIG5vZGVzOiBjb3B5QXJyYXkobm9kZXMpLAogICAgICBjb25uZWN0aW9uczogY29weUNvbm5lY3Rpb25zKGNvbm5lY3Rpb25zKSwKICAgICAgbklucHV0OiBuSW5wdXQsCiAgICAgIG5PdXRwdXQ6IG5PdXRwdXQsCiAgICAgIHJlbmRlck1vZGU6IHJlbmRlck1vZGUsCiAgICAgIG91dHB1dEluZGV4OiBvdXRwdXRJbmRleCwKICAgICAgZ2Vub21lOiB0aGlzLmNvbm5lY3Rpb25zLAogICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24KICAgIH07CiAgICB0aGlzLmJhY2t1cCA9IG5ldyBHZW5vbWUodGhpcyk7CiAgICByZXR1cm4gZGF0YTsKICB9LAogIGZyb21KU09OOiBmdW5jdGlvbiAoZGF0YSkgewogICAgbm9kZXMgPSBjb3B5QXJyYXkoZGF0YS5ub2Rlcyk7CiAgICBjb25uZWN0aW9ucyA9IGNvcHlDb25uZWN0aW9ucyhkYXRhLmNvbm5lY3Rpb25zKTsKICAgIG5JbnB1dCA9IGRhdGEubklucHV0OwogICAgbk91dHB1dCA9IGRhdGEubk91dHB1dDsKICAgIHJlbmRlck1vZGUgPSBkYXRhLnJlbmRlck1vZGUgfHwgMDsgLy8gbWlnaHQgbm90IGV4aXN0LgogICAgb3V0cHV0SW5kZXggPSBkYXRhLm91dHB1dEluZGV4OwogICAgdGhpcy5pbXBvcnRDb25uZWN0aW9ucyhkYXRhLmdlbm9tZSk7CiAgICByZXR1cm4gZGF0YS5kZXNjcmlwdGlvbjsKICB9LAogIGZvcndhcmQ6IGZ1bmN0aW9uIChHKSB7CiAgICAvLyBmb3J3YXJkIHByb3BzIHRoZSBuZXR3b3JrIGZyb20gaW5wdXQgdG8gb3V0cHV0LiAgdGhpcyBpcyB3aGVyZSBtYWdpYyBoYXBwZW5zLgogICAgLy8gaW5wdXQgRyBpcyBhIHJlY3VycmVudC5qcyBncmFwaAogICAgdmFyIG91dHB1dE5vZGVMaXN0ID0gZ2V0Tm9kZUxpc3QoTk9ERV9PVVRQVVQpOwogICAgdmFyIGJpYXNOb2RlTGlzdCA9IGdldE5vZGVMaXN0KE5PREVfQklBUyk7CiAgICB2YXIgaW5wdXROb2RlTGlzdCA9IGJpYXNOb2RlTGlzdC5jb25jYXQoZ2V0Tm9kZUxpc3QoTk9ERV9JTlBVVCkpOwogICAgdmFyIGksIGosIG47CiAgICB2YXIgbk5vZGVzID0gbm9kZXMubGVuZ3RoOwogICAgdmFyIG5Db25uZWN0aW9ucyA9IGNvbm5lY3Rpb25zLmxlbmd0aDsKICAgIHZhciB0b3VjaGVkID0gUi56ZXJvcyhuTm9kZXMpOwogICAgdmFyIG5vZGVDb25uZWN0aW9ucyA9IG5ldyBBcnJheShuTm9kZXMpOyAvLyBhcnJheSBvZiBhcnJheSBvZiBjb25uZWN0aW9ucy4KCiAgICB2YXIgbm9kZUxpc3QgPSBbXTsKICAgIHZhciBiaW5hcnlOb2RlTGlzdCA9IFIuemVyb3Mobk5vZGVzKTsKICAgIGZvciAoaSA9IDA7IGkgPCBuTm9kZXM7IGkrKykgewogICAgICBub2RlQ29ubmVjdGlvbnNbaV0gPSBbXTsgLy8gZW1wdHkgYXJyYXkuCiAgICB9CiAgICBmb3IgKGkgPSAwOyBpIDwgbkNvbm5lY3Rpb25zOyBpKyspIHsKICAgICAgaWYgKHRoaXMudW5yb2xsZWRDb25uZWN0aW9uc1tpXVtJRFhfQ09OTkVDVElPTl0gJiYgdGhpcy51bnJvbGxlZENvbm5lY3Rpb25zW2ldW0lEWF9BQ1RJVkVdKSB7CiAgICAgICAgbm9kZUNvbm5lY3Rpb25zW2Nvbm5lY3Rpb25zW2ldWzFdXS5wdXNoKGkpOyAvLyBwdXNoIGluZGV4IG9mIGNvbm5lY3Rpb24gdG8gb3V0cHV0IG5vZGUKICAgICAgICBiaW5hcnlOb2RlTGlzdFtjb25uZWN0aW9uc1tpXVswXV0gPSAxOwogICAgICAgIGJpbmFyeU5vZGVMaXN0W2Nvbm5lY3Rpb25zW2ldWzFdXSA9IDE7CiAgICAgIH0KICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBuTm9kZXM7IGkrKykgewogICAgICBpZiAoYmluYXJ5Tm9kZUxpc3RbaV0gPT09IDEpIHsKICAgICAgICBub2RlTGlzdC5wdXNoKGkpOwogICAgICB9CiAgICB9CiAgICBmb3IgKGkgPSAwLCBuID0gaW5wdXROb2RlTGlzdC5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgdG91Y2hlZFtpbnB1dE5vZGVMaXN0W2ldXSA9IDEuMDsKICAgIH0KICAgIGZ1bmN0aW9uIGFsbFRvdWNoZWQobGlzdE9mTm9kZXMpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIG4gPSBsaXN0T2ZOb2Rlcy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICBpZiAodG91Y2hlZFtsaXN0T2ZOb2Rlc1tpXV0gIT09IDEpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBmb3J3YXJkVG91Y2goKSB7CiAgICAgIHZhciBpLCBqOwogICAgICB2YXIgbiA9IG5Ob2RlcywKICAgICAgICBtLAogICAgICAgIGl4OyAvLyBpeCBpcyB0aGUgaW5kZXggb2YgdGhlIGdsb2JhbCBjb25uZWN0aW9ucy4KICAgICAgdmFyIHRoZU5vZGU7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICBpZiAodG91Y2hlZFtpXSA9PT0gMCkgewogICAgICAgICAgdGhlTm9kZSA9IG5vZGVDb25uZWN0aW9uc1tpXTsKICAgICAgICAgIGZvciAoaiA9IDAsIG0gPSB0aGVOb2RlLmxlbmd0aDsgaiA8IG07IGorKykgewogICAgICAgICAgICBpeCA9IHRoZU5vZGVbal07CiAgICAgICAgICAgIGlmICh0b3VjaGVkW2Nvbm5lY3Rpb25zW2l4XVswXV0gPT09IDEpIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdub2RlICcrY29ubmVjdGlvbnNbaXhdWzBdKycgaXMgdG91Y2hlZCwgc28gbm93IG5vZGUgJytpKycgaGFzIGJlZW4gdG91Y2hlZCcpOwogICAgICAgICAgICAgIHRvdWNoZWRbaV0gPSAyOyAvLyB0ZW1wIHRvdWNoIHN0YXRlCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgIGlmICh0b3VjaGVkW2ldID09PSAyKSB0b3VjaGVkW2ldID0gMTsKICAgICAgfQogICAgfQoKICAgIC8vIGZvcndhcmQgdGljayBtYWdpYwogICAgZnVuY3Rpb24gZm9yd2FyZFRpY2sobW9kZWwpIHsKICAgICAgdmFyIGksIGo7CiAgICAgIHZhciBuLCBtLCBjSW5kZXgsIG5JbmRleDsgLy8gaXggaXMgdGhlIGluZGV4IG9mIHRoZSBnbG9iYWwgY29ubmVjdGlvbnMuCiAgICAgIHZhciB0aGVOb2RlOwogICAgICB2YXIgY3Vyck5vZGUsIGN1cnJPcGVyYW5kLCBjdXJyQ29ubmVjdGlvbjsgLy8gcmVjdXJyZW50IGpzIG9iamVjdHMKICAgICAgdmFyIG5lZWRPcGVyYXRpb247IC8vIGRvbid0IG5lZWQgb3BlcmF0aW9uIGlmIG5vZGUgaXMgb3BlcmF0b3Iobm9kZSkgaXMgbnVsbCBvciBtdWwgb3IgYWRkCiAgICAgIHZhciBub2RlVHlwZTsKICAgICAgdmFyIGZpbk9wOyAvLyBvcGVyYXRvciBhZnRlciBhbGwgb3BlcmFuZHMgYXJlIHdlaWdodGVkIHN1bW1lZCBvciBtdWx0aXBsaWVkCiAgICAgIHZhciBvcDsgLy8gZWl0aGVyICdhZGQnIG9yICdlbHRtdWx0JwogICAgICB2YXIgb3V0OyAvLyB0ZW1wIHZhcmlhYmxlIGZvciBzdG9yaW5nIHJlY3VycmVudGpzIHN0YXRlCiAgICAgIHZhciBjdW11bGF0ZTsgLy8gY3VtdWxhdGUgYWxsIHRoZSBvdXRzIChlaXRoZXIgYWRkaXRpb24gb3IgbXVsdCkKCiAgICAgIG4gPSBuTm9kZXM7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICBpZiAodG91Y2hlZFtpXSA9PT0gMSkgewogICAgICAgICAgLy8gb3BlcmF0ZSBvbiB0aGlzIG5vZGUgc2luY2UgaXQgaGFzIGJlZW4gdG91Y2hlZAoKICAgICAgICAgIHRoZU5vZGUgPSBub2RlQ29ubmVjdGlvbnNbaV07CiAgICAgICAgICBtID0gdGhlTm9kZS5sZW5ndGg7CiAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbm8gb3BlcmFuZHMgZm9yIHRoaXMgbm9kZSwgdGhlbiBkb24ndCBkbyBhbnl0aGluZy4KICAgICAgICAgIGlmIChtID09PSAwKSBjb250aW51ZTsKICAgICAgICAgIG5vZGVUeXBlID0gbm9kZXNbaV07CiAgICAgICAgICBuZWVkT3BlcmF0aW9uID0gdHJ1ZTsKICAgICAgICAgIGZpbk9wID0gb3BlcmF0b3JzW25vZGVUeXBlXTsKICAgICAgICAgIGlmIChmaW5PcCA9PT0gbnVsbCB8fCBmaW5PcCA9PT0gJ211bHQnIHx8IGZpbk9wID09PSAnYWRkJyB8fCBub2RlVHlwZSA9PT0gTk9ERV9NR0FVU1NJQU4pIG5lZWRPcGVyYXRpb24gPSBmYWxzZTsKCiAgICAgICAgICAvLyB1c3VhbGx5IHdlIGFkZCB3ZWlnaHRlZCBzdW0gb2Ygb3BlcmFuZHMsIGV4Y2VwdCBpZiBvcGVyYXRvciBpcyBtdWx0CiAgICAgICAgICBvcCA9ICdhZGQnOwogICAgICAgICAgaWYgKGZpbk9wID09PSAnbXVsdCcpIG9wID0gJ2VsdG11bCc7CgogICAgICAgICAgLy8gY3VtdWxhdGUgYWxsIHRoZSBvcGVyYW5kcwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IG07IGorKykgewogICAgICAgICAgICBjSW5kZXggPSB0aGVOb2RlW2pdOwogICAgICAgICAgICBuSW5kZXggPSBjb25uZWN0aW9uc1tjSW5kZXhdWzBdOwogICAgICAgICAgICBjdXJyQ29ubmVjdGlvbiA9IG1vZGVsLmNvbm5lY3Rpb25zW2NJbmRleF07CiAgICAgICAgICAgIGN1cnJPcGVyYW5kID0gbW9kZWwubm9kZXNbbkluZGV4XTsKICAgICAgICAgICAgb3V0ID0gRy5tdWwoY3Vyck9wZXJhbmQsIGN1cnJDb25uZWN0aW9uKTsKICAgICAgICAgICAgaWYgKG5vZGVUeXBlID09PSBOT0RFX01HQVVTU0lBTikgewogICAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogIHRoZSBuYXN0eSBtdWx0aSBnYXVzc2lhbgogICAgICAgICAgICAgIG91dCA9IEcuZ2F1c3NpYW4ob3V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaiA9PT0gMCkgewogICAgICAgICAgICAgIC8vIGFzc2lnbiBmaXJzdCByZXN1bHQgdG8gY3VtdWxhdGUKICAgICAgICAgICAgICBjdW11bGF0ZSA9IG91dDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjdW11bGF0ZSBuZXh0IHJlc3VsdCBhZnRlciBmaXJzdCBvcGVyYW5kCiAgICAgICAgICAgICAgY3VtdWxhdGUgPSBHW29wXShjdW11bGF0ZSwgb3V0KTsgLy8gb3AgaXMgZWl0aGVyIGFkZCBvciBlbHRtdWwKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIHNldCB0aGUgcmVjdXJyZW50anMgbm9kZSBoZXJlCiAgICAgICAgICBtb2RlbC5ub2Rlc1tpXSA9IGN1bXVsYXRlOwogICAgICAgICAgLy8gb3BlcmF0ZSBvbiBjdW11bGF0ZWQgc3VtIG9yIHByb2R1Y3QgaWYgbmVlZGVkCiAgICAgICAgICBpZiAobmVlZE9wZXJhdGlvbikgewogICAgICAgICAgICBtb2RlbC5ub2Rlc1tpXSA9IEdbZmluT3BdKG1vZGVsLm5vZGVzW2ldKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBhbm90aGVyIHNwZWNpYWwgY2FzZSwgc3F1YXJpbmcgdGhlIG91dHB1dAogICAgICAgICAgaWYgKG5vZGVUeXBlID09PSBOT0RFX1NRVUFSRSkgewogICAgICAgICAgICBtb2RlbC5ub2Rlc1tpXSA9IEcuZWx0bXVsKG1vZGVsLm5vZGVzW2ldLCBtb2RlbC5ub2Rlc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBwcmludFRvdWNoZWQoKSB7CiAgICAgIHZhciBpOwogICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB0b3VjaGVkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcmVzdWx0ICs9IHRvdWNoZWRbaV0gKyAiICI7CiAgICAgIH0KICAgICAgY29uc29sZS5sb2cocmVzdWx0KTsKICAgIH0KCiAgICAvL3ByaW50VG91Y2hlZCgpOwogICAgZm9yIChpID0gMDsgaSA8IE1BWF9USUNLOyBpKyspIHsKICAgICAgZm9yd2FyZFRvdWNoKCk7CiAgICAgIGZvcndhcmRUaWNrKHRoaXMubW9kZWwpOyAvLyBmb3J3YXJkIHRpY2sgdGhlIG5ldHdvcmsgdXNpbmcgZ3JhcGgKICAgICAgLy9wcmludFRvdWNoZWQoKTsKICAgICAgLyoNCiAgICAgIGlmIChhbGxUb3VjaGVkKG91dHB1dE5vZGVMaXN0KSkgew0KICAgICAgICAvL2NvbnNvbGUubG9nKCdhbGwgb3V0cHV0cyB0b3VjaGVkIScpOw0KICAgICAgICAvL2JyZWFrOw0KICAgICAgfQ0KICAgICAgKi8KICAgICAgaWYgKGFsbFRvdWNoZWQobm9kZUxpc3QpKSB7CiAgICAgICAgLy9jb25zb2xlLmxvZygnYWxsIG5vZGVzIHRvdWNoZWQhJyk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Cn07Cmdsb2JhbC5pbml0ID0gaW5pdDsKZ2xvYmFsLkdlbm9tZSA9IEdlbm9tZTsKZ2xvYmFsLmdldE5vZGVzID0gZ2V0Tm9kZXM7Cmdsb2JhbC5nZXRDb25uZWN0aW9ucyA9IGdldENvbm5lY3Rpb25zOwpnbG9iYWwucmFuZG9taXplUmVuZGVyTW9kZSA9IHJhbmRvbWl6ZVJlbmRlck1vZGU7Cmdsb2JhbC5zZXRSZW5kZXJNb2RlID0gc2V0UmVuZGVyTW9kZTsKZ2xvYmFsLmdldFJlbmRlck1vZGUgPSBnZXRSZW5kZXJNb2RlOwpnbG9iYWwuZ2V0TnVtSW5wdXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIG5JbnB1dDsKfTsKZ2xvYmFsLmdldE51bU91dHB1dCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gbk91dHB1dDsKfTsKZXhwb3J0IHsgZ2V0UmFuZG9tUmVuZGVyTW9kZSwgR2Vub21lLCBpbml0LCByYW5kb21pemVSZW5kZXJNb2RlLCBnZXRSYW5kb21BY3RpdmF0aW9uLCBnZXRSZW5kZXJNb2RlIH07CgovLyB9KShOKTsKLy8gKGZ1bmN0aW9uKGxpYikgewovLyAgICJ1c2Ugc3RyaWN0IjsKLy8gICBpZiAodHlwZW9mIG1vZHVsZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIG1vZHVsZS5leHBvcnRzID09PSAidW5kZWZpbmVkIikgewovLyAgICAgd2luZG93LmpzZmVhdCA9IGxpYjsgLy8gaW4gb3JkaW5hcnkgYnJvd3NlciBhdHRhY2ggbGlicmFyeSB0byB3aW5kb3cKLy8gICB9IGVsc2UgewovLyAgICAgbW9kdWxlLmV4cG9ydHMgPSBsaWI7IC8vIGluIG5vZGVqcwovLyAgIH0KLy8gfSkoTik7CgovKg0KTi5pbml0KHtuSW5wdXQ6IDIsIG5PdXRwdXQ6IDN9KTsNCg0KdmFyIGdlbm9tZSA9IG5ldyBOLkdlbm9tZSgpOw0KdmFyIGdlbm9tZTEgPSBuZXcgTi5HZW5vbWUoKTsNCnZhciBnZW5vbWUyID0gbmV3IE4uR2Vub21lKCk7DQoNCmZvciAodmFyIGk9MDtpPDI7aSsrKSB7DQogIGdlbm9tZS5hZGRSYW5kb21Ob2RlKCk7DQogIGdlbm9tZS5hZGRSYW5kb21Db25uZWN0aW9uKCk7DQogIGdlbm9tZS5hZGRSYW5kb21Db25uZWN0aW9uKCk7DQogIGdlbm9tZS5hZGRSYW5kb21Db25uZWN0aW9uKCk7DQogIGdlbm9tZTEuYWRkUmFuZG9tTm9kZSgpOw0KICBnZW5vbWUxLmFkZFJhbmRvbUNvbm5lY3Rpb24oKTsNCiAgZ2Vub21lMS5hZGRSYW5kb21Db25uZWN0aW9uKCk7DQogIGdlbm9tZTEuYWRkUmFuZG9tQ29ubmVjdGlvbigpOw0KICBnZW5vbWUyLmFkZFJhbmRvbU5vZGUoKTsNCiAgZ2Vub21lMS5hZGRSYW5kb21Db25uZWN0aW9uKCk7DQogIGdlbm9tZTEuYWRkUmFuZG9tQ29ubmVjdGlvbigpOw0KICBnZW5vbWUxLmFkZFJhbmRvbUNvbm5lY3Rpb24oKTsNCn0NCg0KDQp2YXIgY2hpbGQgPSBnZW5vbWUuY3Jvc3NvdmVyKGdlbm9tZTEpOw0KdmFyIGNoaWxkMiA9IGNoaWxkLmNyb3Nzb3ZlcihnZW5vbWUyKTsNCg0KLy9nZW5vbWUgPSBjaGlsZC5jcm9zc292ZXIoY2hpbGQyKTsNCg0KLy9jb25zb2xlLmxvZyhnZW5vbWUpOw0KDQp2YXIgaW5wdXQgPSBbWy0wLjUsIC0wLjVdXTsgLy8sIFswLjI1LCAwLjc1XSwgWy0wLjI1LCAwLjVdLCBbMC42LCAtMC42XV07DQoNCmdlbm9tZS5zZXR1cE1vZGVsKGlucHV0Lmxlbmd0aCk7DQpnZW5vbWUuc2V0SW5wdXQoaW5wdXQpOw0KDQp2YXIgRyA9IG5ldyBSLkdyYXBoKCk7DQoNCmdlbm9tZS5mb3J3YXJkKEcpOw0KDQp2YXIgb3V0cHV0ID0gZ2Vub21lLmdldE91dHB1dCgpOw0KDQoNCnZhciBpLCBqOw0KZm9yIChpPTA7aTwzO2krKykgew0KICBmb3IgKGo9MDtqPDE7aisrKSB7DQogICAgb3V0cHV0W2ldLmR3W2pdID0gLU1hdGgucmFuZG9tKCk7DQogIH0NCn0NCg0KDQpjb25zb2xlLmxvZyhvdXRwdXQpOw0KY29uc29sZS5sb2coZ2Vub21lLm1vZGVsKTsNCmNvbnNvbGUubG9nKCctLS0tLS0tLS0tLScpOw0KDQpHLmJhY2t3YXJkKCk7DQoNCmNvbnNvbGUubG9nKG91dHB1dCk7DQpjb25zb2xlLmxvZyhnZW5vbWUubW9kZWwpOw0KDQoqLwoKLyogZXNsaW50LWVuYWJsZSBuby11bnVzZWQtdmFycyAqLw=="},{"version":3,"names":["module","R","require","N","assert","condition","message","Error","NODE_INPUT","NODE_OUTPUT","NODE_BIAS","NODE_SIGMOID","NODE_TANH","NODE_RELU","NODE_GAUSSIAN","NODE_SIN","NODE_COS","NODE_ABS","NODE_MULT","NODE_ADD","NODE_MGAUSSIAN","NODE_SQUARE","NODE_INIT","MAX_TICK","operators","IDX_CONNECTION","IDX_WEIGHT","IDX_ACTIVE","activations","getRandomActivation","ix","randi","length","gid","getGID","result","nodes","connections","copyArray","x","n","Array","i","copyConnections","newC","copyC","push","getNodes","getConnections","nInput","nOutput","outputIndex","initNodes","initMu","initStdev","mutationRate","mutationSize","getRandomRenderMode","z","renderMode","randomizeRenderMode","console","log","setRenderMode","rMode","getRenderMode","getOption","opt","index","orig","init","j","dummyIndex","getNodeList","node_type","Genome","initGenome","c","copy","zeros","randn","prototype","importConnections","cArray","temp","mutateWeights","mutationRate_","mutationSize_","mRate","mSize","Math","random","addRandomNode","w","nodeIndex","innovationNum","fromNodeIndex","toNodeIndex","connectionIndex","c1","c2","addRandomConnection","nodesInUseFlag","nodesInUse","fromNodeUsed","toNodeUsed","searchIndex","connectionIsInGenome","createUnrolledConnections","m","cIndex","unrolledConnections","crossover","that","child","g","count","setupModel","inputDepth","nNodes","nConnections","model","nodeModel","connectionModel","Mat","zeroOutNodes","zeroOutModel","setInput","input","d","inputNodeList","biasNodeList","dBias","set","get","getOutput","outputNodeList","output","roundWeights","precision","round","toJSON","description","data","genome","backup","fromJSON","forward","G","concat","touched","nodeConnections","nodeList","binaryNodeList","allTouched","listOfNodes","forwardTouch","theNode","forwardTick","nIndex","currNode","currOperand","currConnection","needOperation","nodeType","finOp","op","out","cumulate","mul","gaussian","eltmul","printTouched","global","getNumInput","getNumOutput"],"sources":["/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/src/lib/neat.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\r\n\r\n/*globals paper, $ */\r\n/*jslint nomen: true, undef: true, sloppy: true */\r\n\r\n// network art library\r\n\r\n/*\r\n\r\n@licstart  The following is the entire license notice for the\r\nJavaScript code in this page.\r\n\r\nCopyright (C) 2015 david ha, otoro.net, otoro labs\r\n\r\nThe JavaScript code in this page is free software: you can\r\nredistribute it and/or modify it under the terms of the GNU\r\nGeneral Public License (GNU GPL) as published by the Free Software\r\nFoundation, either version 3 of the License, or (at your option)\r\nany later version.  The code is distributed WITHOUT ANY WARRANTY;\r\nwithout even the implied warranty of MERCHANTABILITY or FITNESS\r\nFOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.\r\n\r\nAs additional permission under GNU GPL version 3 section 7, you\r\nmay distribute non-source (e.g., minimized or compacted) forms of\r\nthat code without the copy of the GNU GPL normally required by\r\nsection 4, provided you include this license notice and a URL\r\nthrough which recipients can access the Corresponding Source.\r\n\r\n\r\n@licend  The above is the entire license notice\r\nfor the JavaScript code in this page.\r\n*/\r\n\r\n// implementation of neat algorithm with recurrent.js graphs to support backprop\r\n// used for genetic art.\r\n// code is not modular or oop, ad done in a fortran/scientific computing style\r\n// apologies in advance if that ain't ur taste.\r\nif (typeof module != \"undefined\") {\r\n  var R = require('./recurrent.js');\r\n  //var NetArt = require('./netart.js');\r\n}\r\n\r\nvar N = {};\r\n\r\n//(function(global) {\r\n  \"use strict\";\r\n\r\n  // Utility fun\r\n  function assert(condition, message) {\r\n    // from http://stackoverflow.com/questions/15313418/javascript-assert\r\n    if (!condition) {\r\n      message = message || \"Assertion failed\";\r\n      if (typeof Error !== \"undefined\") {\r\n        throw new Error(message);\r\n      }\r\n      throw message; // Fallback\r\n    }\r\n  }\r\n\r\n  // constants\r\n  var NODE_INPUT = 0;\r\n  var NODE_OUTPUT = 1;\r\n  var NODE_BIAS = 2;\r\n  // hidden layers\r\n  var NODE_SIGMOID = 3;\r\n  var NODE_TANH = 4;\r\n  var NODE_RELU = 5;\r\n  var NODE_GAUSSIAN = 6;\r\n  var NODE_SIN = 7;\r\n  var NODE_COS = 8;\r\n  var NODE_ABS = 9;\r\n  var NODE_MULT = 10;\r\n  var NODE_ADD = 11;\r\n  var NODE_MGAUSSIAN = 12; // multi-dim gaussian (do gaussian to each input then mult)\r\n  var NODE_SQUARE = 13;\r\n\r\n  var NODE_INIT = NODE_ADD;\r\n\r\n  var MAX_TICK = 100;\r\n\r\n  var operators = [null, null, null, 'sigmoid', 'tanh', 'relu', 'gaussian', 'sin', 'cos', 'abs', 'mult', 'add', 'mult', 'add'];\r\n\r\n  // for connections\r\n  var IDX_CONNECTION = 0;\r\n  var IDX_WEIGHT = 1;\r\n  var IDX_ACTIVE = 2;\r\n\r\n  //var activations = [NODE_SIGMOID, NODE_TANH, NODE_RELU, NODE_GAUSSIAN, NODE_SIN, NODE_COS, NODE_MULT, NODE_ABS, NODE_ADD, NODE_MGAUSSIAN, NODE_SQUARE];\r\n  var activations = [NODE_SIGMOID, NODE_TANH, NODE_RELU, NODE_GAUSSIAN, NODE_SIN, NODE_COS, NODE_ADD];\r\n\r\n  var getRandomActivation = function() {\r\n    var ix = R.randi(0, activations.length);\r\n    return activations[ix];\r\n  };\r\n\r\n  var gid = 0; \r\n  var getGID = function() {\r\n    var result = gid;\r\n    gid += 1;\r\n    return result;\r\n  };\r\n\r\n  var nodes = []; // this array holds all nodes\r\n  var connections = []; // index of connections here is the 'innovation' value\r\n\r\n  var copyArray = function(x) {\r\n    // returns a copy of floatArray\r\n    var n = x.length;\r\n    var result = new Array(n);\r\n    for (var i=0;i<n;i++) {\r\n      result[i]=x[i];\r\n    }\r\n    return result;\r\n  };\r\n\r\n  function copyConnections(newC) {\r\n    var i, n;\r\n    n = newC.length;\r\n    var copyC = [];\r\n    for (i=0;i<n;i++) { // connects input and bias to init dummy node\r\n      copyC.push([newC[i][0], newC[i][1]]);\r\n    }\r\n    return copyC;\r\n  }\r\n\r\n  var getNodes = function() {\r\n    return copyArray(nodes);\r\n  };\r\n\r\n  var getConnections = function() {\r\n    return copyConnections(connections);\r\n  };\r\n\r\n  var nInput = 1;\r\n  var nOutput = 1;\r\n  var outputIndex = 2; // [bias, input, output]\r\n  var initNodes = [];\r\n  var initMu = 0.0, initStdev = 1.0; // randomised param initialisation.\r\n  var mutationRate = 0.2;\r\n  var mutationSize = 0.5;\r\n\r\n  function getRandomRenderMode() {\r\n    // more chance to be 0 (1/2), and then 1/3 to be 1, and 1/6 to be 2\r\n    var z = R.randi(0, 6);\r\n    if (z<3) return 0;\r\n    if (z<5) return 1;\r\n    return 2;\r\n  }\r\n\r\n  var renderMode = getRandomRenderMode(); // 0 = sigmoid (1 = gaussian, 2 = tanh+abs\r\n\r\n  var randomizeRenderMode = function() {\r\n    renderMode = getRandomRenderMode();\r\n    console.log('render mode = '+renderMode);\r\n  };\r\n\r\n  var setRenderMode = function(rMode) {\r\n    renderMode = rMode;\r\n  };\r\n\r\n  var getRenderMode = function() {\r\n    return renderMode;\r\n  };\r\n\r\n  function getOption(opt, index, orig) {\r\n    if (opt && typeof opt[index] !== \"undefined\") { return opt[index]; }\r\n    return orig;\r\n  }\r\n\r\n  var init = function(opt) {\r\n    var i, j;\r\n    nInput = getOption(opt, 'nInput', nInput);\r\n    nOutput = getOption(opt, 'nOutput', nOutput);\r\n    outputIndex = nInput+1; // index of output start (bias so add 1)\r\n    // initialise nodes\r\n    for (i=0;i<nInput;i++) {\r\n      nodes.push(NODE_INPUT);\r\n    }\r\n    nodes.push(NODE_BIAS);\r\n    for (i=0;i<nOutput;i++) {\r\n      nodes.push(NODE_OUTPUT);\r\n    }\r\n    // initialise connections. at beginning only connect inputs to outputs\r\n    // initially, bias has no connections and that must be grown.\r\n  \r\n/*\r\n    for (j=0;j<nOutput;j++) {\r\n      for (i=0;i<nInput+1;i++) {\r\n        connections.push([i, outputIndex+j]);\r\n      }\r\n    }\r\n*/\r\n\r\n    // push initial dummy node\r\n    nodes.push(NODE_ADD);\r\n    var dummyIndex = nodes.length-1;\r\n    for (i=0;i<nInput+1;i++) { // connects input and bias to init dummy node\r\n      connections.push([i, dummyIndex]);\r\n    }\r\n    for (i=0;i<nOutput;i++) { // connects dummy node to output\r\n      connections.push([dummyIndex, outputIndex+i]);\r\n    }\r\n\r\n  };\r\n\r\n  function getNodeList(node_type) {\r\n    // returns a list of locations (index of global node array) containing\r\n    // where all the output nodes are\r\n    var i, n;\r\n    var result = [];\r\n    for (i=0,n=nodes.length;i<n;i++) {\r\n      if (nodes[i] === node_type) {\r\n        result.push(i);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  var Genome = function(initGenome) {\r\n    var i, j;\r\n    var n;\r\n    var c; // connection storage.\r\n\r\n    this.connections = [];\r\n    // create or copy initial connections\r\n    if (initGenome && typeof initGenome.connections !== \"undefined\") {\r\n      for (i=0,n=initGenome.connections.length;i<n;i++) {\r\n        this.connections.push(R.copy(initGenome.connections[i]));\r\n      }\r\n    } else {\r\n\r\n/*\r\n      // copy over initial connections (nInput + connectBias) * nOutput\r\n      for (i=0,n=(nInput+1)*nOutput;i<n;i++) {\r\n        c = R.zeros(3); // innovation number, weight, enabled (1)\r\n        c[IDX_CONNECTION] = i;\r\n        c[IDX_WEIGHT] = R.randn(initMu, initStdev);\r\n        c[IDX_ACTIVE] = 1;\r\n        this.connections.push(c);\r\n      }\r\n*/\r\n\r\n      for (i=0,n=(nInput+1)+nOutput;i<n;i++) {\r\n        c = R.zeros(3); // innovation number, weight, enabled (1)\r\n        c[IDX_CONNECTION] = i;\r\n        // the below line assigns 1 to initial weights from dummy node to output\r\n        c[IDX_WEIGHT] = (i < (nInput+1)) ? R.randn(initMu, initStdev) : 1.0;\r\n        //c[IDX_WEIGHT] = R.randn(initMu, initStdev);\r\n        c[IDX_ACTIVE] = 1;\r\n        this.connections.push(c);\r\n      }\r\n\r\n\r\n    }\r\n  };\r\n\r\n  Genome.prototype = {\r\n    copy: function() {\r\n      // makes a copy of itself and return it (returns a Genome class)\r\n      return new Genome(this);\r\n    },\r\n    importConnections: function(cArray) {\r\n      var i, n;\r\n      this.connections = [];\r\n      var temp;\r\n      for (i=0,n=cArray.length;i<n;i++) {\r\n        temp = new R.zeros(3);\r\n        temp[0] = cArray[i][0];\r\n        temp[1] = cArray[i][1];\r\n        temp[2] = cArray[i][2];\r\n        this.connections.push(temp);\r\n      }\r\n    },\r\n    mutateWeights: function(mutationRate_, mutationSize_) {\r\n      // mutates each weight of current genome with a probability of mutationRate\r\n      // by adding a gaussian noise of zero mean and mutationSize stdev to it\r\n      var mRate = mutationRate_ || mutationRate;\r\n      var mSize = mutationSize_ || mutationSize;\r\n\r\n      var i, n;\r\n      for (i=0,n=this.connections.length;i<n;i++) {\r\n        if (Math.random() < mRate) {\r\n          this.connections[i][IDX_WEIGHT] += R.randn(0, mSize);\r\n        }\r\n      }\r\n    },\r\n    addRandomNode: function() {\r\n      // adds a new random node and assigns it a random activation gate\r\n      var c = R.randi(0, this.connections.length); // choose random connection\r\n      var w = this.connections[c][1]; //weight?\r\n\r\n      this.connections[c][2] = 0; // disable the connection\r\n      var nodeIndex = nodes.length;\r\n      nodes.push(getRandomActivation()); // create the new node globally\r\n\r\n      var innovationNum = this.connections[c][0]; //just the index\r\n      var fromNodeIndex = connections[innovationNum][0];\r\n      var toNodeIndex = connections[innovationNum][1];\r\n\r\n      var connectionIndex = connections.length;\r\n      // make 2 new connection globally\r\n      connections.push([fromNodeIndex, nodeIndex]);\r\n      connections.push([nodeIndex, toNodeIndex]);\r\n\r\n      // put in this node locally into genome\r\n      var c1 = R.zeros(3);\r\n      c1[IDX_CONNECTION] = connectionIndex;\r\n      c1[IDX_WEIGHT] = 1.0; // use 1.0 as first connection weight\r\n      c1[IDX_ACTIVE] = 1;\r\n      var c2 = R.zeros(3);\r\n      c2[IDX_CONNECTION] = connectionIndex+1;\r\n      c2[IDX_WEIGHT] = w; // use old weight for 2nd connection\r\n      c2[IDX_ACTIVE] = 1;\r\n\r\n      this.connections.push(c1);\r\n      this.connections.push(c2);\r\n    },\r\n    addRandomConnection: function() {\r\n      // attempts to add a random connection.\r\n      // if connection exists, then does nothing (ah well)\r\n\r\n      var i, n, connectionIndex, nodeIndex;\r\n      var nodesInUseFlag = R.zeros(nodes.length);\r\n      var nodesInUse = [];\r\n\r\n      for (i=0,n=this.connections.length;i<n;i++) {\r\n        connectionIndex = this.connections[i][0];\r\n        nodeIndex = connections[connectionIndex][0];\r\n        nodesInUseFlag[nodeIndex] = 1;\r\n        nodeIndex = connections[connectionIndex][1];\r\n        nodesInUseFlag[nodeIndex] = 1;\r\n      }\r\n      for (i=0,n=nodes.length;i<n;i++) {\r\n        if (nodesInUseFlag[i] === 1) {\r\n          nodesInUse.push(i);\r\n        }\r\n      }\r\n\r\n      //var fromNodeIndex = R.randi(0, nodes.length);\r\n      //var toNodeIndex = R.randi(outputIndex, nodes.length); // includes bias.\r\n\r\n      var fromNodeIndex = nodesInUse[R.randi(0, nodesInUse.length)]; //random nodes\r\n      var toNodeIndex = nodesInUse[R.randi(outputIndex, nodesInUse.length)];\r\n\r\n      var fromNodeUsed = false; \r\n      var toNodeUsed = false;\r\n\r\n      if (fromNodeIndex === toNodeIndex) return; // can't be the same index.\r\n      // cannot loop back out from the output.\r\n      if (fromNodeIndex >= outputIndex && fromNodeIndex < (outputIndex+nOutput)) return;\r\n\r\n      // the below set of code will test if selected nodes are actually used in network connections\r\n      for (i=0,n=this.connections.length;i<n;i++) {\r\n        connectionIndex = this.connections[i][0];\r\n        if ((connections[connectionIndex][0] === fromNodeIndex) || (connections[connectionIndex][1] === fromNodeIndex)) {\r\n          fromNodeUsed = true; break;\r\n        }\r\n      }\r\n      for (i=0,n=this.connections.length;i<n;i++) {\r\n        connectionIndex = this.connections[i][0];\r\n        if ((connections[connectionIndex][0] === toNodeIndex) || (connections[connectionIndex][1] === toNodeIndex)) {\r\n          toNodeUsed = true; break;\r\n        }\r\n      }\r\n      if (!fromNodeUsed || !toNodeUsed) return; // only consider connections in current net.\r\n\r\n      var searchIndex = -1; // see if connection already exist.\r\n      for (i=0,n=connections.length;i<n;i++) {\r\n        if (connections[i][0] === fromNodeIndex && connections[i][1] === toNodeIndex) {\r\n          searchIndex = i; break;\r\n        }\r\n      }\r\n\r\n\r\n      if (searchIndex < 0) {\r\n        // great, this connection doesn't exist yet!\r\n        connectionIndex = connections.length;\r\n        connections.push([fromNodeIndex, toNodeIndex]);\r\n\r\n        var c = R.zeros(3); // innovation number, weight, enabled (1)\r\n        c[IDX_CONNECTION] = connectionIndex;\r\n        c[IDX_WEIGHT] = R.randn(initMu, initStdev);\r\n        c[IDX_ACTIVE] = 1;\r\n        this.connections.push(c);\r\n      } else {\r\n        var connectionIsInGenome = false;\r\n        for (i=0,n=this.connections.length; i<n; i++) {\r\n          if (this.connections[i][IDX_CONNECTION] === searchIndex) {\r\n            // enable back the index (if not enabled)\r\n            this.connections[i][IDX_ACTIVE] = 1;\r\n            connectionIsInGenome = true;\r\n            break;\r\n          }\r\n        }\r\n        if (!connectionIsInGenome) {\r\n          // even though connection exists globally, it isn't in this gene.\r\n          //console.log('even though connection exists globally, it isnt in this gene.');\r\n          var c1 = R.zeros(3); // innovation number, weight, enabled (1)\r\n          c1[IDX_CONNECTION] = searchIndex;\r\n          c1[IDX_WEIGHT] = R.randn(initMu, initStdev);\r\n          c1[IDX_ACTIVE] = 1;\r\n          this.connections.push(c1);\r\n          //console.log('added connection that exists somewhere else but not here.');\r\n        }\r\n      }\r\n\r\n    },\r\n    createUnrolledConnections: function() {\r\n      // create a large array that is the size of Genome.connections\r\n      // element:\r\n      // 0: 1 or 0, whether this connection exists in this genome or not\r\n      // 1: weight\r\n      // 2: active? (1 or 0)\r\n      var i, n, m, cIndex, c;\r\n      this.unrolledConnections = [];\r\n      n=connections.length; // global connection length\r\n      m=this.connections.length;\r\n      for (i=0;i<n;i++) {\r\n        this.unrolledConnections.push(R.zeros(3));\r\n      }\r\n      for (i=0;i<m;i++) {\r\n        c = this.connections[i];\r\n        cIndex = c[IDX_CONNECTION];\r\n        this.unrolledConnections[cIndex][IDX_CONNECTION] = 1;\r\n        this.unrolledConnections[cIndex][IDX_WEIGHT] = c[IDX_WEIGHT];\r\n        this.unrolledConnections[cIndex][IDX_ACTIVE] = c[IDX_ACTIVE];\r\n      }\r\n    },\r\n    crossover: function(that) { // input is another genome //dear fuck why is it called 'that'\r\n      // returns a newly create genome that is the offspring.\r\n      var i, n, c;\r\n      var child = new Genome();\r\n      child.connections = []; // empty initial connections\r\n      var g;\r\n      var count;\r\n\r\n      n = connections.length;\r\n\r\n      this.createUnrolledConnections();\r\n      that.createUnrolledConnections(); \r\n \r\n      //a genome consists of just connections ???\r\n      for (i=0;i<n;i++) { //loops through all connections\r\n        count = 0;\r\n        g = this; //omg\r\n        if (this.unrolledConnections[i][IDX_CONNECTION] === 1) { //checks if the connection is active in the parent genome\r\n          count++;\r\n        }\r\n        if (that.unrolledConnections[i][IDX_CONNECTION] === 1) { //checks if its active in the other parent\r\n          g = that;\r\n          count++;\r\n        }\r\n        if (count === 2 && Math.random() < 0.5) { //if both connections are active chooses one at random\r\n          g = this;\r\n        }\r\n        if (count === 0) continue; // both genome doesn't contain this connection\r\n        c = R.zeros(3);\r\n        c[IDX_CONNECTION] = i;\r\n        c[IDX_WEIGHT] = g.unrolledConnections[i][IDX_WEIGHT];\r\n        // in the following line, the connection is disabled only of it is disabled on both parents\r\n        c[IDX_ACTIVE] = 1;\r\n        if (this.unrolledConnections[i][IDX_ACTIVE] === 0 && that.unrolledConnections[i][IDX_ACTIVE] === 0) {\r\n          c[IDX_ACTIVE] = 0;\r\n        }\r\n        child.connections.push(c);\r\n      }\r\n\r\n      return child;\r\n    },\r\n    setupModel: function(inputDepth) {\r\n      // setup recurrent.js model\r\n      var i;\r\n      var nNodes = nodes.length;\r\n      var nConnections = connections.length;\r\n      this.createUnrolledConnections();\r\n      this.model = [];\r\n      var nodeModel = [];\r\n      var connectionModel = [];\r\n      var c;\r\n      for (i=0;i<nNodes;i++) {\r\n        nodeModel.push(new R.Mat(inputDepth, 1));\r\n      }\r\n      for (i=0;i<nConnections;i++) {\r\n        c = new R.Mat(1, 1);\r\n        c.w[0] = this.unrolledConnections[i][IDX_WEIGHT];\r\n        connectionModel.push(c);\r\n      }\r\n      this.model.nodes = nodeModel;\r\n      this.model.connections = connectionModel;\r\n    },\r\n    zeroOutNodes: function() {\r\n      R.zeroOutModel(this.model.nodes);\r\n    },\r\n    setInput: function(input) {\r\n      // input is an n x d R.mat, where n is the inputDepth, and d is number of inputs\r\n      // for generative art, d is typically just (x, y)\r\n      // also sets all the biases to be 1.0\r\n      // run this function _after_ setupModel() is called!\r\n      var i, j;\r\n      var n = input.n; //rows\r\n      var d = input.d; //columns\r\n      var inputNodeList = getNodeList(NODE_INPUT); //list of nodes with type 0\r\n      var biasNodeList = getNodeList(NODE_BIAS); //list of nodes with type 2\r\n      var dBias = biasNodeList.length;\r\n\r\n      //R.assert(inputNodeList.length === d);   //this fails but... seems to be working without it\r\n      R.assert(this.model.nodes[0].n === n);\r\n\r\n      for (i=0;i<n;i++) {\r\n        for (j=0;j<d;j++) {\r\n          this.model.nodes[inputNodeList[j]].set(i, 0, input.get(i, j));\r\n        }\r\n        for (j=0;j<dBias;j++) {\r\n          this.model.nodes[biasNodeList[j]].set(i, 0, 1.0);\r\n        }\r\n      }\r\n    },\r\n    getOutput: function() {\r\n      // returns an array of recurrent.js Mat's representing the output\r\n      var i;\r\n      var outputNodeList = getNodeList(NODE_OUTPUT);\r\n      var d = outputNodeList.length;\r\n      var output = [];\r\n      for (i=0;i<d;i++) {\r\n        output.push(this.model.nodes[outputNodeList[i]]);\r\n      }\r\n      return output;\r\n    },\r\n    roundWeights: function() {\r\n      var precision = 10000;\r\n      for (var i=0;i<this.connections.length;i++) {\r\n        this.connections[i][IDX_WEIGHT] = Math.round(this.connections[i][IDX_WEIGHT]*precision)/precision;\r\n      }\r\n    },\r\n    toJSON: function(description) {\r\n      var data = {\r\n        nodes: copyArray(nodes),\r\n        connections: copyConnections(connections),\r\n        nInput: nInput,\r\n        nOutput: nOutput,\r\n        renderMode: renderMode,\r\n        outputIndex: outputIndex,\r\n        genome: this.connections,\r\n        description: description\r\n      };\r\n\r\n      this.backup = new Genome(this);\r\n\r\n      return data;\r\n\r\n    },\r\n    fromJSON: function(data) {\r\n      nodes = copyArray(data.nodes);\r\n      connections = copyConnections(data.connections);\r\n      nInput = data.nInput;\r\n      nOutput = data.nOutput;\r\n      renderMode = data.renderMode || 0; // might not exist.\r\n      outputIndex = data.outputIndex;\r\n      this.importConnections(data.genome);\r\n\r\n      return data.description;\r\n    },\r\n    forward: function(G) {\r\n      // forward props the network from input to output.  this is where magic happens.\r\n      // input G is a recurrent.js graph\r\n      var outputNodeList = getNodeList(NODE_OUTPUT);\r\n      var biasNodeList = getNodeList(NODE_BIAS);\r\n      var inputNodeList = biasNodeList.concat(getNodeList(NODE_INPUT));\r\n\r\n      var i, j, n;\r\n      var nNodes = nodes.length;\r\n      var nConnections = connections.length;\r\n      var touched = R.zeros(nNodes);\r\n      var nodeConnections = new Array(nNodes); // array of array of connections.\r\n\r\n      var nodeList = [];\r\n      var binaryNodeList = R.zeros(nNodes);\r\n\r\n      for (i=0;i<nNodes;i++) {\r\n        nodeConnections[i] = []; // empty array.\r\n      }\r\n\r\n      for (i=0;i<nConnections;i++) {\r\n        if (this.unrolledConnections[i][IDX_CONNECTION] && this.unrolledConnections[i][IDX_ACTIVE]) {\r\n          nodeConnections[connections[i][1]].push(i); // push index of connection to output node\r\n          binaryNodeList[connections[i][0]] = 1;\r\n          binaryNodeList[connections[i][1]] = 1;\r\n        }\r\n      }\r\n\r\n      for (i=0;i<nNodes;i++) {\r\n        if (binaryNodeList[i] === 1) {\r\n          nodeList.push(i);\r\n        }\r\n      }\r\n\r\n      for (i=0,n=inputNodeList.length;i<n;i++) {\r\n        touched[inputNodeList[i]] = 1.0;\r\n      }\r\n\r\n      function allTouched(listOfNodes) {\r\n        for (var i=0,n=listOfNodes.length;i<n;i++) {\r\n          if (touched[listOfNodes[i]] !== 1) {\r\n            return false;\r\n          }\r\n        }\r\n        return true;\r\n      }\r\n\r\n      function forwardTouch() {\r\n        var i, j;\r\n        var n=nNodes, m, ix; // ix is the index of the global connections.\r\n        var theNode;\r\n\r\n        for (i=0;i<n;i++) {\r\n          if (touched[i] === 0) {\r\n            theNode = nodeConnections[i];\r\n            for (j=0,m=theNode.length;j<m;j++) {\r\n              ix = theNode[j];\r\n              if (touched[connections[ix][0]] === 1) {\r\n                //console.log('node '+connections[ix][0]+' is touched, so now node '+i+' has been touched');\r\n                touched[i] = 2; // temp touch state\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        for (i=0;i<n;i++) {\r\n          if (touched[i] === 2) touched[i] = 1;\r\n        }\r\n\r\n      }\r\n\r\n      // forward tick magic\r\n      function forwardTick(model) {\r\n        var i, j;\r\n        var n, m, cIndex, nIndex; // ix is the index of the global connections.\r\n        var theNode;\r\n\r\n        var currNode, currOperand, currConnection; // recurrent js objects\r\n        var needOperation; // don't need operation if node is operator(node) is null or mul or add\r\n        var nodeType;\r\n        var finOp; // operator after all operands are weighted summed or multiplied\r\n        var op; // either 'add' or 'eltmult'\r\n        var out; // temp variable for storing recurrentjs state\r\n        var cumulate; // cumulate all the outs (either addition or mult)\r\n\r\n        n=nNodes;\r\n        for (i=0;i<n;i++) {\r\n          if (touched[i] === 1) { // operate on this node since it has been touched\r\n\r\n            theNode = nodeConnections[i];\r\n            m=theNode.length;\r\n            // if there are no operands for this node, then don't do anything.\r\n            if (m === 0) continue;\r\n\r\n            nodeType = nodes[i];\r\n            needOperation = true;\r\n            finOp = operators[nodeType];\r\n            if (finOp === null || finOp === 'mult' || finOp === 'add' || nodeType === NODE_MGAUSSIAN) needOperation = false;\r\n\r\n            // usually we add weighted sum of operands, except if operator is mult\r\n            op = 'add';\r\n            if (finOp === 'mult') op = 'eltmul';\r\n\r\n            // cumulate all the operands\r\n            for (j=0;j<m;j++) {\r\n              cIndex = theNode[j];\r\n              nIndex = connections[cIndex][0];\r\n              currConnection = model.connections[cIndex];\r\n              currOperand = model.nodes[nIndex];\r\n              out = G.mul(currOperand, currConnection);\r\n              if (nodeType === NODE_MGAUSSIAN) { // special case:  the nasty multi gaussian\r\n                out = G.gaussian(out);\r\n              }\r\n              if (j === 0) { // assign first result to cumulate\r\n                cumulate = out;\r\n              } else { // cumulate next result after first operand\r\n                cumulate = G[op](cumulate, out); // op is either add or eltmul\r\n              }\r\n            }\r\n\r\n            // set the recurrentjs node here\r\n            model.nodes[i] = cumulate;\r\n            // operate on cumulated sum or product if needed\r\n            if (needOperation) {\r\n              model.nodes[i] = G[finOp](model.nodes[i]);\r\n            }\r\n\r\n            // another special case, squaring the output\r\n            if (nodeType === NODE_SQUARE) {\r\n              model.nodes[i] = G.eltmul(model.nodes[i], model.nodes[i]);\r\n            }\r\n\r\n          }\r\n        }\r\n\r\n\r\n      }\r\n\r\n      function printTouched() {\r\n        var i;\r\n        var result=\"\";\r\n        for (i=0;i<touched.length;i++) {\r\n          result += touched[i]+\" \";\r\n        }\r\n        console.log(result);\r\n      }\r\n\r\n      //printTouched();\r\n      for (i=0;i<MAX_TICK;i++) {\r\n        forwardTouch();\r\n        forwardTick(this.model); // forward tick the network using graph\r\n        //printTouched();\r\n        /*\r\n        if (allTouched(outputNodeList)) {\r\n          //console.log('all outputs touched!');\r\n          //break;\r\n        }\r\n        */\r\n        if (allTouched(nodeList)) {\r\n          //console.log('all nodes touched!');\r\n          break;\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n  };\r\n\r\n  global.init = init;\r\n  global.Genome = Genome;\r\n  global.getNodes = getNodes;\r\n  global.getConnections = getConnections;\r\n  global.randomizeRenderMode = randomizeRenderMode;\r\n  global.setRenderMode = setRenderMode;\r\n  global.getRenderMode = getRenderMode;\r\n  global.getNumInput = function() { return nInput; };\r\n  global.getNumOutput = function() { return nOutput; };\r\n  export {getRandomRenderMode, Genome, init, randomizeRenderMode, getRandomActivation, getRenderMode};\r\n  \r\n// })(N);\r\n// (function(lib) {\r\n//   \"use strict\";\r\n//   if (typeof module === \"undefined\" || typeof module.exports === \"undefined\") {\r\n//     window.jsfeat = lib; // in ordinary browser attach library to window\r\n//   } else {\r\n//     module.exports = lib; // in nodejs\r\n//   }\r\n// })(N);\r\n\r\n\r\n/*\r\nN.init({nInput: 2, nOutput: 3});\r\n\r\nvar genome = new N.Genome();\r\nvar genome1 = new N.Genome();\r\nvar genome2 = new N.Genome();\r\n\r\nfor (var i=0;i<2;i++) {\r\n  genome.addRandomNode();\r\n  genome.addRandomConnection();\r\n  genome.addRandomConnection();\r\n  genome.addRandomConnection();\r\n  genome1.addRandomNode();\r\n  genome1.addRandomConnection();\r\n  genome1.addRandomConnection();\r\n  genome1.addRandomConnection();\r\n  genome2.addRandomNode();\r\n  genome1.addRandomConnection();\r\n  genome1.addRandomConnection();\r\n  genome1.addRandomConnection();\r\n}\r\n\r\n\r\nvar child = genome.crossover(genome1);\r\nvar child2 = child.crossover(genome2);\r\n\r\n//genome = child.crossover(child2);\r\n\r\n//console.log(genome);\r\n\r\nvar input = [[-0.5, -0.5]]; //, [0.25, 0.75], [-0.25, 0.5], [0.6, -0.6]];\r\n\r\ngenome.setupModel(input.length);\r\ngenome.setInput(input);\r\n\r\nvar G = new R.Graph();\r\n\r\ngenome.forward(G);\r\n\r\nvar output = genome.getOutput();\r\n\r\n\r\nvar i, j;\r\nfor (i=0;i<3;i++) {\r\n  for (j=0;j<1;j++) {\r\n    output[i].dw[j] = -Math.random();\r\n  }\r\n}\r\n\r\n\r\nconsole.log(output);\r\nconsole.log(genome.model);\r\nconsole.log('-----------');\r\n\r\nG.backward();\r\n\r\nconsole.log(output);\r\nconsole.log(genome.model);\r\n\r\n*/\r\n\r\n/* eslint-enable no-unused-vars */"],"mappings":"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","ignoreList":[]}]}