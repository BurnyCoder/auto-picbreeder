{"remainingRequest":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/node_modules/babel-loader/lib/index.js!/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/src/lib/convnet.js","dependencies":[{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/src/lib/convnet.js","mtime":1766857470847},{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/babel.config.js","mtime":1766857498915},{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/node_modules/cache-loader/dist/cjs.js","mtime":1766857611540},{"path":"/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/node_modules/babel-loader/lib/index.js","mtime":1766857611782}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmVycm9yLmNhdXNlLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS1idWZmZXIuZGV0YWNoZWQuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LWJ1ZmZlci50cmFuc2Zlci5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnRyYW5zZmVyLXRvLWZpeGVkLWxlbmd0aC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuYXQuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbmQtbGFzdC5qcyIpOwpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1sYXN0LWluZGV4LmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zZXQuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLXJldmVyc2VkLmpzIik7CnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS50by1zb3J0ZWQuanMiKTsKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LndpdGguanMiKTsKLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KLyogZXNsaW50LWRpc2FibGUgbm8tcmVkZWNsYXJlICovCgp2YXIgY29udm5ldGpzID0gY29udm5ldGpzIHx8IHsKICBSRVZJU0lPTjogJ0FMUEhBJwp9OwooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgLy8gUmFuZG9tIG51bWJlciB1dGlsaXRpZXMKICB2YXIgcmV0dXJuX3YgPSBmYWxzZTsKICB2YXIgdl92YWwgPSAwLjA7CiAgdmFyIGdhdXNzUmFuZG9tID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHJldHVybl92KSB7CiAgICAgIHJldHVybl92ID0gZmFsc2U7CiAgICAgIHJldHVybiB2X3ZhbDsKICAgIH0KICAgIHZhciB1ID0gMiAqIE1hdGgucmFuZG9tKCkgLSAxOwogICAgdmFyIHYgPSAyICogTWF0aC5yYW5kb20oKSAtIDE7CiAgICB2YXIgciA9IHUgKiB1ICsgdiAqIHY7CiAgICBpZiAociA9PSAwIHx8IHIgPiAxKSByZXR1cm4gZ2F1c3NSYW5kb20oKTsKICAgIHZhciBjID0gTWF0aC5zcXJ0KC0yICogTWF0aC5sb2cocikgLyByKTsKICAgIHZfdmFsID0gdiAqIGM7IC8vIGNhY2hlIHRoaXMKICAgIHJldHVybl92ID0gdHJ1ZTsKICAgIHJldHVybiB1ICogYzsKICB9OwogIHZhciByYW5kZiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICByZXR1cm4gTWF0aC5yYW5kb20oKSAqIChiIC0gYSkgKyBhOwogIH07CiAgdmFyIHJhbmRpID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoYiAtIGEpICsgYSk7CiAgfTsKICB2YXIgcmFuZG4gPSBmdW5jdGlvbiAobXUsIHN0ZCkgewogICAgcmV0dXJuIG11ICsgZ2F1c3NSYW5kb20oKSAqIHN0ZDsKICB9OwoKICAvLyBBcnJheSB1dGlsaXRpZXMKICB2YXIgemVyb3MgPSBmdW5jdGlvbiAobikgewogICAgaWYgKHR5cGVvZiBuID09PSAndW5kZWZpbmVkJyB8fCBpc05hTihuKSkgewogICAgICByZXR1cm4gW107CiAgICB9CiAgICBpZiAodHlwZW9mIEFycmF5QnVmZmVyID09PSAndW5kZWZpbmVkJykgewogICAgICAvLyBsYWNraW5nIGJyb3dzZXIgc3VwcG9ydAogICAgICB2YXIgYXJyID0gbmV3IEFycmF5KG4pOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgIGFycltpXSA9IDA7CiAgICAgIH0KICAgICAgcmV0dXJuIGFycjsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBuZXcgRmxvYXQ2NEFycmF5KG4pOwogICAgfQogIH07CiAgdmFyIGFyckNvbnRhaW5zID0gZnVuY3Rpb24gKGFyciwgZWx0KSB7CiAgICBmb3IgKHZhciBpID0gMCwgbiA9IGFyci5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgaWYgKGFycltpXSA9PT0gZWx0KSByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwogIHZhciBhcnJVbmlxdWUgPSBmdW5jdGlvbiAoYXJyKSB7CiAgICB2YXIgYiA9IFtdOwogICAgZm9yICh2YXIgaSA9IDAsIG4gPSBhcnIubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIGlmICghYXJyQ29udGFpbnMoYiwgYXJyW2ldKSkgewogICAgICAgIGIucHVzaChhcnJbaV0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYjsKICB9OwoKICAvLyByZXR1cm4gbWF4IGFuZCBtaW4gb2YgYSBnaXZlbiBub24tZW1wdHkgYXJyYXkuCiAgdmFyIG1heG1pbiA9IGZ1bmN0aW9uICh3KSB7CiAgICBpZiAody5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHt9OwogICAgfSAvLyAuLi4gO3MKICAgIHZhciBtYXh2ID0gd1swXTsKICAgIHZhciBtaW52ID0gd1swXTsKICAgIHZhciBtYXhpID0gMDsKICAgIHZhciBtaW5pID0gMDsKICAgIHZhciBuID0gdy5sZW5ndGg7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IG47IGkrKykgewogICAgICBpZiAod1tpXSA+IG1heHYpIHsKICAgICAgICBtYXh2ID0gd1tpXTsKICAgICAgICBtYXhpID0gaTsKICAgICAgfQogICAgICBpZiAod1tpXSA8IG1pbnYpIHsKICAgICAgICBtaW52ID0gd1tpXTsKICAgICAgICBtaW5pID0gaTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgbWF4aTogbWF4aSwKICAgICAgbWF4djogbWF4diwKICAgICAgbWluaTogbWluaSwKICAgICAgbWludjogbWludiwKICAgICAgZHY6IG1heHYgLSBtaW52CiAgICB9OwogIH07CgogIC8vIGNyZWF0ZSByYW5kb20gcGVybXV0YXRpb24gb2YgbnVtYmVycywgaW4gcmFuZ2UgWzAuLi5uLTFdCiAgdmFyIHJhbmRwZXJtID0gZnVuY3Rpb24gKG4pIHsKICAgIHZhciBpID0gbiwKICAgICAgaiA9IDAsCiAgICAgIHRlbXA7CiAgICB2YXIgYXJyYXkgPSBbXTsKICAgIGZvciAodmFyIHEgPSAwOyBxIDwgbjsgcSsrKSBhcnJheVtxXSA9IHE7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaSArIDEpKTsKICAgICAgdGVtcCA9IGFycmF5W2ldOwogICAgICBhcnJheVtpXSA9IGFycmF5W2pdOwogICAgICBhcnJheVtqXSA9IHRlbXA7CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfTsKCiAgLy8gc2FtcGxlIGZyb20gbGlzdCBsc3QgYWNjb3JkaW5nIHRvIHByb2JhYmlsaXRpZXMgaW4gbGlzdCBwcm9icwogIC8vIHRoZSB0d28gbGlzdHMgYXJlIG9mIHNhbWUgc2l6ZSwgYW5kIHByb2JzIGFkZHMgdXAgdG8gMQogIHZhciB3ZWlnaHRlZFNhbXBsZSA9IGZ1bmN0aW9uIChsc3QsIHByb2JzKSB7CiAgICB2YXIgcCA9IHJhbmRmKDAsIDEuMCk7CiAgICB2YXIgY3VtcHJvYiA9IDAuMDsKICAgIGZvciAodmFyIGsgPSAwLCBuID0gbHN0Lmxlbmd0aDsgayA8IG47IGsrKykgewogICAgICBjdW1wcm9iICs9IHByb2JzW2tdOwogICAgICBpZiAocCA8IGN1bXByb2IpIHsKICAgICAgICByZXR1cm4gbHN0W2tdOwogICAgICB9CiAgICB9CiAgfTsKCiAgLy8gc3ludGFjdGljIHN1Z2FyIGZ1bmN0aW9uIGZvciBnZXR0aW5nIGRlZmF1bHQgcGFyYW1ldGVyIHZhbHVlcwogIHZhciBnZXRvcHQgPSBmdW5jdGlvbiAob3B0LCBmaWVsZF9uYW1lLCBkZWZhdWx0X3ZhbHVlKSB7CiAgICBpZiAodHlwZW9mIGZpZWxkX25hbWUgPT09ICdzdHJpbmcnKSB7CiAgICAgIC8vIGNhc2Ugb2Ygc2luZ2xlIHN0cmluZwogICAgICByZXR1cm4gdHlwZW9mIG9wdFtmaWVsZF9uYW1lXSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRbZmllbGRfbmFtZV0gOiBkZWZhdWx0X3ZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgLy8gYXNzdW1lIHdlIGFyZSBnaXZlbiBhIGxpc3Qgb2Ygc3RyaW5nIGluc3RlYWQKICAgICAgdmFyIHJldCA9IGRlZmF1bHRfdmFsdWU7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmllbGRfbmFtZS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBmID0gZmllbGRfbmFtZVtpXTsKICAgICAgICBpZiAodHlwZW9mIG9wdFtmXSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHJldCA9IG9wdFtmXTsgLy8gb3ZlcndyaXRlIHJldHVybiB2YWx1ZQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmV0OwogICAgfQogIH07CiAgZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSkgewogICAgaWYgKCFjb25kaXRpb24pIHsKICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UgfHwgIkFzc2VydGlvbiBmYWlsZWQiOwogICAgICBpZiAodHlwZW9mIEVycm9yICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgfQogICAgICB0aHJvdyBtZXNzYWdlOyAvLyBGYWxsYmFjawogICAgfQogIH0KICBnbG9iYWwucmFuZGYgPSByYW5kZjsKICBnbG9iYWwucmFuZGkgPSByYW5kaTsKICBnbG9iYWwucmFuZG4gPSByYW5kbjsKICBnbG9iYWwuemVyb3MgPSB6ZXJvczsKICBnbG9iYWwubWF4bWluID0gbWF4bWluOwogIGdsb2JhbC5yYW5kcGVybSA9IHJhbmRwZXJtOwogIGdsb2JhbC53ZWlnaHRlZFNhbXBsZSA9IHdlaWdodGVkU2FtcGxlOwogIGdsb2JhbC5hcnJVbmlxdWUgPSBhcnJVbmlxdWU7CiAgZ2xvYmFsLmFyckNvbnRhaW5zID0gYXJyQ29udGFpbnM7CiAgZ2xvYmFsLmdldG9wdCA9IGdldG9wdDsKICBnbG9iYWwuYXNzZXJ0ID0gYXNzZXJ0Owp9KShjb252bmV0anMpOwooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgLy8gVm9sIGlzIHRoZSBiYXNpYyBidWlsZGluZyBibG9jayBvZiBhbGwgZGF0YSBpbiBhIG5ldC4KICAvLyBpdCBpcyBlc3NlbnRpYWxseSBqdXN0IGEgM0Qgdm9sdW1lIG9mIG51bWJlcnMsIHdpdGggYQogIC8vIHdpZHRoIChzeCksIGhlaWdodCAoc3kpLCBhbmQgZGVwdGggKGRlcHRoKS4KICAvLyBpdCBpcyB1c2VkIHRvIGhvbGQgZGF0YSBmb3IgYWxsIGZpbHRlcnMsIGFsbCB2b2x1bWVzLAogIC8vIGFsbCB3ZWlnaHRzLCBhbmQgYWxzbyBzdG9yZXMgYWxsIGdyYWRpZW50cyB3LnIudC4gCiAgLy8gdGhlIGRhdGEuIGMgaXMgb3B0aW9uYWxseSBhIHZhbHVlIHRvIGluaXRpYWxpemUgdGhlIHZvbHVtZQogIC8vIHdpdGguIElmIGMgaXMgbWlzc2luZywgZmlsbHMgdGhlIFZvbCB3aXRoIHJhbmRvbSBudW1iZXJzLgogIHZhciBWb2wgPSBmdW5jdGlvbiAoc3gsIHN5LCBkZXB0aCwgYykgewogICAgLy8gdGhpcyBpcyBob3cgeW91IGNoZWNrIGlmIGEgdmFyaWFibGUgaXMgYW4gYXJyYXkuIE9oLCBKYXZhc2NyaXB0IDopCiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHN4KSA9PT0gJ1tvYmplY3QgQXJyYXldJykgewogICAgICAvLyB3ZSB3ZXJlIGdpdmVuIGEgbGlzdCBpbiBzeCwgYXNzdW1lIDFEIHZvbHVtZSBhbmQgZmlsbCBpdCB1cAogICAgICB0aGlzLnN4ID0gMTsKICAgICAgdGhpcy5zeSA9IDE7CiAgICAgIHRoaXMuZGVwdGggPSBzeC5sZW5ndGg7CiAgICAgIC8vIHdlIGhhdmUgdG8gZG8gdGhlIGZvbGxvd2luZyBjb3B5IGJlY2F1c2Ugd2Ugd2FudCB0byB1c2UKICAgICAgLy8gZmFzdCB0eXBlZCBhcnJheXMsIG5vdCBhbiBvcmRpbmFyeSBqYXZhc2NyaXB0IGFycmF5CiAgICAgIHRoaXMudyA9IGdsb2JhbC56ZXJvcyh0aGlzLmRlcHRoKTsKICAgICAgdGhpcy5kdyA9IGdsb2JhbC56ZXJvcyh0aGlzLmRlcHRoKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmRlcHRoOyBpKyspIHsKICAgICAgICB0aGlzLndbaV0gPSBzeFtpXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gd2Ugd2VyZSBnaXZlbiBkaW1lbnNpb25zIG9mIHRoZSB2b2wKICAgICAgdGhpcy5zeCA9IHN4OwogICAgICB0aGlzLnN5ID0gc3k7CiAgICAgIHRoaXMuZGVwdGggPSBkZXB0aDsKICAgICAgdmFyIG4gPSBzeCAqIHN5ICogZGVwdGg7CiAgICAgIHRoaXMudyA9IGdsb2JhbC56ZXJvcyhuKTsKICAgICAgdGhpcy5kdyA9IGdsb2JhbC56ZXJvcyhuKTsKICAgICAgaWYgKHR5cGVvZiBjID09PSAndW5kZWZpbmVkJykgewogICAgICAgIC8vIHdlaWdodCBub3JtYWxpemF0aW9uIGlzIGRvbmUgdG8gZXF1YWxpemUgdGhlIG91dHB1dAogICAgICAgIC8vIHZhcmlhbmNlIG9mIGV2ZXJ5IG5ldXJvbiwgb3RoZXJ3aXNlIG5ldXJvbnMgd2l0aCBhIGxvdAogICAgICAgIC8vIG9mIGluY29taW5nIGNvbm5lY3Rpb25zIGhhdmUgb3V0cHV0cyBvZiBsYXJnZXIgdmFyaWFuY2UKICAgICAgICB2YXIgc2NhbGUgPSBNYXRoLnNxcnQoMS4wIC8gKHN4ICogc3kgKiBkZXB0aCkpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICB0aGlzLndbaV0gPSBnbG9iYWwucmFuZG4oMC4wLCBzY2FsZSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICB0aGlzLndbaV0gPSBjOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CiAgVm9sLnByb3RvdHlwZSA9IHsKICAgIGdldDogZnVuY3Rpb24gKHgsIHksIGQpIHsKICAgICAgdmFyIGl4ID0gKHRoaXMuc3ggKiB5ICsgeCkgKiB0aGlzLmRlcHRoICsgZDsKICAgICAgcmV0dXJuIHRoaXMud1tpeF07CiAgICB9LAogICAgc2V0OiBmdW5jdGlvbiAoeCwgeSwgZCwgdikgewogICAgICB2YXIgaXggPSAodGhpcy5zeCAqIHkgKyB4KSAqIHRoaXMuZGVwdGggKyBkOwogICAgICB0aGlzLndbaXhdID0gdjsKICAgIH0sCiAgICBhZGQ6IGZ1bmN0aW9uICh4LCB5LCBkLCB2KSB7CiAgICAgIHZhciBpeCA9ICh0aGlzLnN4ICogeSArIHgpICogdGhpcy5kZXB0aCArIGQ7CiAgICAgIHRoaXMud1tpeF0gKz0gdjsKICAgIH0sCiAgICBnZXRfZ3JhZDogZnVuY3Rpb24gKHgsIHksIGQpIHsKICAgICAgdmFyIGl4ID0gKHRoaXMuc3ggKiB5ICsgeCkgKiB0aGlzLmRlcHRoICsgZDsKICAgICAgcmV0dXJuIHRoaXMuZHdbaXhdOwogICAgfSwKICAgIHNldF9ncmFkOiBmdW5jdGlvbiAoeCwgeSwgZCwgdikgewogICAgICB2YXIgaXggPSAodGhpcy5zeCAqIHkgKyB4KSAqIHRoaXMuZGVwdGggKyBkOwogICAgICB0aGlzLmR3W2l4XSA9IHY7CiAgICB9LAogICAgYWRkX2dyYWQ6IGZ1bmN0aW9uICh4LCB5LCBkLCB2KSB7CiAgICAgIHZhciBpeCA9ICh0aGlzLnN4ICogeSArIHgpICogdGhpcy5kZXB0aCArIGQ7CiAgICAgIHRoaXMuZHdbaXhdICs9IHY7CiAgICB9LAogICAgY2xvbmVBbmRaZXJvOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBuZXcgVm9sKHRoaXMuc3gsIHRoaXMuc3ksIHRoaXMuZGVwdGgsIDAuMCk7CiAgICB9LAogICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIFYgPSBuZXcgVm9sKHRoaXMuc3gsIHRoaXMuc3ksIHRoaXMuZGVwdGgsIDAuMCk7CiAgICAgIHZhciBuID0gdGhpcy53Lmxlbmd0aDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICBWLndbaV0gPSB0aGlzLndbaV07CiAgICAgIH0KICAgICAgcmV0dXJuIFY7CiAgICB9LAogICAgYWRkRnJvbTogZnVuY3Rpb24gKFYpIHsKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLncubGVuZ3RoOyBrKyspIHsKICAgICAgICB0aGlzLndba10gKz0gVi53W2tdOwogICAgICB9CiAgICB9LAogICAgYWRkRnJvbVNjYWxlZDogZnVuY3Rpb24gKFYsIGEpIHsKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLncubGVuZ3RoOyBrKyspIHsKICAgICAgICB0aGlzLndba10gKz0gYSAqIFYud1trXTsKICAgICAgfQogICAgfSwKICAgIHNldENvbnN0OiBmdW5jdGlvbiAoYSkgewogICAgICBmb3IgKHZhciBrID0gMDsgayA8IHRoaXMudy5sZW5ndGg7IGsrKykgewogICAgICAgIHRoaXMud1trXSA9IGE7CiAgICAgIH0KICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gdG9kbzogd2UgbWF5IHdhbnQgdG8gb25seSBzYXZlIGQgbW9zdCBzaWduaWZpY2FudCBkaWdpdHMgdG8gc2F2ZSBzcGFjZQogICAgICB2YXIganNvbiA9IHt9OwogICAgICBqc29uLnN4ID0gdGhpcy5zeDsKICAgICAganNvbi5zeSA9IHRoaXMuc3k7CiAgICAgIGpzb24uZGVwdGggPSB0aGlzLmRlcHRoOwogICAgICBqc29uLncgPSB0aGlzLnc7CiAgICAgIHJldHVybiBqc29uOwogICAgICAvLyB3ZSB3b250IGJhY2sgdXAgZ3JhZGllbnRzIHRvIHNhdmUgc3BhY2UKICAgIH0sCiAgICBmcm9tSlNPTjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdGhpcy5zeCA9IGpzb24uc3g7CiAgICAgIHRoaXMuc3kgPSBqc29uLnN5OwogICAgICB0aGlzLmRlcHRoID0ganNvbi5kZXB0aDsKICAgICAgdmFyIG4gPSB0aGlzLnN4ICogdGhpcy5zeSAqIHRoaXMuZGVwdGg7CiAgICAgIHRoaXMudyA9IGdsb2JhbC56ZXJvcyhuKTsKICAgICAgdGhpcy5kdyA9IGdsb2JhbC56ZXJvcyhuKTsKICAgICAgLy8gY29weSBvdmVyIHRoZSBlbGVtZW50cy4KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICB0aGlzLndbaV0gPSBqc29uLndbaV07CiAgICAgIH0KICAgIH0KICB9OwogIGdsb2JhbC5Wb2wgPSBWb2w7Cn0pKGNvbnZuZXRqcyk7CihmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgVm9sID0gZ2xvYmFsLlZvbDsgLy8gY29udmVuaWVuY2UKCiAgLy8gVm9sdW1lIHV0aWxpdGllcwogIC8vIGludGVuZGVkIGZvciB1c2Ugd2l0aCBkYXRhIGF1Z21lbnRhdGlvbgogIC8vIGNyb3AgaXMgdGhlIHNpemUgb2Ygb3V0cHV0CiAgLy8gZHgsZHkgYXJlIG9mZnNldCB3cnQgaW5jb21pbmcgdm9sdW1lLCBvZiB0aGUgc2hpZnQKICAvLyBmbGlwbHIgaXMgYm9vbGVhbiBvbiB3aGV0aGVyIHdlIGFsc28gd2FudCB0byBmbGlwIGxlZnQ8LT5yaWdodAogIHZhciBhdWdtZW50ID0gZnVuY3Rpb24gKFYsIGNyb3AsIGR4LCBkeSwgZmxpcGxyKSB7CiAgICAvLyBub3RlIGFzc3VtZXMgc3F1YXJlIG91dHB1dHMgb2Ygc2l6ZSBjcm9wIHggY3JvcAogICAgaWYgKHR5cGVvZiBmbGlwbHIgPT09ICd1bmRlZmluZWQnKSB2YXIgZmxpcGxyID0gZmFsc2U7CiAgICBpZiAodHlwZW9mIGR4ID09PSAndW5kZWZpbmVkJykgdmFyIGR4ID0gZ2xvYmFsLnJhbmRpKDAsIFYuc3ggLSBjcm9wKTsKICAgIGlmICh0eXBlb2YgZHkgPT09ICd1bmRlZmluZWQnKSB2YXIgZHkgPSBnbG9iYWwucmFuZGkoMCwgVi5zeSAtIGNyb3ApOwoKICAgIC8vIHJhbmRvbWx5IHNhbXBsZSBhIGNyb3AgaW4gdGhlIGlucHV0IHZvbHVtZQogICAgdmFyIFc7CiAgICBpZiAoY3JvcCAhPT0gVi5zeCB8fCBkeCAhPT0gMCB8fCBkeSAhPT0gMCkgewogICAgICBXID0gbmV3IFZvbChjcm9wLCBjcm9wLCBWLmRlcHRoLCAwLjApOwogICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IGNyb3A7IHgrKykgewogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgY3JvcDsgeSsrKSB7CiAgICAgICAgICBpZiAoeCArIGR4IDwgMCB8fCB4ICsgZHggPj0gVi5zeCB8fCB5ICsgZHkgPCAwIHx8IHkgKyBkeSA+PSBWLnN5KSBjb250aW51ZTsgLy8gb29iCiAgICAgICAgICBmb3IgKHZhciBkID0gMDsgZCA8IFYuZGVwdGg7IGQrKykgewogICAgICAgICAgICBXLnNldCh4LCB5LCBkLCBWLmdldCh4ICsgZHgsIHkgKyBkeSwgZCkpOyAvLyBjb3B5IGRhdGEgb3ZlcgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgVyA9IFY7CiAgICB9CiAgICBpZiAoZmxpcGxyKSB7CiAgICAgIC8vIGZsaXAgdm9sdW1lIGhvcnppb250YWxseQogICAgICB2YXIgVzIgPSBXLmNsb25lQW5kWmVybygpOwogICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IFcuc3g7IHgrKykgewogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgVy5zeTsgeSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBkID0gMDsgZCA8IFcuZGVwdGg7IGQrKykgewogICAgICAgICAgICBXMi5zZXQoeCwgeSwgZCwgVy5nZXQoVy5zeCAtIHggLSAxLCB5LCBkKSk7IC8vIGNvcHkgZGF0YSBvdmVyCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIFcgPSBXMjsgLy9zd2FwCiAgICB9CiAgICByZXR1cm4gVzsKICB9OwoKICAvLyBpbWcgaXMgYSBET00gZWxlbWVudCB0aGF0IGNvbnRhaW5zIGEgbG9hZGVkIGltYWdlCiAgLy8gcmV0dXJucyBhIFZvbCBvZiBzaXplIChXLCBILCA0KS4gNCBpcyBmb3IgUkdCQQogIHZhciBpbWdfdG9fdm9sID0gZnVuY3Rpb24gKGltZywgY29udmVydF9ncmF5c2NhbGUpIHsKICAgIGlmICh0eXBlb2YgY29udmVydF9ncmF5c2NhbGUgPT09ICd1bmRlZmluZWQnKSB2YXIgY29udmVydF9ncmF5c2NhbGUgPSBmYWxzZTsKICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgIGNhbnZhcy53aWR0aCA9IGltZy53aWR0aDsKICAgIGNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0OwogICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwoKICAgIC8vIGR1ZSB0byBhIEZpcmVmb3ggYnVnCiAgICB0cnkgewogICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmIChlLm5hbWUgPT09ICJOU19FUlJPUl9OT1RfQVZBSUxBQkxFIikgewogICAgICAgIC8vIHNvbWV0aW1lcyBoYXBwZW5zLCBsZXRzIGp1c3QgYWJvcnQKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgZTsKICAgICAgfQogICAgfQogICAgdHJ5IHsKICAgICAgdmFyIGltZ19kYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAoZS5uYW1lID09PSAnSW5kZXhTaXplRXJyb3InKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBub3Qgc3VyZSB3aGF0IGNhdXNlcyB0aGlzIHNvbWV0aW1lcyBidXQgb2theSBhYm9ydAogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IGU7CiAgICAgIH0KICAgIH0KCiAgICAvLyBwcmVwYXJlIHRoZSBpbnB1dDogZ2V0IHBpeGVscyBhbmQgbm9ybWFsaXplIHRoZW0KICAgIHZhciBwID0gaW1nX2RhdGEuZGF0YTsKICAgIHZhciBXID0gaW1nLndpZHRoOwogICAgdmFyIEggPSBpbWcuaGVpZ2h0OwogICAgdmFyIHB2ID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHAubGVuZ3RoOyBpKyspIHsKICAgICAgcHYucHVzaChwW2ldIC8gMjU1LjAgLSAwLjUpOyAvLyBub3JtYWxpemUgaW1hZ2UgcGl4ZWxzIHRvIFstMC41LCAwLjVdCiAgICB9CiAgICB2YXIgeCA9IG5ldyBWb2woVywgSCwgNCwgMC4wKTsgLy9pbnB1dCB2b2x1bWUgKGltYWdlKQogICAgeC53ID0gcHY7CiAgICBpZiAoY29udmVydF9ncmF5c2NhbGUpIHsKICAgICAgLy8gZmxhdHRlbiBpbnRvIGRlcHRoPTEgYXJyYXkKICAgICAgdmFyIHgxID0gbmV3IFZvbChXLCBILCAxLCAwLjApOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IFc7IGkrKykgewogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgSDsgaisrKSB7CiAgICAgICAgICB4MS5zZXQoaSwgaiwgMCwgeC5nZXQoaSwgaiwgMCkpOwogICAgICAgIH0KICAgICAgfQogICAgICB4ID0geDE7CiAgICB9CiAgICByZXR1cm4geDsKICB9OwogIGdsb2JhbC5hdWdtZW50ID0gYXVnbWVudDsKICBnbG9iYWwuaW1nX3RvX3ZvbCA9IGltZ190b192b2w7Cn0pKGNvbnZuZXRqcyk7CihmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgVm9sID0gZ2xvYmFsLlZvbDsgLy8gY29udmVuaWVuY2UKCiAgLy8gVGhpcyBmaWxlIGNvbnRhaW5zIGFsbCBsYXllcnMgdGhhdCBkbyBkb3QgcHJvZHVjdHMgd2l0aCBpbnB1dCwKICAvLyBidXQgdXN1YWxseSBpbiBhIGRpZmZlcmVudCBjb25uZWN0aXZpdHkgcGF0dGVybiBhbmQgd2VpZ2h0IHNoYXJpbmcKICAvLyBzY2hlbWVzOiAKICAvLyAtIEZ1bGx5Q29ubiBpcyBmdWxseSBjb25uZWN0ZWQgZG90IHByb2R1Y3RzIAogIC8vIC0gQ29udkxheWVyIGRvZXMgY29udm9sdXRpb25zIChzbyB3ZWlnaHQgc2hhcmluZyBzcGF0aWFsbHkpCiAgLy8gcHV0dGluZyB0aGVtIHRvZ2V0aGVyIGluIG9uZSBmaWxlIGJlY2F1c2UgdGhleSBhcmUgdmVyeSBzaW1pbGFyCiAgdmFyIENvbnZMYXllciA9IGZ1bmN0aW9uIChvcHQpIHsKICAgIHZhciBvcHQgPSBvcHQgfHwge307CgogICAgLy8gcmVxdWlyZWQKICAgIHRoaXMub3V0X2RlcHRoID0gb3B0LmZpbHRlcnM7CiAgICB0aGlzLnN4ID0gb3B0LnN4OyAvLyBmaWx0ZXIgc2l6ZS4gU2hvdWxkIGJlIG9kZCBpZiBwb3NzaWJsZSwgaXQncyBjbGVhbmVyLgogICAgdGhpcy5pbl9kZXB0aCA9IG9wdC5pbl9kZXB0aDsKICAgIHRoaXMuaW5fc3ggPSBvcHQuaW5fc3g7CiAgICB0aGlzLmluX3N5ID0gb3B0LmluX3N5OwoKICAgIC8vIG9wdGlvbmFsCiAgICB0aGlzLnN5ID0gdHlwZW9mIG9wdC5zeSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHQuc3kgOiB0aGlzLnN4OwogICAgdGhpcy5zdHJpZGUgPSB0eXBlb2Ygb3B0LnN0cmlkZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHQuc3RyaWRlIDogMTsgLy8gc3RyaWRlIGF0IHdoaWNoIHdlIGFwcGx5IGZpbHRlcnMgdG8gaW5wdXQgdm9sdW1lCiAgICB0aGlzLnBhZCA9IHR5cGVvZiBvcHQucGFkICE9PSAndW5kZWZpbmVkJyA/IG9wdC5wYWQgOiAwOyAvLyBhbW91bnQgb2YgMCBwYWRkaW5nIHRvIGFkZCBhcm91bmQgYm9yZGVycyBvZiBpbnB1dCB2b2x1bWUKICAgIHRoaXMubDFfZGVjYXlfbXVsID0gdHlwZW9mIG9wdC5sMV9kZWNheV9tdWwgIT09ICd1bmRlZmluZWQnID8gb3B0LmwxX2RlY2F5X211bCA6IDAuMDsKICAgIHRoaXMubDJfZGVjYXlfbXVsID0gdHlwZW9mIG9wdC5sMl9kZWNheV9tdWwgIT09ICd1bmRlZmluZWQnID8gb3B0LmwyX2RlY2F5X211bCA6IDEuMDsKCiAgICAvLyBjb21wdXRlZAogICAgLy8gbm90ZSB3ZSBhcmUgZG9pbmcgZmxvb3IsIHNvIGlmIHRoZSBzdHJpZGVkIGNvbnZvbHV0aW9uIG9mIHRoZSBmaWx0ZXIgZG9lc250IGZpdCBpbnRvIHRoZSBpbnB1dAogICAgLy8gdm9sdW1lIGV4YWN0bHksIHRoZSBvdXRwdXQgdm9sdW1lIHdpbGwgYmUgdHJpbW1lZCBhbmQgbm90IGNvbnRhaW4gdGhlIChpbmNvbXBsZXRlKSBjb21wdXRlZAogICAgLy8gZmluYWwgYXBwbGljYXRpb24uCiAgICB0aGlzLm91dF9zeCA9IE1hdGguZmxvb3IoKHRoaXMuaW5fc3ggKyB0aGlzLnBhZCAqIDIgLSB0aGlzLnN4KSAvIHRoaXMuc3RyaWRlICsgMSk7CiAgICB0aGlzLm91dF9zeSA9IE1hdGguZmxvb3IoKHRoaXMuaW5fc3kgKyB0aGlzLnBhZCAqIDIgLSB0aGlzLnN5KSAvIHRoaXMuc3RyaWRlICsgMSk7CiAgICB0aGlzLmxheWVyX3R5cGUgPSAnY29udic7CgogICAgLy8gaW5pdGlhbGl6YXRpb25zCiAgICB2YXIgYmlhcyA9IHR5cGVvZiBvcHQuYmlhc19wcmVmICE9PSAndW5kZWZpbmVkJyA/IG9wdC5iaWFzX3ByZWYgOiAwLjA7CiAgICB0aGlzLmZpbHRlcnMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICB0aGlzLmZpbHRlcnMucHVzaChuZXcgVm9sKHRoaXMuc3gsIHRoaXMuc3ksIHRoaXMuaW5fZGVwdGgpKTsKICAgIH0KICAgIHRoaXMuYmlhc2VzID0gbmV3IFZvbCgxLCAxLCB0aGlzLm91dF9kZXB0aCwgYmlhcyk7CiAgfTsKICBDb252TGF5ZXIucHJvdG90eXBlID0gewogICAgZm9yd2FyZDogZnVuY3Rpb24gKFYsIGlzX3RyYWluaW5nKSB7CiAgICAgIC8vIG9wdGltaXplZCBjb2RlIGJ5IEBtZGRhIHRoYXQgYWNoaWV2ZXMgMnggc3BlZWR1cCBvdmVyIHByZXZpb3VzIHZlcnNpb24KCiAgICAgIHRoaXMuaW5fYWN0ID0gVjsKICAgICAgdmFyIEEgPSBuZXcgVm9sKHRoaXMub3V0X3N4IHwgMCwgdGhpcy5vdXRfc3kgfCAwLCB0aGlzLm91dF9kZXB0aCB8IDAsIDAuMCk7CiAgICAgIHZhciBWX3N4ID0gVi5zeCB8IDA7CiAgICAgIHZhciBWX3N5ID0gVi5zeSB8IDA7CiAgICAgIHZhciB4eV9zdHJpZGUgPSB0aGlzLnN0cmlkZSB8IDA7CiAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgdGhpcy5vdXRfZGVwdGg7IGQrKykgewogICAgICAgIHZhciBmID0gdGhpcy5maWx0ZXJzW2RdOwogICAgICAgIHZhciB4ID0gLXRoaXMucGFkIHwgMDsKICAgICAgICB2YXIgeSA9IC10aGlzLnBhZCB8IDA7CiAgICAgICAgZm9yICh2YXIgYXkgPSAwOyBheSA8IHRoaXMub3V0X3N5OyB5ICs9IHh5X3N0cmlkZSwgYXkrKykgewogICAgICAgICAgLy8geHlfc3RyaWRlCiAgICAgICAgICB4ID0gLXRoaXMucGFkIHwgMDsKICAgICAgICAgIGZvciAodmFyIGF4ID0gMDsgYXggPCB0aGlzLm91dF9zeDsgeCArPSB4eV9zdHJpZGUsIGF4KyspIHsKICAgICAgICAgICAgLy8geHlfc3RyaWRlCgogICAgICAgICAgICAvLyBjb252b2x2ZSBjZW50ZXJlZCBhdCB0aGlzIHBhcnRpY3VsYXIgbG9jYXRpb24KICAgICAgICAgICAgdmFyIGEgPSAwLjA7CiAgICAgICAgICAgIGZvciAodmFyIGZ5ID0gMDsgZnkgPCBmLnN5OyBmeSsrKSB7CiAgICAgICAgICAgICAgdmFyIG95ID0geSArIGZ5OyAvLyBjb29yZGluYXRlcyBpbiB0aGUgb3JpZ2luYWwgaW5wdXQgYXJyYXkgY29vcmRpbmF0ZXMKICAgICAgICAgICAgICBmb3IgKHZhciBmeCA9IDA7IGZ4IDwgZi5zeDsgZngrKykgewogICAgICAgICAgICAgICAgdmFyIG94ID0geCArIGZ4OwogICAgICAgICAgICAgICAgaWYgKG95ID49IDAgJiYgb3kgPCBWX3N5ICYmIG94ID49IDAgJiYgb3ggPCBWX3N4KSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGZkID0gMDsgZmQgPCBmLmRlcHRoOyBmZCsrKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gYXZvaWQgZnVuY3Rpb24gY2FsbCBvdmVyaGVhZCAoeDIpIGZvciBlZmZpY2llbmN5LCBjb21wcm9taXNlIG1vZHVsYXJpdHkgOigKICAgICAgICAgICAgICAgICAgICBhICs9IGYud1soZi5zeCAqIGZ5ICsgZngpICogZi5kZXB0aCArIGZkXSAqIFYud1soVl9zeCAqIG95ICsgb3gpICogVi5kZXB0aCArIGZkXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhICs9IHRoaXMuYmlhc2VzLndbZF07CiAgICAgICAgICAgIEEuc2V0KGF4LCBheSwgZCwgYSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3V0X2FjdCA9IEE7CiAgICAgIHJldHVybiB0aGlzLm91dF9hY3Q7CiAgICB9LAogICAgYmFja3dhcmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIFYgPSB0aGlzLmluX2FjdDsKICAgICAgVi5kdyA9IGdsb2JhbC56ZXJvcyhWLncubGVuZ3RoKTsgLy8gemVybyBvdXQgZ3JhZGllbnQgd3J0IGJvdHRvbSBkYXRhLCB3ZSdyZSBhYm91dCB0byBmaWxsIGl0CgogICAgICB2YXIgVl9zeCA9IFYuc3ggfCAwOwogICAgICB2YXIgVl9zeSA9IFYuc3kgfCAwOwogICAgICB2YXIgeHlfc3RyaWRlID0gdGhpcy5zdHJpZGUgfCAwOwogICAgICBmb3IgKHZhciBkID0gMDsgZCA8IHRoaXMub3V0X2RlcHRoOyBkKyspIHsKICAgICAgICB2YXIgZiA9IHRoaXMuZmlsdGVyc1tkXTsKICAgICAgICB2YXIgeCA9IC10aGlzLnBhZCB8IDA7CiAgICAgICAgdmFyIHkgPSAtdGhpcy5wYWQgfCAwOwogICAgICAgIGZvciAodmFyIGF5ID0gMDsgYXkgPCB0aGlzLm91dF9zeTsgeSArPSB4eV9zdHJpZGUsIGF5KyspIHsKICAgICAgICAgIC8vIHh5X3N0cmlkZQogICAgICAgICAgeCA9IC10aGlzLnBhZCB8IDA7CiAgICAgICAgICBmb3IgKHZhciBheCA9IDA7IGF4IDwgdGhpcy5vdXRfc3g7IHggKz0geHlfc3RyaWRlLCBheCsrKSB7CiAgICAgICAgICAgIC8vIHh5X3N0cmlkZQoKICAgICAgICAgICAgLy8gY29udm9sdmUgY2VudGVyZWQgYXQgdGhpcyBwYXJ0aWN1bGFyIGxvY2F0aW9uCiAgICAgICAgICAgIHZhciBjaGFpbl9ncmFkID0gdGhpcy5vdXRfYWN0LmdldF9ncmFkKGF4LCBheSwgZCk7IC8vIGdyYWRpZW50IGZyb20gYWJvdmUsIGZyb20gY2hhaW4gcnVsZQogICAgICAgICAgICBmb3IgKHZhciBmeSA9IDA7IGZ5IDwgZi5zeTsgZnkrKykgewogICAgICAgICAgICAgIHZhciBveSA9IHkgKyBmeTsgLy8gY29vcmRpbmF0ZXMgaW4gdGhlIG9yaWdpbmFsIGlucHV0IGFycmF5IGNvb3JkaW5hdGVzCiAgICAgICAgICAgICAgZm9yICh2YXIgZnggPSAwOyBmeCA8IGYuc3g7IGZ4KyspIHsKICAgICAgICAgICAgICAgIHZhciBveCA9IHggKyBmeDsKICAgICAgICAgICAgICAgIGlmIChveSA+PSAwICYmIG95IDwgVl9zeSAmJiBveCA+PSAwICYmIG94IDwgVl9zeCkgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBmZCA9IDA7IGZkIDwgZi5kZXB0aDsgZmQrKykgewogICAgICAgICAgICAgICAgICAgIC8vIGF2b2lkIGZ1bmN0aW9uIGNhbGwgb3ZlcmhlYWQgKHgyKSBmb3IgZWZmaWNpZW5jeSwgY29tcHJvbWlzZSBtb2R1bGFyaXR5IDooCiAgICAgICAgICAgICAgICAgICAgdmFyIGl4MSA9IChWX3N4ICogb3kgKyBveCkgKiBWLmRlcHRoICsgZmQ7CiAgICAgICAgICAgICAgICAgICAgdmFyIGl4MiA9IChmLnN4ICogZnkgKyBmeCkgKiBmLmRlcHRoICsgZmQ7CiAgICAgICAgICAgICAgICAgICAgZi5kd1tpeDJdICs9IFYud1tpeDFdICogY2hhaW5fZ3JhZDsKICAgICAgICAgICAgICAgICAgICBWLmR3W2l4MV0gKz0gZi53W2l4Ml0gKiBjaGFpbl9ncmFkOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYmlhc2VzLmR3W2RdICs9IGNoYWluX2dyYWQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZ2V0UGFyYW1zQW5kR3JhZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHJlc3BvbnNlID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICAgIHJlc3BvbnNlLnB1c2goewogICAgICAgICAgcGFyYW1zOiB0aGlzLmZpbHRlcnNbaV0udywKICAgICAgICAgIGdyYWRzOiB0aGlzLmZpbHRlcnNbaV0uZHcsCiAgICAgICAgICBsMl9kZWNheV9tdWw6IHRoaXMubDJfZGVjYXlfbXVsLAogICAgICAgICAgbDFfZGVjYXlfbXVsOiB0aGlzLmwxX2RlY2F5X211bAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJlc3BvbnNlLnB1c2goewogICAgICAgIHBhcmFtczogdGhpcy5iaWFzZXMudywKICAgICAgICBncmFkczogdGhpcy5iaWFzZXMuZHcsCiAgICAgICAgbDFfZGVjYXlfbXVsOiAwLjAsCiAgICAgICAgbDJfZGVjYXlfbXVsOiAwLjAKICAgICAgfSk7CiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGpzb24gPSB7fTsKICAgICAganNvbi5zeCA9IHRoaXMuc3g7IC8vIGZpbHRlciBzaXplIGluIHgsIHkgZGltcwogICAgICBqc29uLnN5ID0gdGhpcy5zeTsKICAgICAganNvbi5zdHJpZGUgPSB0aGlzLnN0cmlkZTsKICAgICAganNvbi5pbl9kZXB0aCA9IHRoaXMuaW5fZGVwdGg7CiAgICAgIGpzb24ub3V0X2RlcHRoID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIGpzb24ub3V0X3N4ID0gdGhpcy5vdXRfc3g7CiAgICAgIGpzb24ub3V0X3N5ID0gdGhpcy5vdXRfc3k7CiAgICAgIGpzb24ubGF5ZXJfdHlwZSA9IHRoaXMubGF5ZXJfdHlwZTsKICAgICAganNvbi5sMV9kZWNheV9tdWwgPSB0aGlzLmwxX2RlY2F5X211bDsKICAgICAganNvbi5sMl9kZWNheV9tdWwgPSB0aGlzLmwyX2RlY2F5X211bDsKICAgICAganNvbi5wYWQgPSB0aGlzLnBhZDsKICAgICAganNvbi5maWx0ZXJzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5maWx0ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAganNvbi5maWx0ZXJzLnB1c2godGhpcy5maWx0ZXJzW2ldLnRvSlNPTigpKTsKICAgICAgfQogICAgICBqc29uLmJpYXNlcyA9IHRoaXMuYmlhc2VzLnRvSlNPTigpOwogICAgICByZXR1cm4ganNvbjsKICAgIH0sCiAgICBmcm9tSlNPTjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdGhpcy5vdXRfZGVwdGggPSBqc29uLm91dF9kZXB0aDsKICAgICAgdGhpcy5vdXRfc3ggPSBqc29uLm91dF9zeDsKICAgICAgdGhpcy5vdXRfc3kgPSBqc29uLm91dF9zeTsKICAgICAgdGhpcy5sYXllcl90eXBlID0ganNvbi5sYXllcl90eXBlOwogICAgICB0aGlzLnN4ID0ganNvbi5zeDsgLy8gZmlsdGVyIHNpemUgaW4geCwgeSBkaW1zCiAgICAgIHRoaXMuc3kgPSBqc29uLnN5OwogICAgICB0aGlzLnN0cmlkZSA9IGpzb24uc3RyaWRlOwogICAgICB0aGlzLmluX2RlcHRoID0ganNvbi5pbl9kZXB0aDsgLy8gZGVwdGggb2YgaW5wdXQgdm9sdW1lCiAgICAgIHRoaXMuZmlsdGVycyA9IFtdOwogICAgICB0aGlzLmwxX2RlY2F5X211bCA9IHR5cGVvZiBqc29uLmwxX2RlY2F5X211bCAhPT0gJ3VuZGVmaW5lZCcgPyBqc29uLmwxX2RlY2F5X211bCA6IDEuMDsKICAgICAgdGhpcy5sMl9kZWNheV9tdWwgPSB0eXBlb2YganNvbi5sMl9kZWNheV9tdWwgIT09ICd1bmRlZmluZWQnID8ganNvbi5sMl9kZWNheV9tdWwgOiAxLjA7CiAgICAgIHRoaXMucGFkID0gdHlwZW9mIGpzb24ucGFkICE9PSAndW5kZWZpbmVkJyA/IGpzb24ucGFkIDogMDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqc29uLmZpbHRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgdiA9IG5ldyBWb2woMCwgMCwgMCwgMCk7CiAgICAgICAgdi5mcm9tSlNPTihqc29uLmZpbHRlcnNbaV0pOwogICAgICAgIHRoaXMuZmlsdGVycy5wdXNoKHYpOwogICAgICB9CiAgICAgIHRoaXMuYmlhc2VzID0gbmV3IFZvbCgwLCAwLCAwLCAwKTsKICAgICAgdGhpcy5iaWFzZXMuZnJvbUpTT04oanNvbi5iaWFzZXMpOwogICAgfQogIH07CiAgdmFyIEZ1bGx5Q29ubkxheWVyID0gZnVuY3Rpb24gKG9wdCkgewogICAgdmFyIG9wdCA9IG9wdCB8fCB7fTsKCiAgICAvLyByZXF1aXJlZAogICAgLy8gb2sgZmluZSB3ZSB3aWxsIGFsbG93ICdmaWx0ZXJzJyBhcyB0aGUgd29yZCBhcyB3ZWxsCiAgICB0aGlzLm91dF9kZXB0aCA9IHR5cGVvZiBvcHQubnVtX25ldXJvbnMgIT09ICd1bmRlZmluZWQnID8gb3B0Lm51bV9uZXVyb25zIDogb3B0LmZpbHRlcnM7CgogICAgLy8gb3B0aW9uYWwgCiAgICB0aGlzLmwxX2RlY2F5X211bCA9IHR5cGVvZiBvcHQubDFfZGVjYXlfbXVsICE9PSAndW5kZWZpbmVkJyA/IG9wdC5sMV9kZWNheV9tdWwgOiAwLjA7CiAgICB0aGlzLmwyX2RlY2F5X211bCA9IHR5cGVvZiBvcHQubDJfZGVjYXlfbXVsICE9PSAndW5kZWZpbmVkJyA/IG9wdC5sMl9kZWNheV9tdWwgOiAxLjA7CgogICAgLy8gY29tcHV0ZWQKICAgIHRoaXMubnVtX2lucHV0cyA9IG9wdC5pbl9zeCAqIG9wdC5pbl9zeSAqIG9wdC5pbl9kZXB0aDsKICAgIHRoaXMub3V0X3N4ID0gMTsKICAgIHRoaXMub3V0X3N5ID0gMTsKICAgIHRoaXMubGF5ZXJfdHlwZSA9ICdmYyc7CgogICAgLy8gaW5pdGlhbGl6YXRpb25zCiAgICB2YXIgYmlhcyA9IHR5cGVvZiBvcHQuYmlhc19wcmVmICE9PSAndW5kZWZpbmVkJyA/IG9wdC5iaWFzX3ByZWYgOiAwLjA7CiAgICB0aGlzLmZpbHRlcnMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICB0aGlzLmZpbHRlcnMucHVzaChuZXcgVm9sKDEsIDEsIHRoaXMubnVtX2lucHV0cykpOwogICAgfQogICAgdGhpcy5iaWFzZXMgPSBuZXcgVm9sKDEsIDEsIHRoaXMub3V0X2RlcHRoLCBiaWFzKTsKICB9OwogIEZ1bGx5Q29ubkxheWVyLnByb3RvdHlwZSA9IHsKICAgIGZvcndhcmQ6IGZ1bmN0aW9uIChWLCBpc190cmFpbmluZykgewogICAgICB0aGlzLmluX2FjdCA9IFY7CiAgICAgIHZhciBBID0gbmV3IFZvbCgxLCAxLCB0aGlzLm91dF9kZXB0aCwgMC4wKTsKICAgICAgdmFyIFZ3ID0gVi53OwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMub3V0X2RlcHRoOyBpKyspIHsKICAgICAgICB2YXIgYSA9IDAuMDsKICAgICAgICB2YXIgd2kgPSB0aGlzLmZpbHRlcnNbaV0udzsKICAgICAgICBmb3IgKHZhciBkID0gMDsgZCA8IHRoaXMubnVtX2lucHV0czsgZCsrKSB7CiAgICAgICAgICBhICs9IFZ3W2RdICogd2lbZF07IC8vIGZvciBlZmZpY2llbmN5IHVzZSBWb2xzIGRpcmVjdGx5IGZvciBub3cKICAgICAgICB9CiAgICAgICAgYSArPSB0aGlzLmJpYXNlcy53W2ldOwogICAgICAgIEEud1tpXSA9IGE7CiAgICAgIH0KICAgICAgdGhpcy5vdXRfYWN0ID0gQTsKICAgICAgcmV0dXJuIHRoaXMub3V0X2FjdDsKICAgIH0sCiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKCkgewogICAgICB2YXIgViA9IHRoaXMuaW5fYWN0OwogICAgICBWLmR3ID0gZ2xvYmFsLnplcm9zKFYudy5sZW5ndGgpOyAvLyB6ZXJvIG91dCB0aGUgZ3JhZGllbnQgaW4gaW5wdXQgVm9sCgogICAgICAvLyBjb21wdXRlIGdyYWRpZW50IHdydCB3ZWlnaHRzIGFuZCBkYXRhCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICAgIHZhciB0ZmkgPSB0aGlzLmZpbHRlcnNbaV07CiAgICAgICAgdmFyIGNoYWluX2dyYWQgPSB0aGlzLm91dF9hY3QuZHdbaV07CiAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCB0aGlzLm51bV9pbnB1dHM7IGQrKykgewogICAgICAgICAgVi5kd1tkXSArPSB0Zmkud1tkXSAqIGNoYWluX2dyYWQ7IC8vIGdyYWQgd3J0IGlucHV0IGRhdGEKICAgICAgICAgIHRmaS5kd1tkXSArPSBWLndbZF0gKiBjaGFpbl9ncmFkOyAvLyBncmFkIHdydCBwYXJhbXMKICAgICAgICB9CiAgICAgICAgdGhpcy5iaWFzZXMuZHdbaV0gKz0gY2hhaW5fZ3JhZDsKICAgICAgfQogICAgfSwKICAgIGdldFBhcmFtc0FuZEdyYWRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciByZXNwb25zZSA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMub3V0X2RlcHRoOyBpKyspIHsKICAgICAgICByZXNwb25zZS5wdXNoKHsKICAgICAgICAgIHBhcmFtczogdGhpcy5maWx0ZXJzW2ldLncsCiAgICAgICAgICBncmFkczogdGhpcy5maWx0ZXJzW2ldLmR3LAogICAgICAgICAgbDFfZGVjYXlfbXVsOiB0aGlzLmwxX2RlY2F5X211bCwKICAgICAgICAgIGwyX2RlY2F5X211bDogdGhpcy5sMl9kZWNheV9tdWwKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXNwb25zZS5wdXNoKHsKICAgICAgICBwYXJhbXM6IHRoaXMuYmlhc2VzLncsCiAgICAgICAgZ3JhZHM6IHRoaXMuYmlhc2VzLmR3LAogICAgICAgIGwxX2RlY2F5X211bDogMC4wLAogICAgICAgIGwyX2RlY2F5X211bDogMC4wCiAgICAgIH0pOwogICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9LAogICAgdG9KU09OOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBqc29uID0ge307CiAgICAgIGpzb24ub3V0X2RlcHRoID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIGpzb24ub3V0X3N4ID0gdGhpcy5vdXRfc3g7CiAgICAgIGpzb24ub3V0X3N5ID0gdGhpcy5vdXRfc3k7CiAgICAgIGpzb24ubGF5ZXJfdHlwZSA9IHRoaXMubGF5ZXJfdHlwZTsKICAgICAganNvbi5udW1faW5wdXRzID0gdGhpcy5udW1faW5wdXRzOwogICAgICBqc29uLmwxX2RlY2F5X211bCA9IHRoaXMubDFfZGVjYXlfbXVsOwogICAgICBqc29uLmwyX2RlY2F5X211bCA9IHRoaXMubDJfZGVjYXlfbXVsOwogICAgICBqc29uLmZpbHRlcnMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmZpbHRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBqc29uLmZpbHRlcnMucHVzaCh0aGlzLmZpbHRlcnNbaV0udG9KU09OKCkpOwogICAgICB9CiAgICAgIGpzb24uYmlhc2VzID0gdGhpcy5iaWFzZXMudG9KU09OKCk7CiAgICAgIHJldHVybiBqc29uOwogICAgfSwKICAgIGZyb21KU09OOiBmdW5jdGlvbiAoanNvbikgewogICAgICB0aGlzLm91dF9kZXB0aCA9IGpzb24ub3V0X2RlcHRoOwogICAgICB0aGlzLm91dF9zeCA9IGpzb24ub3V0X3N4OwogICAgICB0aGlzLm91dF9zeSA9IGpzb24ub3V0X3N5OwogICAgICB0aGlzLmxheWVyX3R5cGUgPSBqc29uLmxheWVyX3R5cGU7CiAgICAgIHRoaXMubnVtX2lucHV0cyA9IGpzb24ubnVtX2lucHV0czsKICAgICAgdGhpcy5sMV9kZWNheV9tdWwgPSB0eXBlb2YganNvbi5sMV9kZWNheV9tdWwgIT09ICd1bmRlZmluZWQnID8ganNvbi5sMV9kZWNheV9tdWwgOiAxLjA7CiAgICAgIHRoaXMubDJfZGVjYXlfbXVsID0gdHlwZW9mIGpzb24ubDJfZGVjYXlfbXVsICE9PSAndW5kZWZpbmVkJyA/IGpzb24ubDJfZGVjYXlfbXVsIDogMS4wOwogICAgICB0aGlzLmZpbHRlcnMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqc29uLmZpbHRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgdiA9IG5ldyBWb2woMCwgMCwgMCwgMCk7CiAgICAgICAgdi5mcm9tSlNPTihqc29uLmZpbHRlcnNbaV0pOwogICAgICAgIHRoaXMuZmlsdGVycy5wdXNoKHYpOwogICAgICB9CiAgICAgIHRoaXMuYmlhc2VzID0gbmV3IFZvbCgwLCAwLCAwLCAwKTsKICAgICAgdGhpcy5iaWFzZXMuZnJvbUpTT04oanNvbi5iaWFzZXMpOwogICAgfQogIH07CiAgZ2xvYmFsLkNvbnZMYXllciA9IENvbnZMYXllcjsKICBnbG9iYWwuRnVsbHlDb25uTGF5ZXIgPSBGdWxseUNvbm5MYXllcjsKfSkoY29udm5ldGpzKTsKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBWb2wgPSBnbG9iYWwuVm9sOyAvLyBjb252ZW5pZW5jZQoKICB2YXIgUG9vbExheWVyID0gZnVuY3Rpb24gKG9wdCkgewogICAgdmFyIG9wdCA9IG9wdCB8fCB7fTsKCiAgICAvLyByZXF1aXJlZAogICAgdGhpcy5zeCA9IG9wdC5zeDsgLy8gZmlsdGVyIHNpemUKICAgIHRoaXMuaW5fZGVwdGggPSBvcHQuaW5fZGVwdGg7CiAgICB0aGlzLmluX3N4ID0gb3B0LmluX3N4OwogICAgdGhpcy5pbl9zeSA9IG9wdC5pbl9zeTsKCiAgICAvLyBvcHRpb25hbAogICAgdGhpcy5zeSA9IHR5cGVvZiBvcHQuc3kgIT09ICd1bmRlZmluZWQnID8gb3B0LnN5IDogdGhpcy5zeDsKICAgIHRoaXMuc3RyaWRlID0gdHlwZW9mIG9wdC5zdHJpZGUgIT09ICd1bmRlZmluZWQnID8gb3B0LnN0cmlkZSA6IDI7CiAgICB0aGlzLnBhZCA9IHR5cGVvZiBvcHQucGFkICE9PSAndW5kZWZpbmVkJyA/IG9wdC5wYWQgOiAwOyAvLyBhbW91bnQgb2YgMCBwYWRkaW5nIHRvIGFkZCBhcm91bmQgYm9yZGVycyBvZiBpbnB1dCB2b2x1bWUKCiAgICAvLyBjb21wdXRlZAogICAgdGhpcy5vdXRfZGVwdGggPSB0aGlzLmluX2RlcHRoOwogICAgdGhpcy5vdXRfc3ggPSBNYXRoLmZsb29yKCh0aGlzLmluX3N4ICsgdGhpcy5wYWQgKiAyIC0gdGhpcy5zeCkgLyB0aGlzLnN0cmlkZSArIDEpOwogICAgdGhpcy5vdXRfc3kgPSBNYXRoLmZsb29yKCh0aGlzLmluX3N5ICsgdGhpcy5wYWQgKiAyIC0gdGhpcy5zeSkgLyB0aGlzLnN0cmlkZSArIDEpOwogICAgdGhpcy5sYXllcl90eXBlID0gJ3Bvb2wnOwogICAgLy8gc3RvcmUgc3dpdGNoZXMgZm9yIHgseSBjb29yZGluYXRlcyBmb3Igd2hlcmUgdGhlIG1heCBjb21lcyBmcm9tLCBmb3IgZWFjaCBvdXRwdXQgbmV1cm9uCiAgICB0aGlzLnN3aXRjaHggPSBnbG9iYWwuemVyb3ModGhpcy5vdXRfc3ggKiB0aGlzLm91dF9zeSAqIHRoaXMub3V0X2RlcHRoKTsKICAgIHRoaXMuc3dpdGNoeSA9IGdsb2JhbC56ZXJvcyh0aGlzLm91dF9zeCAqIHRoaXMub3V0X3N5ICogdGhpcy5vdXRfZGVwdGgpOwogIH07CiAgUG9vbExheWVyLnByb3RvdHlwZSA9IHsKICAgIGZvcndhcmQ6IGZ1bmN0aW9uIChWLCBpc190cmFpbmluZykgewogICAgICB0aGlzLmluX2FjdCA9IFY7CiAgICAgIHZhciBBID0gbmV3IFZvbCh0aGlzLm91dF9zeCwgdGhpcy5vdXRfc3ksIHRoaXMub3V0X2RlcHRoLCAwLjApOwogICAgICB2YXIgbiA9IDA7IC8vIGEgY291bnRlciBmb3Igc3dpdGNoZXMKICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCB0aGlzLm91dF9kZXB0aDsgZCsrKSB7CiAgICAgICAgdmFyIHggPSAtdGhpcy5wYWQ7CiAgICAgICAgdmFyIHkgPSAtdGhpcy5wYWQ7CiAgICAgICAgZm9yICh2YXIgYXggPSAwOyBheCA8IHRoaXMub3V0X3N4OyB4ICs9IHRoaXMuc3RyaWRlLCBheCsrKSB7CiAgICAgICAgICB5ID0gLXRoaXMucGFkOwogICAgICAgICAgZm9yICh2YXIgYXkgPSAwOyBheSA8IHRoaXMub3V0X3N5OyB5ICs9IHRoaXMuc3RyaWRlLCBheSsrKSB7CiAgICAgICAgICAgIC8vIGNvbnZvbHZlIGNlbnRlcmVkIGF0IHRoaXMgcGFydGljdWxhciBsb2NhdGlvbgogICAgICAgICAgICB2YXIgYSA9IC05OTk5OTsgLy8gaG9wZWZ1bGx5IHNtYWxsIGVub3VnaCA7XAogICAgICAgICAgICB2YXIgd2lueCA9IC0xLAogICAgICAgICAgICAgIHdpbnkgPSAtMTsKICAgICAgICAgICAgZm9yICh2YXIgZnggPSAwOyBmeCA8IHRoaXMuc3g7IGZ4KyspIHsKICAgICAgICAgICAgICBmb3IgKHZhciBmeSA9IDA7IGZ5IDwgdGhpcy5zeTsgZnkrKykgewogICAgICAgICAgICAgICAgdmFyIG95ID0geSArIGZ5OwogICAgICAgICAgICAgICAgdmFyIG94ID0geCArIGZ4OwogICAgICAgICAgICAgICAgaWYgKG95ID49IDAgJiYgb3kgPCBWLnN5ICYmIG94ID49IDAgJiYgb3ggPCBWLnN4KSB7CiAgICAgICAgICAgICAgICAgIHZhciB2ID0gVi5nZXQob3gsIG95LCBkKTsKICAgICAgICAgICAgICAgICAgLy8gcGVyZm9ybSBtYXggcG9vbGluZyBhbmQgc3RvcmUgcG9pbnRlcnMgdG8gd2hlcmUKICAgICAgICAgICAgICAgICAgLy8gdGhlIG1heCBjYW1lIGZyb20uIFRoaXMgd2lsbCBzcGVlZCB1cCBiYWNrcHJvcCAKICAgICAgICAgICAgICAgICAgLy8gYW5kIGNhbiBoZWxwIG1ha2UgbmljZSB2aXN1YWxpemF0aW9ucyBpbiBmdXR1cmUKICAgICAgICAgICAgICAgICAgaWYgKHYgPiBhKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IHY7CiAgICAgICAgICAgICAgICAgICAgd2lueCA9IG94OwogICAgICAgICAgICAgICAgICAgIHdpbnkgPSBveTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnN3aXRjaHhbbl0gPSB3aW54OwogICAgICAgICAgICB0aGlzLnN3aXRjaHlbbl0gPSB3aW55OwogICAgICAgICAgICBuKys7CiAgICAgICAgICAgIEEuc2V0KGF4LCBheSwgZCwgYSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3V0X2FjdCA9IEE7CiAgICAgIHJldHVybiB0aGlzLm91dF9hY3Q7CiAgICB9LAogICAgYmFja3dhcmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gcG9vbGluZyBsYXllcnMgaGF2ZSBubyBwYXJhbWV0ZXJzLCBzbyBzaW1wbHkgY29tcHV0ZSAKICAgICAgLy8gZ3JhZGllbnQgd3J0IGRhdGEgaGVyZQogICAgICB2YXIgViA9IHRoaXMuaW5fYWN0OwogICAgICBWLmR3ID0gZ2xvYmFsLnplcm9zKFYudy5sZW5ndGgpOyAvLyB6ZXJvIG91dCBncmFkaWVudCB3cnQgZGF0YQogICAgICB2YXIgQSA9IHRoaXMub3V0X2FjdDsgLy8gY29tcHV0ZWQgaW4gZm9yd2FyZCBwYXNzIAoKICAgICAgdmFyIG4gPSAwOwogICAgICBmb3IgKHZhciBkID0gMDsgZCA8IHRoaXMub3V0X2RlcHRoOyBkKyspIHsKICAgICAgICB2YXIgeCA9IC10aGlzLnBhZDsKICAgICAgICB2YXIgeSA9IC10aGlzLnBhZDsKICAgICAgICBmb3IgKHZhciBheCA9IDA7IGF4IDwgdGhpcy5vdXRfc3g7IHggKz0gdGhpcy5zdHJpZGUsIGF4KyspIHsKICAgICAgICAgIHkgPSAtdGhpcy5wYWQ7CiAgICAgICAgICBmb3IgKHZhciBheSA9IDA7IGF5IDwgdGhpcy5vdXRfc3k7IHkgKz0gdGhpcy5zdHJpZGUsIGF5KyspIHsKICAgICAgICAgICAgdmFyIGNoYWluX2dyYWQgPSB0aGlzLm91dF9hY3QuZ2V0X2dyYWQoYXgsIGF5LCBkKTsKICAgICAgICAgICAgVi5hZGRfZ3JhZCh0aGlzLnN3aXRjaHhbbl0sIHRoaXMuc3dpdGNoeVtuXSwgZCwgY2hhaW5fZ3JhZCk7CiAgICAgICAgICAgIG4rKzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBnZXRQYXJhbXNBbmRHcmFkczogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW107CiAgICB9LAogICAgdG9KU09OOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBqc29uID0ge307CiAgICAgIGpzb24uc3ggPSB0aGlzLnN4OwogICAgICBqc29uLnN5ID0gdGhpcy5zeTsKICAgICAganNvbi5zdHJpZGUgPSB0aGlzLnN0cmlkZTsKICAgICAganNvbi5pbl9kZXB0aCA9IHRoaXMuaW5fZGVwdGg7CiAgICAgIGpzb24ub3V0X2RlcHRoID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIGpzb24ub3V0X3N4ID0gdGhpcy5vdXRfc3g7CiAgICAgIGpzb24ub3V0X3N5ID0gdGhpcy5vdXRfc3k7CiAgICAgIGpzb24ubGF5ZXJfdHlwZSA9IHRoaXMubGF5ZXJfdHlwZTsKICAgICAganNvbi5wYWQgPSB0aGlzLnBhZDsKICAgICAgcmV0dXJuIGpzb247CiAgICB9LAogICAgZnJvbUpTT046IGZ1bmN0aW9uIChqc29uKSB7CiAgICAgIHRoaXMub3V0X2RlcHRoID0ganNvbi5vdXRfZGVwdGg7CiAgICAgIHRoaXMub3V0X3N4ID0ganNvbi5vdXRfc3g7CiAgICAgIHRoaXMub3V0X3N5ID0ganNvbi5vdXRfc3k7CiAgICAgIHRoaXMubGF5ZXJfdHlwZSA9IGpzb24ubGF5ZXJfdHlwZTsKICAgICAgdGhpcy5zeCA9IGpzb24uc3g7CiAgICAgIHRoaXMuc3kgPSBqc29uLnN5OwogICAgICB0aGlzLnN0cmlkZSA9IGpzb24uc3RyaWRlOwogICAgICB0aGlzLmluX2RlcHRoID0ganNvbi5pbl9kZXB0aDsKICAgICAgdGhpcy5wYWQgPSB0eXBlb2YganNvbi5wYWQgIT09ICd1bmRlZmluZWQnID8ganNvbi5wYWQgOiAwOyAvLyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQogICAgICB0aGlzLnN3aXRjaHggPSBnbG9iYWwuemVyb3ModGhpcy5vdXRfc3ggKiB0aGlzLm91dF9zeSAqIHRoaXMub3V0X2RlcHRoKTsgLy8gbmVlZCB0byByZS1pbml0IHRoZXNlIGFwcHJvcHJpYXRlbHkKICAgICAgdGhpcy5zd2l0Y2h5ID0gZ2xvYmFsLnplcm9zKHRoaXMub3V0X3N4ICogdGhpcy5vdXRfc3kgKiB0aGlzLm91dF9kZXB0aCk7CiAgICB9CiAgfTsKICBnbG9iYWwuUG9vbExheWVyID0gUG9vbExheWVyOwp9KShjb252bmV0anMpOwooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIFZvbCA9IGdsb2JhbC5Wb2w7IC8vIGNvbnZlbmllbmNlCiAgdmFyIGdldG9wdCA9IGdsb2JhbC5nZXRvcHQ7CiAgdmFyIElucHV0TGF5ZXIgPSBmdW5jdGlvbiAob3B0KSB7CiAgICB2YXIgb3B0ID0gb3B0IHx8IHt9OwoKICAgIC8vIHJlcXVpcmVkOiBkZXB0aAogICAgdGhpcy5vdXRfZGVwdGggPSBnZXRvcHQob3B0LCBbJ291dF9kZXB0aCcsICdkZXB0aCddLCAwKTsKCiAgICAvLyBvcHRpb25hbDogZGVmYXVsdCB0aGVzZSBkaW1lbnNpb25zIHRvIDEKICAgIHRoaXMub3V0X3N4ID0gZ2V0b3B0KG9wdCwgWydvdXRfc3gnLCAnc3gnLCAnd2lkdGgnXSwgMSk7CiAgICB0aGlzLm91dF9zeSA9IGdldG9wdChvcHQsIFsnb3V0X3N5JywgJ3N5JywgJ2hlaWdodCddLCAxKTsKCiAgICAvLyBjb21wdXRlZAogICAgdGhpcy5sYXllcl90eXBlID0gJ2lucHV0JzsKICB9OwogIElucHV0TGF5ZXIucHJvdG90eXBlID0gewogICAgZm9yd2FyZDogZnVuY3Rpb24gKFYsIGlzX3RyYWluaW5nKSB7CiAgICAgIHRoaXMuaW5fYWN0ID0gVjsKICAgICAgdGhpcy5vdXRfYWN0ID0gVjsKICAgICAgcmV0dXJuIHRoaXMub3V0X2FjdDsgLy8gc2ltcGx5IGlkZW50aXR5IGZ1bmN0aW9uIGZvciBub3cKICAgIH0sCiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKCkge30sCiAgICBnZXRQYXJhbXNBbmRHcmFkczogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW107CiAgICB9LAogICAgdG9KU09OOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBqc29uID0ge307CiAgICAgIGpzb24ub3V0X2RlcHRoID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIGpzb24ub3V0X3N4ID0gdGhpcy5vdXRfc3g7CiAgICAgIGpzb24ub3V0X3N5ID0gdGhpcy5vdXRfc3k7CiAgICAgIGpzb24ubGF5ZXJfdHlwZSA9IHRoaXMubGF5ZXJfdHlwZTsKICAgICAgcmV0dXJuIGpzb247CiAgICB9LAogICAgZnJvbUpTT046IGZ1bmN0aW9uIChqc29uKSB7CiAgICAgIHRoaXMub3V0X2RlcHRoID0ganNvbi5vdXRfZGVwdGg7CiAgICAgIHRoaXMub3V0X3N4ID0ganNvbi5vdXRfc3g7CiAgICAgIHRoaXMub3V0X3N5ID0ganNvbi5vdXRfc3k7CiAgICAgIHRoaXMubGF5ZXJfdHlwZSA9IGpzb24ubGF5ZXJfdHlwZTsKICAgIH0KICB9OwogIGdsb2JhbC5JbnB1dExheWVyID0gSW5wdXRMYXllcjsKfSkoY29udm5ldGpzKTsKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBWb2wgPSBnbG9iYWwuVm9sOyAvLyBjb252ZW5pZW5jZQoKICAvLyBMYXllcnMgdGhhdCBpbXBsZW1lbnQgYSBsb3NzLiBDdXJyZW50bHkgdGhlc2UgYXJlIHRoZSBsYXllcnMgdGhhdCAKICAvLyBjYW4gaW5pdGlhdGUgYSBiYWNrd2FyZCgpIHBhc3MuIEluIGZ1dHVyZSB3ZSBwcm9iYWJseSB3YW50IGEgbW9yZSAKICAvLyBmbGV4aWJsZSBzeXN0ZW0gdGhhdCBjYW4gYWNjb21vZGF0ZSBtdWx0aXBsZSBsb3NzZXMgdG8gZG8gbXVsdGktdGFzawogIC8vIGxlYXJuaW5nLCBhbmQgc3R1ZmYgbGlrZSB0aGF0LiBCdXQgZm9yIG5vdywgb25lIG9mIHRoZSBsYXllcnMgaW4gdGhpcwogIC8vIGZpbGUgbXVzdCBiZSB0aGUgZmluYWwgbGF5ZXIgaW4gYSBOZXQuCgogIC8vIFRoaXMgaXMgYSBjbGFzc2lmaWVyLCB3aXRoIE4gZGlzY3JldGUgY2xhc3NlcyBmcm9tIDAgdG8gTi0xCiAgLy8gaXQgZ2V0cyBhIHN0cmVhbSBvZiBOIGluY29taW5nIG51bWJlcnMgYW5kIGNvbXB1dGVzIHRoZSBzb2Z0bWF4CiAgLy8gZnVuY3Rpb24gKGV4cG9uZW50aWF0ZSBhbmQgbm9ybWFsaXplIHRvIHN1bSB0byAxIGFzIHByb2JhYmlsaXRpZXMgc2hvdWxkKQogIHZhciBTb2Z0bWF4TGF5ZXIgPSBmdW5jdGlvbiAob3B0KSB7CiAgICB2YXIgb3B0ID0gb3B0IHx8IHt9OwoKICAgIC8vIGNvbXB1dGVkCiAgICB0aGlzLm51bV9pbnB1dHMgPSBvcHQuaW5fc3ggKiBvcHQuaW5fc3kgKiBvcHQuaW5fZGVwdGg7CiAgICB0aGlzLm91dF9kZXB0aCA9IHRoaXMubnVtX2lucHV0czsKICAgIHRoaXMub3V0X3N4ID0gMTsKICAgIHRoaXMub3V0X3N5ID0gMTsKICAgIHRoaXMubGF5ZXJfdHlwZSA9ICdzb2Z0bWF4JzsKICB9OwogIFNvZnRtYXhMYXllci5wcm90b3R5cGUgPSB7CiAgICBmb3J3YXJkOiBmdW5jdGlvbiAoViwgaXNfdHJhaW5pbmcpIHsKICAgICAgdGhpcy5pbl9hY3QgPSBWOwogICAgICB2YXIgQSA9IG5ldyBWb2woMSwgMSwgdGhpcy5vdXRfZGVwdGgsIDAuMCk7CgogICAgICAvLyBjb21wdXRlIG1heCBhY3RpdmF0aW9uCiAgICAgIHZhciBhcyA9IFYudzsKICAgICAgdmFyIGFtYXggPSBWLndbMF07CiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICAgIGlmIChhc1tpXSA+IGFtYXgpIGFtYXggPSBhc1tpXTsKICAgICAgfQoKICAgICAgLy8gY29tcHV0ZSBleHBvbmVudGlhbHMgKGNhcmVmdWxseSB0byBub3QgYmxvdyB1cCkKICAgICAgdmFyIGVzID0gZ2xvYmFsLnplcm9zKHRoaXMub3V0X2RlcHRoKTsKICAgICAgdmFyIGVzdW0gPSAwLjA7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICAgIHZhciBlID0gTWF0aC5leHAoYXNbaV0gLSBhbWF4KTsKICAgICAgICBlc3VtICs9IGU7CiAgICAgICAgZXNbaV0gPSBlOwogICAgICB9CgogICAgICAvLyBub3JtYWxpemUgYW5kIG91dHB1dCB0byBzdW0gdG8gb25lCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICAgIGVzW2ldIC89IGVzdW07CiAgICAgICAgQS53W2ldID0gZXNbaV07CiAgICAgIH0KICAgICAgdGhpcy5lcyA9IGVzOyAvLyBzYXZlIHRoZXNlIGZvciBiYWNrcHJvcAogICAgICB0aGlzLm91dF9hY3QgPSBBOwogICAgICByZXR1cm4gdGhpcy5vdXRfYWN0OwogICAgfSwKICAgIGJhY2t3YXJkOiBmdW5jdGlvbiAoeSkgewogICAgICAvLyBjb21wdXRlIGFuZCBhY2N1bXVsYXRlIGdyYWRpZW50IHdydCB3ZWlnaHRzIGFuZCBiaWFzIG9mIHRoaXMgbGF5ZXIKICAgICAgdmFyIHggPSB0aGlzLmluX2FjdDsKICAgICAgeC5kdyA9IGdsb2JhbC56ZXJvcyh4LncubGVuZ3RoKTsgLy8gemVybyBvdXQgdGhlIGdyYWRpZW50IG9mIGlucHV0IFZvbAoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm91dF9kZXB0aDsgaSsrKSB7CiAgICAgICAgdmFyIGluZGljYXRvciA9IGkgPT09IHkgPyAxLjAgOiAwLjA7CiAgICAgICAgdmFyIG11bCA9IC0oaW5kaWNhdG9yIC0gdGhpcy5lc1tpXSk7CiAgICAgICAgeC5kd1tpXSA9IG11bDsKICAgICAgfQoKICAgICAgLy8gbG9zcyBpcyB0aGUgY2xhc3MgbmVnYXRpdmUgbG9nIGxpa2VsaWhvb2QKICAgICAgcmV0dXJuIC1NYXRoLmxvZyh0aGlzLmVzW3ldKTsKICAgIH0sCiAgICBnZXRQYXJhbXNBbmRHcmFkczogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW107CiAgICB9LAogICAgdG9KU09OOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBqc29uID0ge307CiAgICAgIGpzb24ub3V0X2RlcHRoID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIGpzb24ub3V0X3N4ID0gdGhpcy5vdXRfc3g7CiAgICAgIGpzb24ub3V0X3N5ID0gdGhpcy5vdXRfc3k7CiAgICAgIGpzb24ubGF5ZXJfdHlwZSA9IHRoaXMubGF5ZXJfdHlwZTsKICAgICAganNvbi5udW1faW5wdXRzID0gdGhpcy5udW1faW5wdXRzOwogICAgICByZXR1cm4ganNvbjsKICAgIH0sCiAgICBmcm9tSlNPTjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdGhpcy5vdXRfZGVwdGggPSBqc29uLm91dF9kZXB0aDsKICAgICAgdGhpcy5vdXRfc3ggPSBqc29uLm91dF9zeDsKICAgICAgdGhpcy5vdXRfc3kgPSBqc29uLm91dF9zeTsKICAgICAgdGhpcy5sYXllcl90eXBlID0ganNvbi5sYXllcl90eXBlOwogICAgICB0aGlzLm51bV9pbnB1dHMgPSBqc29uLm51bV9pbnB1dHM7CiAgICB9CiAgfTsKCiAgLy8gaW1wbGVtZW50cyBhbiBMMiByZWdyZXNzaW9uIGNvc3QgbGF5ZXIsCiAgLy8gc28gcGVuYWxpemVzIFxzdW1faSh8fHhfaSAtIHlfaXx8XjIpLCB3aGVyZSB4IGlzIGl0cyBpbnB1dAogIC8vIGFuZCB5IGlzIHRoZSB1c2VyLXByb3ZpZGVkIGFycmF5IG9mICJjb3JyZWN0IiB2YWx1ZXMuCiAgdmFyIFJlZ3Jlc3Npb25MYXllciA9IGZ1bmN0aW9uIChvcHQpIHsKICAgIHZhciBvcHQgPSBvcHQgfHwge307CgogICAgLy8gY29tcHV0ZWQKICAgIHRoaXMubnVtX2lucHV0cyA9IG9wdC5pbl9zeCAqIG9wdC5pbl9zeSAqIG9wdC5pbl9kZXB0aDsKICAgIHRoaXMub3V0X2RlcHRoID0gdGhpcy5udW1faW5wdXRzOwogICAgdGhpcy5vdXRfc3ggPSAxOwogICAgdGhpcy5vdXRfc3kgPSAxOwogICAgdGhpcy5sYXllcl90eXBlID0gJ3JlZ3Jlc3Npb24nOwogIH07CiAgUmVncmVzc2lvbkxheWVyLnByb3RvdHlwZSA9IHsKICAgIGZvcndhcmQ6IGZ1bmN0aW9uIChWLCBpc190cmFpbmluZykgewogICAgICB0aGlzLmluX2FjdCA9IFY7CiAgICAgIHRoaXMub3V0X2FjdCA9IFY7CiAgICAgIHJldHVybiBWOyAvLyBpZGVudGl0eSBmdW5jdGlvbgogICAgfSwKICAgIC8vIHkgaXMgYSBsaXN0IGhlcmUgb2Ygc2l6ZSBudW1faW5wdXRzCiAgICAvLyBvciBpdCBjYW4gYmUgYSBudW1iZXIgaWYgb25seSBvbmUgdmFsdWUgaXMgcmVncmVzc2VkCiAgICAvLyBvciBpdCBjYW4gYmUgYSBzdHJ1Y3Qge2RpbTogaSwgdmFsOiB4fSB3aGVyZSB3ZSBvbmx5IHdhbnQgdG8gCiAgICAvLyByZWdyZXNzIG9uIGRpbWVuc2lvbiBpIGFuZCBhc2tpbmcgaXQgdG8gaGF2ZSB2YWx1ZSB4CiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKHkpIHsKICAgICAgLy8gY29tcHV0ZSBhbmQgYWNjdW11bGF0ZSBncmFkaWVudCB3cnQgd2VpZ2h0cyBhbmQgYmlhcyBvZiB0aGlzIGxheWVyCiAgICAgIHZhciB4ID0gdGhpcy5pbl9hY3Q7CiAgICAgIHguZHcgPSBnbG9iYWwuemVyb3MoeC53Lmxlbmd0aCk7IC8vIHplcm8gb3V0IHRoZSBncmFkaWVudCBvZiBpbnB1dCBWb2wKICAgICAgdmFyIGxvc3MgPSAwLjA7CiAgICAgIGlmICh5IGluc3RhbmNlb2YgQXJyYXkgfHwgeSBpbnN0YW5jZW9mIEZsb2F0NjRBcnJheSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vdXRfZGVwdGg7IGkrKykgewogICAgICAgICAgdmFyIGR5ID0geC53W2ldIC0geVtpXTsKICAgICAgICAgIHguZHdbaV0gPSBkeTsKICAgICAgICAgIGxvc3MgKz0gMC41ICogZHkgKiBkeTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHkgPT09ICdudW1iZXInKSB7CiAgICAgICAgLy8gbGV0cyBob3BlIHRoYXQgb25seSBvbmUgbnVtYmVyIGlzIGJlaW5nIHJlZ3Jlc3NlZAogICAgICAgIHZhciBkeSA9IHgud1swXSAtIHk7CiAgICAgICAgeC5kd1swXSA9IGR5OwogICAgICAgIGxvc3MgKz0gMC41ICogZHkgKiBkeTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBhc3N1bWUgaXQgaXMgYSBzdHJ1Y3Qgd2l0aCBlbnRyaWVzIC5kaW0gYW5kIC52YWwKICAgICAgICAvLyBhbmQgd2UgcGFzcyBncmFkaWVudCBvbmx5IGFsb25nIGRpbWVuc2lvbiBkaW0gdG8gYmUgZXF1YWwgdG8gdmFsCiAgICAgICAgdmFyIGkgPSB5LmRpbTsKICAgICAgICB2YXIgeWkgPSB5LnZhbDsKICAgICAgICB2YXIgZHkgPSB4LndbaV0gLSB5aTsKICAgICAgICB4LmR3W2ldID0gZHk7CiAgICAgICAgbG9zcyArPSAwLjUgKiBkeSAqIGR5OwogICAgICB9CiAgICAgIHJldHVybiBsb3NzOwogICAgfSwKICAgIGdldFBhcmFtc0FuZEdyYWRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGpzb24gPSB7fTsKICAgICAganNvbi5vdXRfZGVwdGggPSB0aGlzLm91dF9kZXB0aDsKICAgICAganNvbi5vdXRfc3ggPSB0aGlzLm91dF9zeDsKICAgICAganNvbi5vdXRfc3kgPSB0aGlzLm91dF9zeTsKICAgICAganNvbi5sYXllcl90eXBlID0gdGhpcy5sYXllcl90eXBlOwogICAgICBqc29uLm51bV9pbnB1dHMgPSB0aGlzLm51bV9pbnB1dHM7CiAgICAgIHJldHVybiBqc29uOwogICAgfSwKICAgIGZyb21KU09OOiBmdW5jdGlvbiAoanNvbikgewogICAgICB0aGlzLm91dF9kZXB0aCA9IGpzb24ub3V0X2RlcHRoOwogICAgICB0aGlzLm91dF9zeCA9IGpzb24ub3V0X3N4OwogICAgICB0aGlzLm91dF9zeSA9IGpzb24ub3V0X3N5OwogICAgICB0aGlzLmxheWVyX3R5cGUgPSBqc29uLmxheWVyX3R5cGU7CiAgICAgIHRoaXMubnVtX2lucHV0cyA9IGpzb24ubnVtX2lucHV0czsKICAgIH0KICB9OwogIHZhciBTVk1MYXllciA9IGZ1bmN0aW9uIChvcHQpIHsKICAgIHZhciBvcHQgPSBvcHQgfHwge307CgogICAgLy8gY29tcHV0ZWQKICAgIHRoaXMubnVtX2lucHV0cyA9IG9wdC5pbl9zeCAqIG9wdC5pbl9zeSAqIG9wdC5pbl9kZXB0aDsKICAgIHRoaXMub3V0X2RlcHRoID0gdGhpcy5udW1faW5wdXRzOwogICAgdGhpcy5vdXRfc3ggPSAxOwogICAgdGhpcy5vdXRfc3kgPSAxOwogICAgdGhpcy5sYXllcl90eXBlID0gJ3N2bSc7CiAgfTsKICBTVk1MYXllci5wcm90b3R5cGUgPSB7CiAgICBmb3J3YXJkOiBmdW5jdGlvbiAoViwgaXNfdHJhaW5pbmcpIHsKICAgICAgdGhpcy5pbl9hY3QgPSBWOwogICAgICB0aGlzLm91dF9hY3QgPSBWOyAvLyBub3RoaW5nIHRvIGRvLCBvdXRwdXQgcmF3IHNjb3JlcwogICAgICByZXR1cm4gVjsKICAgIH0sCiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKHkpIHsKICAgICAgLy8gY29tcHV0ZSBhbmQgYWNjdW11bGF0ZSBncmFkaWVudCB3cnQgd2VpZ2h0cyBhbmQgYmlhcyBvZiB0aGlzIGxheWVyCiAgICAgIHZhciB4ID0gdGhpcy5pbl9hY3Q7CiAgICAgIHguZHcgPSBnbG9iYWwuemVyb3MoeC53Lmxlbmd0aCk7IC8vIHplcm8gb3V0IHRoZSBncmFkaWVudCBvZiBpbnB1dCBWb2wKCiAgICAgIC8vIHdlJ3JlIHVzaW5nIHN0cnVjdHVyZWQgbG9zcyBoZXJlLCB3aGljaCBtZWFucyB0aGF0IHRoZSBzY29yZQogICAgICAvLyBvZiB0aGUgZ3JvdW5kIHRydXRoIHNob3VsZCBiZSBoaWdoZXIgdGhhbiB0aGUgc2NvcmUgb2YgYW55IG90aGVyIAogICAgICAvLyBjbGFzcywgYnkgYSBtYXJnaW4KICAgICAgdmFyIHlzY29yZSA9IHgud1t5XTsgLy8gc2NvcmUgb2YgZ3JvdW5kIHRydXRoCiAgICAgIHZhciBtYXJnaW4gPSAxLjA7CiAgICAgIHZhciBsb3NzID0gMC4wOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMub3V0X2RlcHRoOyBpKyspIHsKICAgICAgICBpZiAoeSA9PT0gaSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHZhciB5ZGlmZiA9IC15c2NvcmUgKyB4LndbaV0gKyBtYXJnaW47CiAgICAgICAgaWYgKHlkaWZmID4gMCkgewogICAgICAgICAgLy8gdmlvbGF0aW5nIGRpbWVuc2lvbiwgYXBwbHkgbG9zcwogICAgICAgICAgeC5kd1tpXSArPSAxOwogICAgICAgICAgeC5kd1t5XSAtPSAxOwogICAgICAgICAgbG9zcyArPSB5ZGlmZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGxvc3M7CiAgICB9LAogICAgZ2V0UGFyYW1zQW5kR3JhZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfSwKICAgIHRvSlNPTjogZnVuY3Rpb24gKCkgewogICAgICB2YXIganNvbiA9IHt9OwogICAgICBqc29uLm91dF9kZXB0aCA9IHRoaXMub3V0X2RlcHRoOwogICAgICBqc29uLm91dF9zeCA9IHRoaXMub3V0X3N4OwogICAgICBqc29uLm91dF9zeSA9IHRoaXMub3V0X3N5OwogICAgICBqc29uLmxheWVyX3R5cGUgPSB0aGlzLmxheWVyX3R5cGU7CiAgICAgIGpzb24ubnVtX2lucHV0cyA9IHRoaXMubnVtX2lucHV0czsKICAgICAgcmV0dXJuIGpzb247CiAgICB9LAogICAgZnJvbUpTT046IGZ1bmN0aW9uIChqc29uKSB7CiAgICAgIHRoaXMub3V0X2RlcHRoID0ganNvbi5vdXRfZGVwdGg7CiAgICAgIHRoaXMub3V0X3N4ID0ganNvbi5vdXRfc3g7CiAgICAgIHRoaXMub3V0X3N5ID0ganNvbi5vdXRfc3k7CiAgICAgIHRoaXMubGF5ZXJfdHlwZSA9IGpzb24ubGF5ZXJfdHlwZTsKICAgICAgdGhpcy5udW1faW5wdXRzID0ganNvbi5udW1faW5wdXRzOwogICAgfQogIH07CiAgZ2xvYmFsLlJlZ3Jlc3Npb25MYXllciA9IFJlZ3Jlc3Npb25MYXllcjsKICBnbG9iYWwuU29mdG1heExheWVyID0gU29mdG1heExheWVyOwogIGdsb2JhbC5TVk1MYXllciA9IFNWTUxheWVyOwp9KShjb252bmV0anMpOwooZnVuY3Rpb24gKGdsb2JhbCkgewogICJ1c2Ugc3RyaWN0IjsKCiAgdmFyIFZvbCA9IGdsb2JhbC5Wb2w7IC8vIGNvbnZlbmllbmNlCgogIC8vIEltcGxlbWVudHMgUmVMVSBub25saW5lYXJpdHkgZWxlbWVudHdpc2UKICAvLyB4IC0+IG1heCgwLCB4KQogIC8vIHRoZSBvdXRwdXQgaXMgaW4gWzAsIGluZikKICB2YXIgUmVsdUxheWVyID0gZnVuY3Rpb24gKG9wdCkgewogICAgdmFyIG9wdCA9IG9wdCB8fCB7fTsKCiAgICAvLyBjb21wdXRlZAogICAgdGhpcy5vdXRfc3ggPSBvcHQuaW5fc3g7CiAgICB0aGlzLm91dF9zeSA9IG9wdC5pbl9zeTsKICAgIHRoaXMub3V0X2RlcHRoID0gb3B0LmluX2RlcHRoOwogICAgdGhpcy5sYXllcl90eXBlID0gJ3JlbHUnOwogIH07CiAgUmVsdUxheWVyLnByb3RvdHlwZSA9IHsKICAgIGZvcndhcmQ6IGZ1bmN0aW9uIChWLCBpc190cmFpbmluZykgewogICAgICB0aGlzLmluX2FjdCA9IFY7CiAgICAgIHZhciBWMiA9IFYuY2xvbmUoKTsKICAgICAgdmFyIE4gPSBWLncubGVuZ3RoOwogICAgICB2YXIgVjJ3ID0gVjIudzsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICBpZiAoVjJ3W2ldIDwgMCkgVjJ3W2ldID0gMDsgLy8gdGhyZXNob2xkIGF0IDAKICAgICAgfQogICAgICB0aGlzLm91dF9hY3QgPSBWMjsKICAgICAgcmV0dXJuIHRoaXMub3V0X2FjdDsKICAgIH0sCiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKCkgewogICAgICB2YXIgViA9IHRoaXMuaW5fYWN0OyAvLyB3ZSBuZWVkIHRvIHNldCBkdyBvZiB0aGlzCiAgICAgIHZhciBWMiA9IHRoaXMub3V0X2FjdDsKICAgICAgdmFyIE4gPSBWLncubGVuZ3RoOwogICAgICBWLmR3ID0gZ2xvYmFsLnplcm9zKE4pOyAvLyB6ZXJvIG91dCBncmFkaWVudCB3cnQgZGF0YQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGlmIChWMi53W2ldIDw9IDApIFYuZHdbaV0gPSAwOyAvLyB0aHJlc2hvbGQKICAgICAgICBlbHNlIFYuZHdbaV0gPSBWMi5kd1tpXTsKICAgICAgfQogICAgfSwKICAgIGdldFBhcmFtc0FuZEdyYWRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGpzb24gPSB7fTsKICAgICAganNvbi5vdXRfZGVwdGggPSB0aGlzLm91dF9kZXB0aDsKICAgICAganNvbi5vdXRfc3ggPSB0aGlzLm91dF9zeDsKICAgICAganNvbi5vdXRfc3kgPSB0aGlzLm91dF9zeTsKICAgICAganNvbi5sYXllcl90eXBlID0gdGhpcy5sYXllcl90eXBlOwogICAgICByZXR1cm4ganNvbjsKICAgIH0sCiAgICBmcm9tSlNPTjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdGhpcy5vdXRfZGVwdGggPSBqc29uLm91dF9kZXB0aDsKICAgICAgdGhpcy5vdXRfc3ggPSBqc29uLm91dF9zeDsKICAgICAgdGhpcy5vdXRfc3kgPSBqc29uLm91dF9zeTsKICAgICAgdGhpcy5sYXllcl90eXBlID0ganNvbi5sYXllcl90eXBlOwogICAgfQogIH07CgogIC8vIEltcGxlbWVudHMgU2lnbW9pZCBubm9ubGluZWFyaXR5IGVsZW1lbnR3aXNlCiAgLy8geCAtPiAxLygxK2VeKC14KSkKICAvLyBzbyB0aGUgb3V0cHV0IGlzIGJldHdlZW4gMCBhbmQgMS4KICB2YXIgU2lnbW9pZExheWVyID0gZnVuY3Rpb24gKG9wdCkgewogICAgdmFyIG9wdCA9IG9wdCB8fCB7fTsKCiAgICAvLyBjb21wdXRlZAogICAgdGhpcy5vdXRfc3ggPSBvcHQuaW5fc3g7CiAgICB0aGlzLm91dF9zeSA9IG9wdC5pbl9zeTsKICAgIHRoaXMub3V0X2RlcHRoID0gb3B0LmluX2RlcHRoOwogICAgdGhpcy5sYXllcl90eXBlID0gJ3NpZ21vaWQnOwogIH07CiAgU2lnbW9pZExheWVyLnByb3RvdHlwZSA9IHsKICAgIGZvcndhcmQ6IGZ1bmN0aW9uIChWLCBpc190cmFpbmluZykgewogICAgICB0aGlzLmluX2FjdCA9IFY7CiAgICAgIHZhciBWMiA9IFYuY2xvbmVBbmRaZXJvKCk7CiAgICAgIHZhciBOID0gVi53Lmxlbmd0aDsKICAgICAgdmFyIFYydyA9IFYyLnc7CiAgICAgIHZhciBWdyA9IFYudzsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICBWMndbaV0gPSAxLjAgLyAoMS4wICsgTWF0aC5leHAoLVZ3W2ldKSk7CiAgICAgIH0KICAgICAgdGhpcy5vdXRfYWN0ID0gVjI7CiAgICAgIHJldHVybiB0aGlzLm91dF9hY3Q7CiAgICB9LAogICAgYmFja3dhcmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIFYgPSB0aGlzLmluX2FjdDsgLy8gd2UgbmVlZCB0byBzZXQgZHcgb2YgdGhpcwogICAgICB2YXIgVjIgPSB0aGlzLm91dF9hY3Q7CiAgICAgIHZhciBOID0gVi53Lmxlbmd0aDsKICAgICAgVi5kdyA9IGdsb2JhbC56ZXJvcyhOKTsgLy8gemVybyBvdXQgZ3JhZGllbnQgd3J0IGRhdGEKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICB2YXIgdjJ3aSA9IFYyLndbaV07CiAgICAgICAgVi5kd1tpXSA9IHYyd2kgKiAoMS4wIC0gdjJ3aSkgKiBWMi5kd1tpXTsKICAgICAgfQogICAgfSwKICAgIGdldFBhcmFtc0FuZEdyYWRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGpzb24gPSB7fTsKICAgICAganNvbi5vdXRfZGVwdGggPSB0aGlzLm91dF9kZXB0aDsKICAgICAganNvbi5vdXRfc3ggPSB0aGlzLm91dF9zeDsKICAgICAganNvbi5vdXRfc3kgPSB0aGlzLm91dF9zeTsKICAgICAganNvbi5sYXllcl90eXBlID0gdGhpcy5sYXllcl90eXBlOwogICAgICByZXR1cm4ganNvbjsKICAgIH0sCiAgICBmcm9tSlNPTjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdGhpcy5vdXRfZGVwdGggPSBqc29uLm91dF9kZXB0aDsKICAgICAgdGhpcy5vdXRfc3ggPSBqc29uLm91dF9zeDsKICAgICAgdGhpcy5vdXRfc3kgPSBqc29uLm91dF9zeTsKICAgICAgdGhpcy5sYXllcl90eXBlID0ganNvbi5sYXllcl90eXBlOwogICAgfQogIH07CgogIC8vIEltcGxlbWVudHMgTWF4b3V0IG5ub25saW5lYXJpdHkgdGhhdCBjb21wdXRlcwogIC8vIHggLT4gbWF4KHgpCiAgLy8gd2hlcmUgeCBpcyBhIHZlY3RvciBvZiBzaXplIGdyb3VwX3NpemUuIElkZWFsbHkgb2YgY291cnNlLAogIC8vIHRoZSBpbnB1dCBzaXplIHNob3VsZCBiZSBleGFjdGx5IGRpdmlzaWJsZSBieSBncm91cF9zaXplCiAgdmFyIE1heG91dExheWVyID0gZnVuY3Rpb24gKG9wdCkgewogICAgdmFyIG9wdCA9IG9wdCB8fCB7fTsKCiAgICAvLyByZXF1aXJlZAogICAgdGhpcy5ncm91cF9zaXplID0gdHlwZW9mIG9wdC5ncm91cF9zaXplICE9PSAndW5kZWZpbmVkJyA/IG9wdC5ncm91cF9zaXplIDogMjsKCiAgICAvLyBjb21wdXRlZAogICAgdGhpcy5vdXRfc3ggPSBvcHQuaW5fc3g7CiAgICB0aGlzLm91dF9zeSA9IG9wdC5pbl9zeTsKICAgIHRoaXMub3V0X2RlcHRoID0gTWF0aC5mbG9vcihvcHQuaW5fZGVwdGggLyB0aGlzLmdyb3VwX3NpemUpOwogICAgdGhpcy5sYXllcl90eXBlID0gJ21heG91dCc7CiAgICB0aGlzLnN3aXRjaGVzID0gZ2xvYmFsLnplcm9zKHRoaXMub3V0X3N4ICogdGhpcy5vdXRfc3kgKiB0aGlzLm91dF9kZXB0aCk7IC8vIHVzZWZ1bCBmb3IgYmFja3Byb3AKICB9OwogIE1heG91dExheWVyLnByb3RvdHlwZSA9IHsKICAgIGZvcndhcmQ6IGZ1bmN0aW9uIChWLCBpc190cmFpbmluZykgewogICAgICB0aGlzLmluX2FjdCA9IFY7CiAgICAgIHZhciBOID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIHZhciBWMiA9IG5ldyBWb2wodGhpcy5vdXRfc3gsIHRoaXMub3V0X3N5LCB0aGlzLm91dF9kZXB0aCwgMC4wKTsKCiAgICAgIC8vIG9wdGltaXphdGlvbiBicmFuY2guIElmIHdlJ3JlIG9wZXJhdGluZyBvbiAxRCBhcnJheXMgd2UgZG9udCBoYXZlCiAgICAgIC8vIHRvIHdvcnJ5IGFib3V0IGtlZXBpbmcgdHJhY2sgb2YgeCx5LGQgY29vcmRpbmF0ZXMgaW5zaWRlCiAgICAgIC8vIGlucHV0IHZvbHVtZXMuIEluIGNvbnZuZXRzIHdlIGRvIDooCiAgICAgIGlmICh0aGlzLm91dF9zeCA9PT0gMSAmJiB0aGlzLm91dF9zeSA9PT0gMSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTjsgaSsrKSB7CiAgICAgICAgICB2YXIgaXggPSBpICogdGhpcy5ncm91cF9zaXplOyAvLyBiYXNlIGluZGV4IG9mZnNldAogICAgICAgICAgdmFyIGEgPSBWLndbaXhdOwogICAgICAgICAgdmFyIGFpID0gMDsKICAgICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgdGhpcy5ncm91cF9zaXplOyBqKyspIHsKICAgICAgICAgICAgdmFyIGEyID0gVi53W2l4ICsgal07CiAgICAgICAgICAgIGlmIChhMiA+IGEpIHsKICAgICAgICAgICAgICBhID0gYTI7CiAgICAgICAgICAgICAgYWkgPSBqOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBWMi53W2ldID0gYTsKICAgICAgICAgIHRoaXMuc3dpdGNoZXNbaV0gPSBpeCArIGFpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgbiA9IDA7IC8vIGNvdW50ZXIgZm9yIHN3aXRjaGVzCiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBWLnN4OyB4KyspIHsKICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgVi5zeTsgeSsrKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTjsgaSsrKSB7CiAgICAgICAgICAgICAgdmFyIGl4ID0gaSAqIHRoaXMuZ3JvdXBfc2l6ZTsKICAgICAgICAgICAgICB2YXIgYSA9IFYuZ2V0KHgsIHksIGl4KTsKICAgICAgICAgICAgICB2YXIgYWkgPSAwOwogICAgICAgICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgdGhpcy5ncm91cF9zaXplOyBqKyspIHsKICAgICAgICAgICAgICAgIHZhciBhMiA9IFYuZ2V0KHgsIHksIGl4ICsgaik7CiAgICAgICAgICAgICAgICBpZiAoYTIgPiBhKSB7CiAgICAgICAgICAgICAgICAgIGEgPSBhMjsKICAgICAgICAgICAgICAgICAgYWkgPSBqOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBWMi5zZXQoeCwgeSwgaSwgYSk7CiAgICAgICAgICAgICAgdGhpcy5zd2l0Y2hlc1tuXSA9IGl4ICsgYWk7CiAgICAgICAgICAgICAgbisrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3V0X2FjdCA9IFYyOwogICAgICByZXR1cm4gdGhpcy5vdXRfYWN0OwogICAgfSwKICAgIGJhY2t3YXJkOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBWID0gdGhpcy5pbl9hY3Q7IC8vIHdlIG5lZWQgdG8gc2V0IGR3IG9mIHRoaXMKICAgICAgdmFyIFYyID0gdGhpcy5vdXRfYWN0OwogICAgICB2YXIgTiA9IHRoaXMub3V0X2RlcHRoOwogICAgICBWLmR3ID0gZ2xvYmFsLnplcm9zKFYudy5sZW5ndGgpOyAvLyB6ZXJvIG91dCBncmFkaWVudCB3cnQgZGF0YQoKICAgICAgLy8gcGFzcyB0aGUgZ3JhZGllbnQgdGhyb3VnaCB0aGUgYXBwcm9wcmlhdGUgc3dpdGNoCiAgICAgIGlmICh0aGlzLm91dF9zeCA9PT0gMSAmJiB0aGlzLm91dF9zeSA9PT0gMSkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTjsgaSsrKSB7CiAgICAgICAgICB2YXIgY2hhaW5fZ3JhZCA9IFYyLmR3W2ldOwogICAgICAgICAgVi5kd1t0aGlzLnN3aXRjaGVzW2ldXSA9IGNoYWluX2dyYWQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIGJsZWggb2theSwgbGV0cyBkbyB0aGlzIHRoZSBoYXJkIHdheQogICAgICAgIHZhciBuID0gMDsgLy8gY291bnRlciBmb3Igc3dpdGNoZXMKICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IFYyLnN4OyB4KyspIHsKICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgVjIuc3k7IHkrKykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgICAgICAgIHZhciBjaGFpbl9ncmFkID0gVjIuZ2V0X2dyYWQoeCwgeSwgaSk7CiAgICAgICAgICAgICAgVi5zZXRfZ3JhZCh4LCB5LCB0aGlzLnN3aXRjaGVzW25dLCBjaGFpbl9ncmFkKTsKICAgICAgICAgICAgICBuKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBnZXRQYXJhbXNBbmRHcmFkczogZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gW107CiAgICB9LAogICAgdG9KU09OOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBqc29uID0ge307CiAgICAgIGpzb24ub3V0X2RlcHRoID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIGpzb24ub3V0X3N4ID0gdGhpcy5vdXRfc3g7CiAgICAgIGpzb24ub3V0X3N5ID0gdGhpcy5vdXRfc3k7CiAgICAgIGpzb24ubGF5ZXJfdHlwZSA9IHRoaXMubGF5ZXJfdHlwZTsKICAgICAganNvbi5ncm91cF9zaXplID0gdGhpcy5ncm91cF9zaXplOwogICAgICByZXR1cm4ganNvbjsKICAgIH0sCiAgICBmcm9tSlNPTjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdGhpcy5vdXRfZGVwdGggPSBqc29uLm91dF9kZXB0aDsKICAgICAgdGhpcy5vdXRfc3ggPSBqc29uLm91dF9zeDsKICAgICAgdGhpcy5vdXRfc3kgPSBqc29uLm91dF9zeTsKICAgICAgdGhpcy5sYXllcl90eXBlID0ganNvbi5sYXllcl90eXBlOwogICAgICB0aGlzLmdyb3VwX3NpemUgPSBqc29uLmdyb3VwX3NpemU7CiAgICAgIHRoaXMuc3dpdGNoZXMgPSBnbG9iYWwuemVyb3ModGhpcy5ncm91cF9zaXplKTsKICAgIH0KICB9OwoKICAvLyBhIGhlbHBlciBmdW5jdGlvbiwgc2luY2UgdGFuaCBpcyBub3QgeWV0IHBhcnQgb2YgRUNNQVNjcmlwdC4gV2lsbCBiZSBpbiB2Ni4KICBmdW5jdGlvbiB0YW5oKHgpIHsKICAgIHZhciB5ID0gTWF0aC5leHAoMiAqIHgpOwogICAgcmV0dXJuICh5IC0gMSkgLyAoeSArIDEpOwogIH0KICAvLyBJbXBsZW1lbnRzIFRhbmggbm5vbmxpbmVhcml0eSBlbGVtZW50d2lzZQogIC8vIHggLT4gdGFuaCh4KSAKICAvLyBzbyB0aGUgb3V0cHV0IGlzIGJldHdlZW4gLTEgYW5kIDEuCiAgdmFyIFRhbmhMYXllciA9IGZ1bmN0aW9uIChvcHQpIHsKICAgIHZhciBvcHQgPSBvcHQgfHwge307CgogICAgLy8gY29tcHV0ZWQKICAgIHRoaXMub3V0X3N4ID0gb3B0LmluX3N4OwogICAgdGhpcy5vdXRfc3kgPSBvcHQuaW5fc3k7CiAgICB0aGlzLm91dF9kZXB0aCA9IG9wdC5pbl9kZXB0aDsKICAgIHRoaXMubGF5ZXJfdHlwZSA9ICd0YW5oJzsKICB9OwogIFRhbmhMYXllci5wcm90b3R5cGUgPSB7CiAgICBmb3J3YXJkOiBmdW5jdGlvbiAoViwgaXNfdHJhaW5pbmcpIHsKICAgICAgdGhpcy5pbl9hY3QgPSBWOwogICAgICB2YXIgVjIgPSBWLmNsb25lQW5kWmVybygpOwogICAgICB2YXIgTiA9IFYudy5sZW5ndGg7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTjsgaSsrKSB7CiAgICAgICAgVjIud1tpXSA9IHRhbmgoVi53W2ldKTsKICAgICAgfQogICAgICB0aGlzLm91dF9hY3QgPSBWMjsKICAgICAgcmV0dXJuIHRoaXMub3V0X2FjdDsKICAgIH0sCiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKCkgewogICAgICB2YXIgViA9IHRoaXMuaW5fYWN0OyAvLyB3ZSBuZWVkIHRvIHNldCBkdyBvZiB0aGlzCiAgICAgIHZhciBWMiA9IHRoaXMub3V0X2FjdDsKICAgICAgdmFyIE4gPSBWLncubGVuZ3RoOwogICAgICBWLmR3ID0gZ2xvYmFsLnplcm9zKE4pOyAvLyB6ZXJvIG91dCBncmFkaWVudCB3cnQgZGF0YQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIHZhciB2MndpID0gVjIud1tpXTsKICAgICAgICBWLmR3W2ldID0gKDEuMCAtIHYyd2kgKiB2MndpKSAqIFYyLmR3W2ldOwogICAgICB9CiAgICB9LAogICAgZ2V0UGFyYW1zQW5kR3JhZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfSwKICAgIHRvSlNPTjogZnVuY3Rpb24gKCkgewogICAgICB2YXIganNvbiA9IHt9OwogICAgICBqc29uLm91dF9kZXB0aCA9IHRoaXMub3V0X2RlcHRoOwogICAgICBqc29uLm91dF9zeCA9IHRoaXMub3V0X3N4OwogICAgICBqc29uLm91dF9zeSA9IHRoaXMub3V0X3N5OwogICAgICBqc29uLmxheWVyX3R5cGUgPSB0aGlzLmxheWVyX3R5cGU7CiAgICAgIHJldHVybiBqc29uOwogICAgfSwKICAgIGZyb21KU09OOiBmdW5jdGlvbiAoanNvbikgewogICAgICB0aGlzLm91dF9kZXB0aCA9IGpzb24ub3V0X2RlcHRoOwogICAgICB0aGlzLm91dF9zeCA9IGpzb24ub3V0X3N4OwogICAgICB0aGlzLm91dF9zeSA9IGpzb24ub3V0X3N5OwogICAgICB0aGlzLmxheWVyX3R5cGUgPSBqc29uLmxheWVyX3R5cGU7CiAgICB9CiAgfTsKICBnbG9iYWwuVGFuaExheWVyID0gVGFuaExheWVyOwogIGdsb2JhbC5NYXhvdXRMYXllciA9IE1heG91dExheWVyOwogIGdsb2JhbC5SZWx1TGF5ZXIgPSBSZWx1TGF5ZXI7CiAgZ2xvYmFsLlNpZ21vaWRMYXllciA9IFNpZ21vaWRMYXllcjsKfSkoY29udm5ldGpzKTsKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBWb2wgPSBnbG9iYWwuVm9sOyAvLyBjb252ZW5pZW5jZQoKICAvLyBBbiBpbmVmZmljaWVudCBkcm9wb3V0IGxheWVyCiAgLy8gTm90ZSB0aGlzIGlzIG5vdCBtb3N0IGVmZmljaWVudCBpbXBsZW1lbnRhdGlvbiBzaW5jZSB0aGUgbGF5ZXIgYmVmb3JlCiAgLy8gY29tcHV0ZWQgYWxsIHRoZXNlIGFjdGl2YXRpb25zIGFuZCBub3cgd2UncmUganVzdCBnb2luZyB0byBkcm9wIHRoZW0gOigKICAvLyBzYW1lIGdvZXMgZm9yIGJhY2t3YXJkIHBhc3MuIEFsc28sIGlmIHdlIHdhbnRlZCB0byBiZSBlZmZpY2llbnQgYXQgdGVzdCB0aW1lCiAgLy8gd2UgY291bGQgZXF1aXZhbGVudGx5IGJlIGNsZXZlciBhbmQgdXBzY2FsZSBkdXJpbmcgdHJhaW4gYW5kIGNvcHkgcG9pbnRlcnMgZHVyaW5nIHRlc3QKICAvLyB0b2RvOiBtYWtlIG1vcmUgZWZmaWNpZW50LgogIHZhciBEcm9wb3V0TGF5ZXIgPSBmdW5jdGlvbiAob3B0KSB7CiAgICB2YXIgb3B0ID0gb3B0IHx8IHt9OwoKICAgIC8vIGNvbXB1dGVkCiAgICB0aGlzLm91dF9zeCA9IG9wdC5pbl9zeDsKICAgIHRoaXMub3V0X3N5ID0gb3B0LmluX3N5OwogICAgdGhpcy5vdXRfZGVwdGggPSBvcHQuaW5fZGVwdGg7CiAgICB0aGlzLmxheWVyX3R5cGUgPSAnZHJvcG91dCc7CiAgICB0aGlzLmRyb3BfcHJvYiA9IHR5cGVvZiBvcHQuZHJvcF9wcm9iICE9PSAndW5kZWZpbmVkJyA/IG9wdC5kcm9wX3Byb2IgOiAwLjU7CiAgICB0aGlzLmRyb3BwZWQgPSBnbG9iYWwuemVyb3ModGhpcy5vdXRfc3ggKiB0aGlzLm91dF9zeSAqIHRoaXMub3V0X2RlcHRoKTsKICB9OwogIERyb3BvdXRMYXllci5wcm90b3R5cGUgPSB7CiAgICBmb3J3YXJkOiBmdW5jdGlvbiAoViwgaXNfdHJhaW5pbmcpIHsKICAgICAgdGhpcy5pbl9hY3QgPSBWOwogICAgICBpZiAodHlwZW9mIGlzX3RyYWluaW5nID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGlzX3RyYWluaW5nID0gZmFsc2U7CiAgICAgIH0gLy8gZGVmYXVsdCBpcyBwcmVkaWN0aW9uIG1vZGUKICAgICAgdmFyIFYyID0gVi5jbG9uZSgpOwogICAgICB2YXIgTiA9IFYudy5sZW5ndGg7CiAgICAgIGlmIChpc190cmFpbmluZykgewogICAgICAgIC8vIGRvIGRyb3BvdXQKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCB0aGlzLmRyb3BfcHJvYikgewogICAgICAgICAgICBWMi53W2ldID0gMDsKICAgICAgICAgICAgdGhpcy5kcm9wcGVkW2ldID0gdHJ1ZTsKICAgICAgICAgIH0gLy8gZHJvcCEKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmRyb3BwZWRbaV0gPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gc2NhbGUgdGhlIGFjdGl2YXRpb25zIGR1cmluZyBwcmVkaWN0aW9uCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICAgIFYyLndbaV0gKj0gdGhpcy5kcm9wX3Byb2I7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3V0X2FjdCA9IFYyOwogICAgICByZXR1cm4gdGhpcy5vdXRfYWN0OyAvLyBkdW1teSBpZGVudGl0eSBmdW5jdGlvbiBmb3Igbm93CiAgICB9LAogICAgYmFja3dhcmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIFYgPSB0aGlzLmluX2FjdDsgLy8gd2UgbmVlZCB0byBzZXQgZHcgb2YgdGhpcwogICAgICB2YXIgY2hhaW5fZ3JhZCA9IHRoaXMub3V0X2FjdDsKICAgICAgdmFyIE4gPSBWLncubGVuZ3RoOwogICAgICBWLmR3ID0gZ2xvYmFsLnplcm9zKE4pOyAvLyB6ZXJvIG91dCBncmFkaWVudCB3cnQgZGF0YQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGlmICghdGhpcy5kcm9wcGVkW2ldKSB7CiAgICAgICAgICBWLmR3W2ldID0gY2hhaW5fZ3JhZC5kd1tpXTsgLy8gY29weSBvdmVyIHRoZSBncmFkaWVudAogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdldFBhcmFtc0FuZEdyYWRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGpzb24gPSB7fTsKICAgICAganNvbi5vdXRfZGVwdGggPSB0aGlzLm91dF9kZXB0aDsKICAgICAganNvbi5vdXRfc3ggPSB0aGlzLm91dF9zeDsKICAgICAganNvbi5vdXRfc3kgPSB0aGlzLm91dF9zeTsKICAgICAganNvbi5sYXllcl90eXBlID0gdGhpcy5sYXllcl90eXBlOwogICAgICBqc29uLmRyb3BfcHJvYiA9IHRoaXMuZHJvcF9wcm9iOwogICAgICByZXR1cm4ganNvbjsKICAgIH0sCiAgICBmcm9tSlNPTjogZnVuY3Rpb24gKGpzb24pIHsKICAgICAgdGhpcy5vdXRfZGVwdGggPSBqc29uLm91dF9kZXB0aDsKICAgICAgdGhpcy5vdXRfc3ggPSBqc29uLm91dF9zeDsKICAgICAgdGhpcy5vdXRfc3kgPSBqc29uLm91dF9zeTsKICAgICAgdGhpcy5sYXllcl90eXBlID0ganNvbi5sYXllcl90eXBlOwogICAgICB0aGlzLmRyb3BfcHJvYiA9IGpzb24uZHJvcF9wcm9iOwogICAgfQogIH07CiAgZ2xvYmFsLkRyb3BvdXRMYXllciA9IERyb3BvdXRMYXllcjsKfSkoY29udm5ldGpzKTsKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBWb2wgPSBnbG9iYWwuVm9sOyAvLyBjb252ZW5pZW5jZQoKICAvLyBhIGJpdCBleHBlcmltZW50YWwgbGF5ZXIgZm9yIG5vdy4gSSB0aGluayBpdCB3b3JrcyBidXQgSSdtIG5vdCAxMDAlCiAgLy8gdGhlIGdyYWRpZW50IGNoZWNrIGlzIGEgYml0IGZ1bmt5LiBJJ2xsIGxvb2sgaW50byB0aGlzIGEgYml0IGxhdGVyLgogIC8vIExvY2FsIFJlc3BvbnNlIE5vcm1hbGl6YXRpb24gaW4gd2luZG93LCBhbG9uZyBkZXB0aHMgb2Ygdm9sdW1lcwogIHZhciBMb2NhbFJlc3BvbnNlTm9ybWFsaXphdGlvbkxheWVyID0gZnVuY3Rpb24gKG9wdCkgewogICAgdmFyIG9wdCA9IG9wdCB8fCB7fTsKCiAgICAvLyByZXF1aXJlZAogICAgdGhpcy5rID0gb3B0Lms7CiAgICB0aGlzLm4gPSBvcHQubjsKICAgIHRoaXMuYWxwaGEgPSBvcHQuYWxwaGE7CiAgICB0aGlzLmJldGEgPSBvcHQuYmV0YTsKCiAgICAvLyBjb21wdXRlZAogICAgdGhpcy5vdXRfc3ggPSBvcHQuaW5fc3g7CiAgICB0aGlzLm91dF9zeSA9IG9wdC5pbl9zeTsKICAgIHRoaXMub3V0X2RlcHRoID0gb3B0LmluX2RlcHRoOwogICAgdGhpcy5sYXllcl90eXBlID0gJ2xybic7CgogICAgLy8gY2hlY2tzCiAgICBpZiAodGhpcy5uICUgMiA9PT0gMCkgewogICAgICBjb25zb2xlLmxvZygnV0FSTklORyBuIHNob3VsZCBiZSBvZGQgZm9yIExSTiBsYXllcicpOwogICAgfQogIH07CiAgTG9jYWxSZXNwb25zZU5vcm1hbGl6YXRpb25MYXllci5wcm90b3R5cGUgPSB7CiAgICBmb3J3YXJkOiBmdW5jdGlvbiAoViwgaXNfdHJhaW5pbmcpIHsKICAgICAgdGhpcy5pbl9hY3QgPSBWOwogICAgICB2YXIgQSA9IFYuY2xvbmVBbmRaZXJvKCk7CiAgICAgIHRoaXMuU19jYWNoZV8gPSBWLmNsb25lQW5kWmVybygpOwogICAgICB2YXIgbjIgPSBNYXRoLmZsb29yKHRoaXMubiAvIDIpOwogICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IFYuc3g7IHgrKykgewogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgVi5zeTsgeSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IFYuZGVwdGg7IGkrKykgewogICAgICAgICAgICB2YXIgYWkgPSBWLmdldCh4LCB5LCBpKTsKCiAgICAgICAgICAgIC8vIG5vcm1hbGl6ZSBpbiBhIHdpbmRvdyBvZiBzaXplIG4KICAgICAgICAgICAgdmFyIGRlbiA9IDAuMDsKICAgICAgICAgICAgZm9yICh2YXIgaiA9IE1hdGgubWF4KDAsIGkgLSBuMik7IGogPD0gTWF0aC5taW4oaSArIG4yLCBWLmRlcHRoIC0gMSk7IGorKykgewogICAgICAgICAgICAgIHZhciBhYSA9IFYuZ2V0KHgsIHksIGopOwogICAgICAgICAgICAgIGRlbiArPSBhYSAqIGFhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlbiAqPSB0aGlzLmFscGhhIC8gdGhpcy5uOwogICAgICAgICAgICBkZW4gKz0gdGhpcy5rOwogICAgICAgICAgICB0aGlzLlNfY2FjaGVfLnNldCh4LCB5LCBpLCBkZW4pOyAvLyB3aWxsIGJlIHVzZWZ1bCBmb3IgYmFja3Byb3AKICAgICAgICAgICAgZGVuID0gTWF0aC5wb3coZGVuLCB0aGlzLmJldGEpOwogICAgICAgICAgICBBLnNldCh4LCB5LCBpLCBhaSAvIGRlbik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3V0X2FjdCA9IEE7CiAgICAgIHJldHVybiB0aGlzLm91dF9hY3Q7IC8vIGR1bW15IGlkZW50aXR5IGZ1bmN0aW9uIGZvciBub3cKICAgIH0sCiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKCkgewogICAgICAvLyBldmFsdWF0ZSBncmFkaWVudCB3cnQgZGF0YQogICAgICB2YXIgViA9IHRoaXMuaW5fYWN0OyAvLyB3ZSBuZWVkIHRvIHNldCBkdyBvZiB0aGlzCiAgICAgIFYuZHcgPSBnbG9iYWwuemVyb3MoVi53Lmxlbmd0aCk7IC8vIHplcm8gb3V0IGdyYWRpZW50IHdydCBkYXRhCiAgICAgIHZhciBBID0gdGhpcy5vdXRfYWN0OyAvLyBjb21wdXRlZCBpbiBmb3J3YXJkIHBhc3MgCgogICAgICB2YXIgbjIgPSBNYXRoLmZsb29yKHRoaXMubiAvIDIpOwogICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IFYuc3g7IHgrKykgewogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgVi5zeTsgeSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IFYuZGVwdGg7IGkrKykgewogICAgICAgICAgICB2YXIgY2hhaW5fZ3JhZCA9IHRoaXMub3V0X2FjdC5nZXRfZ3JhZCh4LCB5LCBpKTsKICAgICAgICAgICAgdmFyIFMgPSB0aGlzLlNfY2FjaGVfLmdldCh4LCB5LCBpKTsKICAgICAgICAgICAgdmFyIFNCID0gTWF0aC5wb3coUywgdGhpcy5iZXRhKTsKICAgICAgICAgICAgdmFyIFNCMiA9IFNCICogU0I7CgogICAgICAgICAgICAvLyBub3JtYWxpemUgaW4gYSB3aW5kb3cgb2Ygc2l6ZSBuCiAgICAgICAgICAgIGZvciAodmFyIGogPSBNYXRoLm1heCgwLCBpIC0gbjIpOyBqIDw9IE1hdGgubWluKGkgKyBuMiwgVi5kZXB0aCAtIDEpOyBqKyspIHsKICAgICAgICAgICAgICB2YXIgYWogPSBWLmdldCh4LCB5LCBqKTsKICAgICAgICAgICAgICB2YXIgZyA9IC1haiAqIHRoaXMuYmV0YSAqIE1hdGgucG93KFMsIHRoaXMuYmV0YSAtIDEpICogdGhpcy5hbHBoYSAvIHRoaXMubiAqIDIgKiBhajsKICAgICAgICAgICAgICBpZiAoaiA9PT0gaSkgZyArPSBTQjsKICAgICAgICAgICAgICBnIC89IFNCMjsKICAgICAgICAgICAgICBnICo9IGNoYWluX2dyYWQ7CiAgICAgICAgICAgICAgVi5hZGRfZ3JhZCh4LCB5LCBqLCBnKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGdldFBhcmFtc0FuZEdyYWRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGpzb24gPSB7fTsKICAgICAganNvbi5rID0gdGhpcy5rOwogICAgICBqc29uLm4gPSB0aGlzLm47CiAgICAgIGpzb24uYWxwaGEgPSB0aGlzLmFscGhhOyAvLyBub3JtYWxpemUgYnkgc2l6ZQogICAgICBqc29uLmJldGEgPSB0aGlzLmJldGE7CiAgICAgIGpzb24ub3V0X3N4ID0gdGhpcy5vdXRfc3g7CiAgICAgIGpzb24ub3V0X3N5ID0gdGhpcy5vdXRfc3k7CiAgICAgIGpzb24ub3V0X2RlcHRoID0gdGhpcy5vdXRfZGVwdGg7CiAgICAgIGpzb24ubGF5ZXJfdHlwZSA9IHRoaXMubGF5ZXJfdHlwZTsKICAgICAgcmV0dXJuIGpzb247CiAgICB9LAogICAgZnJvbUpTT046IGZ1bmN0aW9uIChqc29uKSB7CiAgICAgIHRoaXMuayA9IGpzb24uazsKICAgICAgdGhpcy5uID0ganNvbi5uOwogICAgICB0aGlzLmFscGhhID0ganNvbi5hbHBoYTsgLy8gbm9ybWFsaXplIGJ5IHNpemUKICAgICAgdGhpcy5iZXRhID0ganNvbi5iZXRhOwogICAgICB0aGlzLm91dF9zeCA9IGpzb24ub3V0X3N4OwogICAgICB0aGlzLm91dF9zeSA9IGpzb24ub3V0X3N5OwogICAgICB0aGlzLm91dF9kZXB0aCA9IGpzb24ub3V0X2RlcHRoOwogICAgICB0aGlzLmxheWVyX3R5cGUgPSBqc29uLmxheWVyX3R5cGU7CiAgICB9CiAgfTsKICBnbG9iYWwuTG9jYWxSZXNwb25zZU5vcm1hbGl6YXRpb25MYXllciA9IExvY2FsUmVzcG9uc2VOb3JtYWxpemF0aW9uTGF5ZXI7Cn0pKGNvbnZuZXRqcyk7CihmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgInVzZSBzdHJpY3QiOwoKICB2YXIgVm9sID0gZ2xvYmFsLlZvbDsgLy8gY29udmVuaWVuY2UKICB2YXIgYXNzZXJ0ID0gZ2xvYmFsLmFzc2VydDsKCiAgLy8gTmV0IG1hbmFnZXMgYSBzZXQgb2YgbGF5ZXJzCiAgLy8gRm9yIG5vdyBjb25zdHJhaW50czogU2ltcGxlIGxpbmVhciBvcmRlciBvZiBsYXllcnMsIGZpcnN0IGxheWVyIGlucHV0IGxhc3QgbGF5ZXIgYSBjb3N0IGxheWVyCiAgdmFyIE5ldCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB0aGlzLmxheWVycyA9IFtdOwogIH07CiAgTmV0LnByb3RvdHlwZSA9IHsKICAgIC8vIHRha2VzIGEgbGlzdCBvZiBsYXllciBkZWZpbml0aW9ucyBhbmQgY3JlYXRlcyB0aGUgbmV0d29yayBsYXllciBvYmplY3RzCiAgICBtYWtlTGF5ZXJzOiBmdW5jdGlvbiAoZGVmcykgewogICAgICAvLyBmZXcgY2hlY2tzCiAgICAgIGFzc2VydChkZWZzLmxlbmd0aCA+PSAyLCAnRXJyb3IhIEF0IGxlYXN0IG9uZSBpbnB1dCBsYXllciBhbmQgb25lIGxvc3MgbGF5ZXIgYXJlIHJlcXVpcmVkLicpOwogICAgICBhc3NlcnQoZGVmc1swXS50eXBlID09PSAnaW5wdXQnLCAnRXJyb3IhIEZpcnN0IGxheWVyIG11c3QgYmUgdGhlIGlucHV0IGxheWVyLCB0byBkZWNsYXJlIHNpemUgb2YgaW5wdXRzJyk7CgogICAgICAvLyBkZXN1Z2FyIGxheWVyX2RlZnMgZm9yIGFkZGluZyBhY3RpdmF0aW9uLCBkcm9wb3V0IGxheWVycyBldGMKICAgICAgdmFyIGRlc3VnYXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG5ld19kZWZzID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWZzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgZGVmID0gZGVmc1tpXTsKICAgICAgICAgIGlmIChkZWYudHlwZSA9PT0gJ3NvZnRtYXgnIHx8IGRlZi50eXBlID09PSAnc3ZtJykgewogICAgICAgICAgICAvLyBhZGQgYW4gZmMgbGF5ZXIgaGVyZSwgdGhlcmUgaXMgbm8gcmVhc29uIHRoZSB1c2VyIHNob3VsZAogICAgICAgICAgICAvLyBoYXZlIHRvIHdvcnJ5IGFib3V0IHRoaXMgYW5kIHdlIGFsbW9zdCBhbHdheXMgd2FudCB0bwogICAgICAgICAgICBuZXdfZGVmcy5wdXNoKHsKICAgICAgICAgICAgICB0eXBlOiAnZmMnLAogICAgICAgICAgICAgIG51bV9uZXVyb25zOiBkZWYubnVtX2NsYXNzZXMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZGVmLnR5cGUgPT09ICdyZWdyZXNzaW9uJykgewogICAgICAgICAgICAvLyBhZGQgYW4gZmMgbGF5ZXIgaGVyZSwgdGhlcmUgaXMgbm8gcmVhc29uIHRoZSB1c2VyIHNob3VsZAogICAgICAgICAgICAvLyBoYXZlIHRvIHdvcnJ5IGFib3V0IHRoaXMgYW5kIHdlIGFsbW9zdCBhbHdheXMgd2FudCB0bwogICAgICAgICAgICBuZXdfZGVmcy5wdXNoKHsKICAgICAgICAgICAgICB0eXBlOiAnZmMnLAogICAgICAgICAgICAgIG51bV9uZXVyb25zOiBkZWYubnVtX25ldXJvbnMKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKGRlZi50eXBlID09PSAnZmMnIHx8IGRlZi50eXBlID09PSAnY29udicpICYmIHR5cGVvZiBkZWYuYmlhc19wcmVmID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBkZWYuYmlhc19wcmVmID0gMC4wOwogICAgICAgICAgICBpZiAodHlwZW9mIGRlZi5hY3RpdmF0aW9uICE9PSAndW5kZWZpbmVkJyAmJiBkZWYuYWN0aXZhdGlvbiA9PT0gJ3JlbHUnKSB7CiAgICAgICAgICAgICAgZGVmLmJpYXNfcHJlZiA9IDAuMTsgLy8gcmVsdXMgbGlrZSBhIGJpdCBvZiBwb3NpdGl2ZSBiaWFzIHRvIGdldCBncmFkaWVudHMgZWFybHkKICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgaXQncyB0ZWNobmljYWxseSBwb3NzaWJsZSB0aGF0IGEgcmVsdSB1bml0IHdpbGwgbmV2ZXIgdHVybiBvbiAoYnkgY2hhbmNlKQogICAgICAgICAgICAgIC8vIGFuZCB3aWxsIG5ldmVyIGdldCBhbnkgZ3JhZGllbnQgYW5kIG5ldmVyIGNvbnRyaWJ1dGUgYW55IGNvbXB1dGF0aW9uLiBEZWFkIHJlbHUuCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG5ld19kZWZzLnB1c2goZGVmKTsKICAgICAgICAgIGlmICh0eXBlb2YgZGVmLmFjdGl2YXRpb24gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIGlmIChkZWYuYWN0aXZhdGlvbiA9PT0gJ3JlbHUnKSB7CiAgICAgICAgICAgICAgbmV3X2RlZnMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAncmVsdScKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkZWYuYWN0aXZhdGlvbiA9PT0gJ3NpZ21vaWQnKSB7CiAgICAgICAgICAgICAgbmV3X2RlZnMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAnc2lnbW9pZCcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkZWYuYWN0aXZhdGlvbiA9PT0gJ3RhbmgnKSB7CiAgICAgICAgICAgICAgbmV3X2RlZnMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAndGFuaCcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkZWYuYWN0aXZhdGlvbiA9PT0gJ21heG91dCcpIHsKICAgICAgICAgICAgICAvLyBjcmVhdGUgbWF4b3V0IGFjdGl2YXRpb24sIGFuZCBwYXNzIGFsb25nIGdyb3VwIHNpemUsIGlmIHByb3ZpZGVkCiAgICAgICAgICAgICAgdmFyIGdzID0gZGVmLmdyb3VwX3NpemUgIT09ICd1bmRlZmluZWQnID8gZGVmLmdyb3VwX3NpemUgOiAyOwogICAgICAgICAgICAgIG5ld19kZWZzLnB1c2goewogICAgICAgICAgICAgICAgdHlwZTogJ21heG91dCcsCiAgICAgICAgICAgICAgICBncm91cF9zaXplOiBncwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUiB1bnN1cHBvcnRlZCBhY3RpdmF0aW9uICcgKyBkZWYuYWN0aXZhdGlvbik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgZGVmLmRyb3BfcHJvYiAhPT0gJ3VuZGVmaW5lZCcgJiYgZGVmLnR5cGUgIT09ICdkcm9wb3V0JykgewogICAgICAgICAgICBuZXdfZGVmcy5wdXNoKHsKICAgICAgICAgICAgICB0eXBlOiAnZHJvcG91dCcsCiAgICAgICAgICAgICAgZHJvcF9wcm9iOiBkZWYuZHJvcF9wcm9iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3X2RlZnM7CiAgICAgIH07CiAgICAgIGRlZnMgPSBkZXN1Z2FyKGRlZnMpOwoKICAgICAgLy8gY3JlYXRlIHRoZSBsYXllcnMKICAgICAgdGhpcy5sYXllcnMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWZzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGRlZiA9IGRlZnNbaV07CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICB2YXIgcHJldiA9IHRoaXMubGF5ZXJzW2kgLSAxXTsKICAgICAgICAgIGRlZi5pbl9zeCA9IHByZXYub3V0X3N4OwogICAgICAgICAgZGVmLmluX3N5ID0gcHJldi5vdXRfc3k7CiAgICAgICAgICBkZWYuaW5fZGVwdGggPSBwcmV2Lm91dF9kZXB0aDsKICAgICAgICB9CiAgICAgICAgc3dpdGNoIChkZWYudHlwZSkgewogICAgICAgICAgY2FzZSAnZmMnOgogICAgICAgICAgICB0aGlzLmxheWVycy5wdXNoKG5ldyBnbG9iYWwuRnVsbHlDb25uTGF5ZXIoZGVmKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnbHJuJzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLkxvY2FsUmVzcG9uc2VOb3JtYWxpemF0aW9uTGF5ZXIoZGVmKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnZHJvcG91dCc6CiAgICAgICAgICAgIHRoaXMubGF5ZXJzLnB1c2gobmV3IGdsb2JhbC5Ecm9wb3V0TGF5ZXIoZGVmKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnaW5wdXQnOgogICAgICAgICAgICB0aGlzLmxheWVycy5wdXNoKG5ldyBnbG9iYWwuSW5wdXRMYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdzb2Z0bWF4JzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLlNvZnRtYXhMYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdyZWdyZXNzaW9uJzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLlJlZ3Jlc3Npb25MYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdjb252JzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLkNvbnZMYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdwb29sJzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLlBvb2xMYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdyZWx1JzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLlJlbHVMYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdzaWdtb2lkJzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLlNpZ21vaWRMYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICd0YW5oJzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLlRhbmhMYXllcihkZWYpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdtYXhvdXQnOgogICAgICAgICAgICB0aGlzLmxheWVycy5wdXNoKG5ldyBnbG9iYWwuTWF4b3V0TGF5ZXIoZGVmKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnc3ZtJzoKICAgICAgICAgICAgdGhpcy5sYXllcnMucHVzaChuZXcgZ2xvYmFsLlNWTUxheWVyKGRlZikpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUjogVU5SRUNPR05JWkVEIExBWUVSIFRZUEU6ICcgKyBkZWYudHlwZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8gZm9yd2FyZCBwcm9wIHRoZSBuZXR3b3JrLiAKICAgIC8vIFRoZSB0cmFpbmVyIGNsYXNzIHBhc3NlcyBpc190cmFpbmluZyA9IHRydWUsIGJ1dCB3aGVuIHRoaXMgZnVuY3Rpb24gaXMKICAgIC8vIGNhbGxlZCBmcm9tIG91dHNpZGUgKG5vdCBmcm9tIHRoZSB0cmFpbmVyKSwgaXQgZGVmYXVsdHMgdG8gcHJlZGljdGlvbiBtb2RlCiAgICBmb3J3YXJkOiBmdW5jdGlvbiAoViwgaXNfdHJhaW5pbmcpIHsKICAgICAgaWYgKHR5cGVvZiBpc190cmFpbmluZyA9PT0gJ3VuZGVmaW5lZCcpIGlzX3RyYWluaW5nID0gZmFsc2U7CiAgICAgIHZhciBhY3QgPSB0aGlzLmxheWVyc1swXS5mb3J3YXJkKFYsIGlzX3RyYWluaW5nKTsKICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLmxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGFjdCA9IHRoaXMubGF5ZXJzW2ldLmZvcndhcmQoYWN0LCBpc190cmFpbmluZyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGFjdDsKICAgIH0sCiAgICBnZXRDb3N0TG9zczogZnVuY3Rpb24gKFYsIHkpIHsKICAgICAgdGhpcy5mb3J3YXJkKFYsIGZhbHNlKTsKICAgICAgdmFyIE4gPSB0aGlzLmxheWVycy5sZW5ndGg7CiAgICAgIHZhciBsb3NzID0gdGhpcy5sYXllcnNbTiAtIDFdLmJhY2t3YXJkKHkpOwogICAgICByZXR1cm4gbG9zczsKICAgIH0sCiAgICAvLyBiYWNrcHJvcDogY29tcHV0ZSBncmFkaWVudHMgd3J0IGFsbCBwYXJhbWV0ZXJzCiAgICBiYWNrd2FyZDogZnVuY3Rpb24gKHkpIHsKICAgICAgdmFyIE4gPSB0aGlzLmxheWVycy5sZW5ndGg7CiAgICAgIHZhciBsb3NzID0gdGhpcy5sYXllcnNbTiAtIDFdLmJhY2t3YXJkKHkpOyAvLyBsYXN0IGxheWVyIGFzc3VtZWQgdG8gYmUgbG9zcyBsYXllcgogICAgICBmb3IgKHZhciBpID0gTiAtIDI7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgLy8gZmlyc3QgbGF5ZXIgYXNzdW1lZCBpbnB1dAogICAgICAgIHRoaXMubGF5ZXJzW2ldLmJhY2t3YXJkKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIGxvc3M7CiAgICB9LAogICAgZ2V0UGFyYW1zQW5kR3JhZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gYWNjdW11bGF0ZSBwYXJhbWV0ZXJzIGFuZCBncmFkaWVudHMgZm9yIHRoZSBlbnRpcmUgbmV0d29yawogICAgICB2YXIgcmVzcG9uc2UgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBsYXllcl9yZXBvbnNlID0gdGhpcy5sYXllcnNbaV0uZ2V0UGFyYW1zQW5kR3JhZHMoKTsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGxheWVyX3JlcG9uc2UubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIHJlc3BvbnNlLnB1c2gobGF5ZXJfcmVwb25zZVtqXSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0sCiAgICBnZXRQcmVkaWN0aW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIHRoaXMgaXMgYSBjb252ZW5pZW5jZSBmdW5jdGlvbiBmb3IgcmV0dXJuaW5nIHRoZSBhcmdtYXgKICAgICAgLy8gcHJlZGljdGlvbiwgYXNzdW1pbmcgdGhlIGxhc3QgbGF5ZXIgb2YgdGhlIG5ldCBpcyBhIHNvZnRtYXgKICAgICAgdmFyIFMgPSB0aGlzLmxheWVyc1t0aGlzLmxheWVycy5sZW5ndGggLSAxXTsKICAgICAgYXNzZXJ0KFMubGF5ZXJfdHlwZSA9PT0gJ3NvZnRtYXgnLCAnZ2V0UHJlZGljdGlvbiBmdW5jdGlvbiBhc3N1bWVzIHNvZnRtYXggYXMgbGFzdCBsYXllciBvZiB0aGUgbmV0IScpOwogICAgICB2YXIgcCA9IFMub3V0X2FjdC53OwogICAgICB2YXIgbWF4diA9IHBbMF07CiAgICAgIHZhciBtYXhpID0gMDsKICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBwLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHBbaV0gPiBtYXh2KSB7CiAgICAgICAgICBtYXh2ID0gcFtpXTsKICAgICAgICAgIG1heGkgPSBpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbWF4aTsgLy8gcmV0dXJuIGluZGV4IG9mIHRoZSBjbGFzcyB3aXRoIGhpZ2hlc3QgY2xhc3MgcHJvYmFiaWxpdHkKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGpzb24gPSB7fTsKICAgICAganNvbi5sYXllcnMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGpzb24ubGF5ZXJzLnB1c2godGhpcy5sYXllcnNbaV0udG9KU09OKCkpOwogICAgICB9CiAgICAgIHJldHVybiBqc29uOwogICAgfSwKICAgIGZyb21KU09OOiBmdW5jdGlvbiAoanNvbikgewogICAgICB0aGlzLmxheWVycyA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGpzb24ubGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIExqID0ganNvbi5sYXllcnNbaV07CiAgICAgICAgdmFyIHQgPSBMai5sYXllcl90eXBlOwogICAgICAgIHZhciBMOwogICAgICAgIGlmICh0ID09PSAnaW5wdXQnKSB7CiAgICAgICAgICBMID0gbmV3IGdsb2JhbC5JbnB1dExheWVyKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0ID09PSAncmVsdScpIHsKICAgICAgICAgIEwgPSBuZXcgZ2xvYmFsLlJlbHVMYXllcigpOwogICAgICAgIH0KICAgICAgICBpZiAodCA9PT0gJ3NpZ21vaWQnKSB7CiAgICAgICAgICBMID0gbmV3IGdsb2JhbC5TaWdtb2lkTGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHQgPT09ICd0YW5oJykgewogICAgICAgICAgTCA9IG5ldyBnbG9iYWwuVGFuaExheWVyKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0ID09PSAnZHJvcG91dCcpIHsKICAgICAgICAgIEwgPSBuZXcgZ2xvYmFsLkRyb3BvdXRMYXllcigpOwogICAgICAgIH0KICAgICAgICBpZiAodCA9PT0gJ2NvbnYnKSB7CiAgICAgICAgICBMID0gbmV3IGdsb2JhbC5Db252TGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHQgPT09ICdwb29sJykgewogICAgICAgICAgTCA9IG5ldyBnbG9iYWwuUG9vbExheWVyKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0ID09PSAnbHJuJykgewogICAgICAgICAgTCA9IG5ldyBnbG9iYWwuTG9jYWxSZXNwb25zZU5vcm1hbGl6YXRpb25MYXllcigpOwogICAgICAgIH0KICAgICAgICBpZiAodCA9PT0gJ3NvZnRtYXgnKSB7CiAgICAgICAgICBMID0gbmV3IGdsb2JhbC5Tb2Z0bWF4TGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHQgPT09ICdyZWdyZXNzaW9uJykgewogICAgICAgICAgTCA9IG5ldyBnbG9iYWwuUmVncmVzc2lvbkxheWVyKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0ID09PSAnZmMnKSB7CiAgICAgICAgICBMID0gbmV3IGdsb2JhbC5GdWxseUNvbm5MYXllcigpOwogICAgICAgIH0KICAgICAgICBpZiAodCA9PT0gJ21heG91dCcpIHsKICAgICAgICAgIEwgPSBuZXcgZ2xvYmFsLk1heG91dExheWVyKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0ID09PSAnc3ZtJykgewogICAgICAgICAgTCA9IG5ldyBnbG9iYWwuU1ZNTGF5ZXIoKTsKICAgICAgICB9CiAgICAgICAgTC5mcm9tSlNPTihMaik7CiAgICAgICAgdGhpcy5sYXllcnMucHVzaChMKTsKICAgICAgfQogICAgfQogIH07CiAgZ2xvYmFsLk5ldCA9IE5ldDsKfSkoY29udm5ldGpzKTsKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIHZhciBWb2wgPSBnbG9iYWwuVm9sOyAvLyBjb252ZW5pZW5jZQoKICB2YXIgVHJhaW5lciA9IGZ1bmN0aW9uIChuZXQsIG9wdGlvbnMpIHsKICAgIHRoaXMubmV0ID0gbmV0OwogICAgdmFyIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgdGhpcy5sZWFybmluZ19yYXRlID0gdHlwZW9mIG9wdGlvbnMubGVhcm5pbmdfcmF0ZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmxlYXJuaW5nX3JhdGUgOiAwLjAxOwogICAgdGhpcy5sMV9kZWNheSA9IHR5cGVvZiBvcHRpb25zLmwxX2RlY2F5ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubDFfZGVjYXkgOiAwLjA7CiAgICB0aGlzLmwyX2RlY2F5ID0gdHlwZW9mIG9wdGlvbnMubDJfZGVjYXkgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5sMl9kZWNheSA6IDAuMDsKICAgIHRoaXMuYmF0Y2hfc2l6ZSA9IHR5cGVvZiBvcHRpb25zLmJhdGNoX3NpemUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5iYXRjaF9zaXplIDogMTsKICAgIHRoaXMubWV0aG9kID0gdHlwZW9mIG9wdGlvbnMubWV0aG9kICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWV0aG9kIDogJ3NnZCc7IC8vIHNnZC9hZGFtL2FkYWdyYWQvYWRhZGVsdGEvd2luZG93Z3JhZC9uZXRzdGVyb3YKCiAgICB0aGlzLm1vbWVudHVtID0gdHlwZW9mIG9wdGlvbnMubW9tZW50dW0gIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tb21lbnR1bSA6IDAuOTsKICAgIHRoaXMucm8gPSB0eXBlb2Ygb3B0aW9ucy5ybyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnJvIDogMC45NTsgLy8gdXNlZCBpbiBhZGFkZWx0YQogICAgdGhpcy5lcHMgPSB0eXBlb2Ygb3B0aW9ucy5lcHMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5lcHMgOiAxZS04OyAvLyB1c2VkIGluIGFkYW0gb3IgYWRhZGVsdGEKICAgIHRoaXMuYmV0YTEgPSB0eXBlb2Ygb3B0aW9ucy5iZXRhMSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmJldGExIDogMC45OyAvLyB1c2VkIGluIGFkYW0KICAgIHRoaXMuYmV0YTIgPSB0eXBlb2Ygb3B0aW9ucy5iZXRhMiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmJldGEyIDogMC45OTk7IC8vIHVzZWQgaW4gYWRhbQogICAgdGhpcy5sYW1iZGEgPSB0eXBlb2Ygb3B0aW9ucy5sYW1iZGEgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5sYW1iZGEgOiAxIC0gMWUtODsgLy8gdXNlZCBpbiBhZGFtCgogICAgdGhpcy5rID0gMDsgLy8gaXRlcmF0aW9uIGNvdW50ZXIKICAgIHRoaXMuZ3N1bSA9IFtdOyAvLyBsYXN0IGl0ZXJhdGlvbiBncmFkaWVudHMgKHVzZWQgZm9yIG1vbWVudHVtIGNhbGN1bGF0aW9ucykKICAgIHRoaXMueHN1bSA9IFtdOyAvLyB1c2VkIGluIGFkYW0gb3IgYWRhZGVsdGEKICB9OwogIFRyYWluZXIucHJvdG90eXBlID0gewogICAgdHJhaW46IGZ1bmN0aW9uICh4LCB5KSB7CiAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICB0aGlzLm5ldC5mb3J3YXJkKHgsIHRydWUpOyAvLyBhbHNvIHNldCB0aGUgZmxhZyB0aGF0IGxldHMgdGhlIG5ldCBrbm93IHdlJ3JlIGp1c3QgdHJhaW5pbmcKICAgICAgdmFyIGVuZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICB2YXIgZndkX3RpbWUgPSBlbmQgLSBzdGFydDsKICAgICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHZhciBjb3N0X2xvc3MgPSB0aGlzLm5ldC5iYWNrd2FyZCh5KTsKICAgICAgdmFyIGwyX2RlY2F5X2xvc3MgPSAwLjA7CiAgICAgIHZhciBsMV9kZWNheV9sb3NzID0gMC4wOwogICAgICB2YXIgZW5kID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHZhciBid2RfdGltZSA9IGVuZCAtIHN0YXJ0OwogICAgICB0aGlzLmsrKzsKICAgICAgaWYgKHRoaXMuayAlIHRoaXMuYmF0Y2hfc2l6ZSA9PT0gMCkgewogICAgICAgIHZhciBwZ2xpc3QgPSB0aGlzLm5ldC5nZXRQYXJhbXNBbmRHcmFkcygpOwoKICAgICAgICAvLyBpbml0aWFsaXplIGxpc3RzIGZvciBhY2N1bXVsYXRvcnMuIFdpbGwgb25seSBiZSBkb25lIG9uY2Ugb24gZmlyc3QgaXRlcmF0aW9uCiAgICAgICAgaWYgKHRoaXMuZ3N1bS5sZW5ndGggPT09IDAgJiYgKHRoaXMubWV0aG9kICE9PSAnc2dkJyB8fCB0aGlzLm1vbWVudHVtID4gMC4wKSkgewogICAgICAgICAgLy8gb25seSB2YW5pbGxhIHNnZCBkb2VzbnQgbmVlZCBlaXRoZXIgbGlzdHMKICAgICAgICAgIC8vIG1vbWVudHVtIG5lZWRzIGdzdW0KICAgICAgICAgIC8vIGFkYWdyYWQgbmVlZHMgZ3N1bQogICAgICAgICAgLy8gYWRhbSBhbmQgYWRhZGVsdGEgbmVlZHMgZ3N1bSBhbmQgeHN1bQogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwZ2xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5nc3VtLnB1c2goZ2xvYmFsLnplcm9zKHBnbGlzdFtpXS5wYXJhbXMubGVuZ3RoKSk7CiAgICAgICAgICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gJ2FkYW0nIHx8IHRoaXMubWV0aG9kID09PSAnYWRhZGVsdGEnKSB7CiAgICAgICAgICAgICAgdGhpcy54c3VtLnB1c2goZ2xvYmFsLnplcm9zKHBnbGlzdFtpXS5wYXJhbXMubGVuZ3RoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy54c3VtLnB1c2goW10pOyAvLyBjb25zZXJ2ZSBtZW1vcnkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gcGVyZm9ybSBhbiB1cGRhdGUgZm9yIGFsbCBzZXRzIG9mIHdlaWdodHMKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBnbGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIHBnID0gcGdsaXN0W2ldOyAvLyBwYXJhbSwgZ3JhZGllbnQsIG90aGVyIG9wdGlvbnMgaW4gZnV0dXJlIChjdXN0b20gbGVhcm5pbmcgcmF0ZSBldGMpCiAgICAgICAgICB2YXIgcCA9IHBnLnBhcmFtczsKICAgICAgICAgIHZhciBnID0gcGcuZ3JhZHM7CgogICAgICAgICAgLy8gbGVhcm5pbmcgcmF0ZSBmb3Igc29tZSBwYXJhbWV0ZXJzLgogICAgICAgICAgdmFyIGwyX2RlY2F5X211bCA9IHR5cGVvZiBwZy5sMl9kZWNheV9tdWwgIT09ICd1bmRlZmluZWQnID8gcGcubDJfZGVjYXlfbXVsIDogMS4wOwogICAgICAgICAgdmFyIGwxX2RlY2F5X211bCA9IHR5cGVvZiBwZy5sMV9kZWNheV9tdWwgIT09ICd1bmRlZmluZWQnID8gcGcubDFfZGVjYXlfbXVsIDogMS4wOwogICAgICAgICAgdmFyIGwyX2RlY2F5ID0gdGhpcy5sMl9kZWNheSAqIGwyX2RlY2F5X211bDsKICAgICAgICAgIHZhciBsMV9kZWNheSA9IHRoaXMubDFfZGVjYXkgKiBsMV9kZWNheV9tdWw7CiAgICAgICAgICB2YXIgcGxlbiA9IHAubGVuZ3RoOwogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwbGVuOyBqKyspIHsKICAgICAgICAgICAgbDJfZGVjYXlfbG9zcyArPSBsMl9kZWNheSAqIHBbal0gKiBwW2pdIC8gMjsgLy8gYWNjdW11bGF0ZSB3ZWlnaHQgZGVjYXkgbG9zcwogICAgICAgICAgICBsMV9kZWNheV9sb3NzICs9IGwxX2RlY2F5ICogTWF0aC5hYnMocFtqXSk7CiAgICAgICAgICAgIHZhciBsMWdyYWQgPSBsMV9kZWNheSAqIChwW2pdID4gMCA/IDEgOiAtMSk7CiAgICAgICAgICAgIHZhciBsMmdyYWQgPSBsMl9kZWNheSAqIHBbal07CiAgICAgICAgICAgIHZhciBnaWogPSAobDJncmFkICsgbDFncmFkICsgZ1tqXSkgLyB0aGlzLmJhdGNoX3NpemU7IC8vIHJhdyBiYXRjaCBncmFkaWVudAoKICAgICAgICAgICAgdmFyIGdzdW1pID0gdGhpcy5nc3VtW2ldOwogICAgICAgICAgICB2YXIgeHN1bWkgPSB0aGlzLnhzdW1baV07CiAgICAgICAgICAgIGlmICh0aGlzLm1ldGhvZCA9PT0gJ2FkYW0nKSB7CiAgICAgICAgICAgICAgLy8gYWRhbSB1cGRhdGUKICAgICAgICAgICAgICB2YXIgYnQxID0gdGhpcy5iZXRhMSAqIE1hdGgucG93KHRoaXMubGFtYmRhLCB0aGlzLmsgLSAxKTsgLy8gZGVjYXkgZmlyc3QgbW9tZW50IHJ1bm5pbmcgYXZlcmFnZSBjb2VmZmljaWVudAogICAgICAgICAgICAgIGdzdW1pW2pdID0gZ3N1bWlbal0gKiBidDEgKyAoMSAtIGJ0MSkgKiBnaWo7IC8vIHVwZGF0ZSBiaWFzZWQgZmlyc3QgbW9tZW50IGVzdGltYXRlCiAgICAgICAgICAgICAgeHN1bWlbal0gPSB4c3VtaVtqXSAqIHRoaXMuYmV0YTIgKyAoMSAtIHRoaXMuYmV0YTIpICogZ2lqICogZ2lqOyAvLyB1cGRhdGUgYmlhc2VkIHNlY29uZCBtb21lbnQgZXN0aW1hdGUKICAgICAgICAgICAgICB2YXIgZGVub20gPSBNYXRoLnNxcnQoeHN1bWlbal0pICsgdGhpcy5lcHM7CiAgICAgICAgICAgICAgdmFyIGJpYXNDb3JyMSA9IDEgLSBNYXRoLnBvdyh0aGlzLmJldGExLCB0aGlzLmspOyAvLyBjb3JyZWN0IGJpYXMKICAgICAgICAgICAgICB2YXIgYmlhc0NvcnIyID0gMSAtIE1hdGgucG93KHRoaXMuYmV0YTIsIHRoaXMuayk7IC8vIGNvcnJlY3QgYmlhcwogICAgICAgICAgICAgIHZhciBzdGVwU2l6ZSA9IHRoaXMubGVhcm5pbmdfcmF0ZSAqIE1hdGguc3FydChiaWFzQ29ycjIpIC8gYmlhc0NvcnIxOwogICAgICAgICAgICAgIHZhciBkeCA9IHN0ZXBTaXplICogZ3N1bWlbal0gLyBkZW5vbTsKICAgICAgICAgICAgICBwW2pdICs9IGR4OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWV0aG9kID09PSAnYWRhZ3JhZCcpIHsKICAgICAgICAgICAgICAvLyBhZGFncmFkIHVwZGF0ZQogICAgICAgICAgICAgIGdzdW1pW2pdID0gZ3N1bWlbal0gKyBnaWogKiBnaWo7CiAgICAgICAgICAgICAgdmFyIGR4ID0gLXRoaXMubGVhcm5pbmdfcmF0ZSAvIE1hdGguc3FydChnc3VtaVtqXSArIHRoaXMuZXBzKSAqIGdpajsKICAgICAgICAgICAgICBwW2pdICs9IGR4OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWV0aG9kID09PSAnd2luZG93Z3JhZCcpIHsKICAgICAgICAgICAgICAvLyB0aGlzIGlzIGFkYWdyYWQgYnV0IHdpdGggYSBtb3Zpbmcgd2luZG93IHdlaWdodGVkIGF2ZXJhZ2UKICAgICAgICAgICAgICAvLyBzbyB0aGUgZ3JhZGllbnQgaXMgbm90IGFjY3VtdWxhdGVkIG92ZXIgdGhlIGVudGlyZSBoaXN0b3J5IG9mIHRoZSBydW4uIAogICAgICAgICAgICAgIC8vIGl0J3MgYWxzbyByZWZlcnJlZCB0byBhcyBJZGVhICMxIGluIFplaWxlciBwYXBlciBvbiBBZGFkZWx0YS4gU2VlbXMgcmVhc29uYWJsZSB0byBtZSEKICAgICAgICAgICAgICBnc3VtaVtqXSA9IHRoaXMucm8gKiBnc3VtaVtqXSArICgxIC0gdGhpcy5ybykgKiBnaWogKiBnaWo7CiAgICAgICAgICAgICAgdmFyIGR4ID0gLXRoaXMubGVhcm5pbmdfcmF0ZSAvIE1hdGguc3FydChnc3VtaVtqXSArIHRoaXMuZXBzKSAqIGdpajsgLy8gZXBzIGFkZGVkIGZvciBiZXR0ZXIgY29uZGl0aW9uaW5nCiAgICAgICAgICAgICAgcFtqXSArPSBkeDsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm1ldGhvZCA9PT0gJ2FkYWRlbHRhJykgewogICAgICAgICAgICAgIGdzdW1pW2pdID0gdGhpcy5ybyAqIGdzdW1pW2pdICsgKDEgLSB0aGlzLnJvKSAqIGdpaiAqIGdpajsKICAgICAgICAgICAgICB2YXIgZHggPSAtTWF0aC5zcXJ0KCh4c3VtaVtqXSArIHRoaXMuZXBzKSAvIChnc3VtaVtqXSArIHRoaXMuZXBzKSkgKiBnaWo7CiAgICAgICAgICAgICAgeHN1bWlbal0gPSB0aGlzLnJvICogeHN1bWlbal0gKyAoMSAtIHRoaXMucm8pICogZHggKiBkeDsgLy8geWVzLCB4c3VtIGxhZ3MgYmVoaW5kIGdzdW0gYnkgMS4KICAgICAgICAgICAgICBwW2pdICs9IGR4OwogICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWV0aG9kID09PSAnbmVzdGVyb3YnKSB7CiAgICAgICAgICAgICAgdmFyIGR4ID0gZ3N1bWlbal07CiAgICAgICAgICAgICAgZ3N1bWlbal0gPSBnc3VtaVtqXSAqIHRoaXMubW9tZW50dW0gKyB0aGlzLmxlYXJuaW5nX3JhdGUgKiBnaWo7CiAgICAgICAgICAgICAgZHggPSB0aGlzLm1vbWVudHVtICogZHggLSAoMS4wICsgdGhpcy5tb21lbnR1bSkgKiBnc3VtaVtqXTsKICAgICAgICAgICAgICBwW2pdICs9IGR4OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGFzc3VtZSBTR0QKICAgICAgICAgICAgICBpZiAodGhpcy5tb21lbnR1bSA+IDAuMCkgewogICAgICAgICAgICAgICAgLy8gbW9tZW50dW0gdXBkYXRlCiAgICAgICAgICAgICAgICB2YXIgZHggPSB0aGlzLm1vbWVudHVtICogZ3N1bWlbal0gLSB0aGlzLmxlYXJuaW5nX3JhdGUgKiBnaWo7IC8vIHN0ZXAKICAgICAgICAgICAgICAgIGdzdW1pW2pdID0gZHg7IC8vIGJhY2sgdGhpcyB1cCBmb3IgbmV4dCBpdGVyYXRpb24gb2YgbW9tZW50dW0KICAgICAgICAgICAgICAgIHBbal0gKz0gZHg7IC8vIGFwcGx5IGNvcnJlY3RlZCBncmFkaWVudAogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyB2YW5pbGxhIHNnZAogICAgICAgICAgICAgICAgcFtqXSArPSAtdGhpcy5sZWFybmluZ19yYXRlICogZ2lqOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBnW2pdID0gMC4wOyAvLyB6ZXJvIG91dCBncmFkaWVudCBzbyB0aGF0IHdlIGNhbiBiZWdpbiBhY2N1bXVsYXRpbmcgYW5ldwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gYXBwZW5kaW5nIHNvZnRtYXhfbG9zcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHksIGJ1dCBmcm9tIG5vdyBvbiB3ZSB3aWxsIGFsd2F5cyB1c2UgY29zdF9sb3NzCiAgICAgIC8vIGluIGZ1dHVyZSwgVE9ETzogaGF2ZSB0byBjb21wbGV0ZWx5IHJlZG8gdGhlIHdheSBsb3NzIGlzIGRvbmUgYXJvdW5kIHRoZSBuZXR3b3JrIGFzIGN1cnJlbnRseSAKICAgICAgLy8gbG9zcyBpcyBhIGJpdCBvZiBhIGhhY2suIElkZWFsbHksIHVzZXIgc2hvdWxkIHNwZWNpZnkgYXJiaXRyYXJ5IG51bWJlciBvZiBsb3NzIGZ1bmN0aW9ucyBvbiBhbnkgbGF5ZXIKICAgICAgLy8gYW5kIGl0IHNob3VsZCBhbGwgYmUgY29tcHV0ZWQgY29ycmVjdGx5IGFuZCBhdXRvbWF0aWNhbGx5LiAKICAgICAgcmV0dXJuIHsKICAgICAgICBmd2RfdGltZTogZndkX3RpbWUsCiAgICAgICAgYndkX3RpbWU6IGJ3ZF90aW1lLAogICAgICAgIGwyX2RlY2F5X2xvc3M6IGwyX2RlY2F5X2xvc3MsCiAgICAgICAgbDFfZGVjYXlfbG9zczogbDFfZGVjYXlfbG9zcywKICAgICAgICBjb3N0X2xvc3M6IGNvc3RfbG9zcywKICAgICAgICBzb2Z0bWF4X2xvc3M6IGNvc3RfbG9zcywKICAgICAgICBsb3NzOiBjb3N0X2xvc3MgKyBsMV9kZWNheV9sb3NzICsgbDJfZGVjYXlfbG9zcwogICAgICB9OwogICAgfQogIH07CiAgZ2xvYmFsLlRyYWluZXIgPSBUcmFpbmVyOwogIGdsb2JhbC5TR0RUcmFpbmVyID0gVHJhaW5lcjsgLy8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKfSkoY29udm5ldGpzKTsKKGZ1bmN0aW9uIChnbG9iYWwpIHsKICAidXNlIHN0cmljdCI7CgogIC8vIHVzZWQgdXRpbGl0aWVzLCBtYWtlIGV4cGxpY2l0IGxvY2FsIHJlZmVyZW5jZXMKICB2YXIgcmFuZGYgPSBnbG9iYWwucmFuZGY7CiAgdmFyIHJhbmRpID0gZ2xvYmFsLnJhbmRpOwogIHZhciBOZXQgPSBnbG9iYWwuTmV0OwogIHZhciBUcmFpbmVyID0gZ2xvYmFsLlRyYWluZXI7CiAgdmFyIG1heG1pbiA9IGdsb2JhbC5tYXhtaW47CiAgdmFyIHJhbmRwZXJtID0gZ2xvYmFsLnJhbmRwZXJtOwogIHZhciB3ZWlnaHRlZFNhbXBsZSA9IGdsb2JhbC53ZWlnaHRlZFNhbXBsZTsKICB2YXIgZ2V0b3B0ID0gZ2xvYmFsLmdldG9wdDsKICB2YXIgYXJyVW5pcXVlID0gZ2xvYmFsLmFyclVuaXF1ZTsKCiAgLyoNCiAgQSBNYWdpY05ldCB0YWtlcyBkYXRhOiBhIGxpc3Qgb2YgY29udm5ldGpzLlZvbCgpLCBhbmQgbGFiZWxzDQogIHdoaWNoIGZvciBub3cgYXJlIGFzc3VtZWQgdG8gYmUgY2xhc3MgaW5kZWNlcyAwLi5LLiBNYWdpY05ldCB0aGVuOg0KICAtIGNyZWF0ZXMgZGF0YSBmb2xkcyBmb3IgY3Jvc3MtdmFsaWRhdGlvbg0KICAtIHNhbXBsZXMgY2FuZGlkYXRlIG5ldHdvcmtzDQogIC0gZXZhbHVhdGVzIGNhbmRpZGF0ZSBuZXR3b3JrcyBvbiBhbGwgZGF0YSBmb2xkcw0KICAtIHByb2R1Y2VzIHByZWRpY3Rpb25zIGJ5IG1vZGVsLWF2ZXJhZ2luZyB0aGUgYmVzdCBuZXR3b3Jrcw0KICAqLwogIHZhciBNYWdpY05ldCA9IGZ1bmN0aW9uIChkYXRhLCBsYWJlbHMsIG9wdCkgewogICAgdmFyIG9wdCA9IG9wdCB8fCB7fTsKICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgZGF0YSA9IFtdOwogICAgfQogICAgaWYgKHR5cGVvZiBsYWJlbHMgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIGxhYmVscyA9IFtdOwogICAgfQoKICAgIC8vIHJlcXVpcmVkIGlucHV0cwogICAgdGhpcy5kYXRhID0gZGF0YTsgLy8gc3RvcmUgdGhlc2UgcG9pbnRlcnMgdG8gZGF0YQogICAgdGhpcy5sYWJlbHMgPSBsYWJlbHM7CgogICAgLy8gb3B0aW9uYWwgaW5wdXRzCiAgICB0aGlzLnRyYWluX3JhdGlvID0gZ2V0b3B0KG9wdCwgJ3RyYWluX3JhdGlvJywgMC43KTsKICAgIHRoaXMubnVtX2ZvbGRzID0gZ2V0b3B0KG9wdCwgJ251bV9mb2xkcycsIDEwKTsKICAgIHRoaXMubnVtX2NhbmRpZGF0ZXMgPSBnZXRvcHQob3B0LCAnbnVtX2NhbmRpZGF0ZXMnLCA1MCk7IC8vIHdlIGV2YWx1YXRlIHNldmVyYWwgaW4gcGFyYWxsZWwKICAgIC8vIGhvdyBtYW55IGVwb2NocyBvZiBkYXRhIHRvIHRyYWluIGV2ZXJ5IG5ldHdvcms/IGZvciBldmVyeSBmb2xkPwogICAgLy8gaGlnaGVyIHZhbHVlcyBtZWFuIGhpZ2hlciBhY2N1cmFjeSBpbiBmaW5hbCByZXN1bHRzLCBidXQgbW9yZSBleHBlbnNpdmUKICAgIHRoaXMubnVtX2Vwb2NocyA9IGdldG9wdChvcHQsICdudW1fZXBvY2hzJywgNTApOwogICAgLy8gbnVtYmVyIG9mIGJlc3QgbW9kZWxzIHRvIGF2ZXJhZ2UgZHVyaW5nIHByZWRpY3Rpb24uIFVzdWFsbHkgaGlnaGVyID0gYmV0dGVyCiAgICB0aGlzLmVuc2VtYmxlX3NpemUgPSBnZXRvcHQob3B0LCAnZW5zZW1ibGVfc2l6ZScsIDEwKTsKCiAgICAvLyBjYW5kaWRhdGUgcGFyYW1ldGVycwogICAgdGhpcy5iYXRjaF9zaXplX21pbiA9IGdldG9wdChvcHQsICdiYXRjaF9zaXplX21pbicsIDEwKTsKICAgIHRoaXMuYmF0Y2hfc2l6ZV9tYXggPSBnZXRvcHQob3B0LCAnYmF0Y2hfc2l6ZV9tYXgnLCAzMDApOwogICAgdGhpcy5sMl9kZWNheV9taW4gPSBnZXRvcHQob3B0LCAnbDJfZGVjYXlfbWluJywgLTQpOwogICAgdGhpcy5sMl9kZWNheV9tYXggPSBnZXRvcHQob3B0LCAnbDJfZGVjYXlfbWF4JywgMik7CiAgICB0aGlzLmxlYXJuaW5nX3JhdGVfbWluID0gZ2V0b3B0KG9wdCwgJ2xlYXJuaW5nX3JhdGVfbWluJywgLTQpOwogICAgdGhpcy5sZWFybmluZ19yYXRlX21heCA9IGdldG9wdChvcHQsICdsZWFybmluZ19yYXRlX21heCcsIDApOwogICAgdGhpcy5tb21lbnR1bV9taW4gPSBnZXRvcHQob3B0LCAnbW9tZW50dW1fbWluJywgMC45KTsKICAgIHRoaXMubW9tZW50dW1fbWF4ID0gZ2V0b3B0KG9wdCwgJ21vbWVudHVtX21heCcsIDAuOSk7CiAgICB0aGlzLm5ldXJvbnNfbWluID0gZ2V0b3B0KG9wdCwgJ25ldXJvbnNfbWluJywgNSk7CiAgICB0aGlzLm5ldXJvbnNfbWF4ID0gZ2V0b3B0KG9wdCwgJ25ldXJvbnNfbWF4JywgMzApOwoKICAgIC8vIGNvbXB1dGVkCiAgICB0aGlzLmZvbGRzID0gW107IC8vIGRhdGEgZm9sZCBpbmRpY2VzLCBnZXRzIGZpbGxlZCBieSBzYW1wbGVGb2xkcygpCiAgICB0aGlzLmNhbmRpZGF0ZXMgPSBbXTsgLy8gY2FuZGlkYXRlIG5ldHdvcmtzIHRoYXQgYXJlIGJlaW5nIGN1cnJlbnRseSBldmFsdWF0ZWQKICAgIHRoaXMuZXZhbHVhdGVkX2NhbmRpZGF0ZXMgPSBbXTsgLy8gaGlzdG9yeSBvZiBhbGwgY2FuZGlkYXRlcyB0aGF0IHdlcmUgZnVsbHkgZXZhbHVhdGVkIG9uIGFsbCBmb2xkcwogICAgdGhpcy51bmlxdWVfbGFiZWxzID0gYXJyVW5pcXVlKGxhYmVscyk7CiAgICB0aGlzLml0ZXIgPSAwOyAvLyBpdGVyYXRpb24gY291bnRlciwgZ29lcyBmcm9tIDAgLT4gbnVtX2Vwb2NocyAqIG51bV90cmFpbmluZ19kYXRhCiAgICB0aGlzLmZvbGRpeCA9IDA7IC8vIGluZGV4IG9mIGFjdGl2ZSBmb2xkCgogICAgLy8gY2FsbGJhY2tzCiAgICB0aGlzLmZpbmlzaF9mb2xkX2NhbGxiYWNrID0gbnVsbDsKICAgIHRoaXMuZmluaXNoX2JhdGNoX2NhbGxiYWNrID0gbnVsbDsKCiAgICAvLyBpbml0aWFsaXphdGlvbnMKICAgIGlmICh0aGlzLmRhdGEubGVuZ3RoID4gMCkgewogICAgICB0aGlzLnNhbXBsZUZvbGRzKCk7CiAgICAgIHRoaXMuc2FtcGxlQ2FuZGlkYXRlcygpOwogICAgfQogIH07CiAgTWFnaWNOZXQucHJvdG90eXBlID0gewogICAgLy8gc2V0cyB0aGlzLmZvbGRzIHRvIGEgc2FtcGxpbmcgb2YgdGhpcy5udW1fZm9sZHMgZm9sZHMKICAgIHNhbXBsZUZvbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBOID0gdGhpcy5kYXRhLmxlbmd0aDsKICAgICAgdmFyIG51bV90cmFpbiA9IE1hdGguZmxvb3IodGhpcy50cmFpbl9yYXRpbyAqIE4pOwogICAgICB0aGlzLmZvbGRzID0gW107IC8vIGZsdXNoIGZvbGRzLCBpZiBhbnkKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm51bV9mb2xkczsgaSsrKSB7CiAgICAgICAgdmFyIHAgPSByYW5kcGVybShOKTsKICAgICAgICB0aGlzLmZvbGRzLnB1c2goewogICAgICAgICAgdHJhaW5faXg6IHAuc2xpY2UoMCwgbnVtX3RyYWluKSwKICAgICAgICAgIHRlc3RfaXg6IHAuc2xpY2UobnVtX3RyYWluLCBOKQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy8gcmV0dXJucyBhIHJhbmRvbSBjYW5kaWRhdGUgbmV0d29yawogICAgc2FtcGxlQ2FuZGlkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBpbnB1dF9kZXB0aCA9IHRoaXMuZGF0YVswXS53Lmxlbmd0aDsKICAgICAgdmFyIG51bV9jbGFzc2VzID0gdGhpcy51bmlxdWVfbGFiZWxzLmxlbmd0aDsKCiAgICAgIC8vIHNhbXBsZSBuZXR3b3JrIHRvcG9sb2d5IGFuZCBoeXBlcnBhcmFtZXRlcnMKICAgICAgdmFyIGxheWVyX2RlZnMgPSBbXTsKICAgICAgbGF5ZXJfZGVmcy5wdXNoKHsKICAgICAgICB0eXBlOiAnaW5wdXQnLAogICAgICAgIG91dF9zeDogMSwKICAgICAgICBvdXRfc3k6IDEsCiAgICAgICAgb3V0X2RlcHRoOiBpbnB1dF9kZXB0aAogICAgICB9KTsKICAgICAgdmFyIG5sID0gd2VpZ2h0ZWRTYW1wbGUoWzAsIDEsIDIsIDNdLCBbMC4yLCAwLjMsIDAuMywgMC4yXSk7IC8vIHByZWZlciBuZXRzIHdpdGggMSwyIGhpZGRlbiBsYXllcnMKICAgICAgZm9yICh2YXIgcSA9IDA7IHEgPCBubDsgcSsrKSB7CiAgICAgICAgdmFyIG5pID0gcmFuZGkodGhpcy5uZXVyb25zX21pbiwgdGhpcy5uZXVyb25zX21heCk7CiAgICAgICAgdmFyIGFjdCA9IFsndGFuaCcsICdtYXhvdXQnLCAncmVsdSddW3JhbmRpKDAsIDMpXTsKICAgICAgICBpZiAocmFuZGYoMCwgMSkgPCAwLjUpIHsKICAgICAgICAgIHZhciBkcCA9IE1hdGgucmFuZG9tKCk7CiAgICAgICAgICBsYXllcl9kZWZzLnB1c2goewogICAgICAgICAgICB0eXBlOiAnZmMnLAogICAgICAgICAgICBudW1fbmV1cm9uczogbmksCiAgICAgICAgICAgIGFjdGl2YXRpb246IGFjdCwKICAgICAgICAgICAgZHJvcF9wcm9iOiBkcAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxheWVyX2RlZnMucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICdmYycsCiAgICAgICAgICAgIG51bV9uZXVyb25zOiBuaSwKICAgICAgICAgICAgYWN0aXZhdGlvbjogYWN0CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGF5ZXJfZGVmcy5wdXNoKHsKICAgICAgICB0eXBlOiAnc29mdG1heCcsCiAgICAgICAgbnVtX2NsYXNzZXM6IG51bV9jbGFzc2VzCiAgICAgIH0pOwogICAgICB2YXIgbmV0ID0gbmV3IE5ldCgpOwogICAgICBuZXQubWFrZUxheWVycyhsYXllcl9kZWZzKTsKCiAgICAgIC8vIHNhbXBsZSB0cmFpbmluZyBoeXBlcnBhcmFtZXRlcnMKICAgICAgdmFyIGJzID0gcmFuZGkodGhpcy5iYXRjaF9zaXplX21pbiwgdGhpcy5iYXRjaF9zaXplX21heCk7IC8vIGJhdGNoIHNpemUKICAgICAgdmFyIGwyID0gTWF0aC5wb3coMTAsIHJhbmRmKHRoaXMubDJfZGVjYXlfbWluLCB0aGlzLmwyX2RlY2F5X21heCkpOyAvLyBsMiB3ZWlnaHQgZGVjYXkKICAgICAgdmFyIGxyID0gTWF0aC5wb3coMTAsIHJhbmRmKHRoaXMubGVhcm5pbmdfcmF0ZV9taW4sIHRoaXMubGVhcm5pbmdfcmF0ZV9tYXgpKTsgLy8gbGVhcm5pbmcgcmF0ZQogICAgICB2YXIgbW9tID0gcmFuZGYodGhpcy5tb21lbnR1bV9taW4sIHRoaXMubW9tZW50dW1fbWF4KTsgLy8gbW9tZW50dW0uIExldHMganVzdCB1c2UgMC45LCB3b3JrcyBva2F5IHVzdWFsbHkgO3AKICAgICAgdmFyIHRwID0gcmFuZGYoMCwgMSk7IC8vIHRyYWluZXIgdHlwZQogICAgICB2YXIgdHJhaW5lcl9kZWY7CiAgICAgIGlmICh0cCA8IDAuMzMpIHsKICAgICAgICB0cmFpbmVyX2RlZiA9IHsKICAgICAgICAgIG1ldGhvZDogJ2FkYWRlbHRhJywKICAgICAgICAgIGJhdGNoX3NpemU6IGJzLAogICAgICAgICAgbDJfZGVjYXk6IGwyCiAgICAgICAgfTsKICAgICAgfSBlbHNlIGlmICh0cCA8IDAuNjYpIHsKICAgICAgICB0cmFpbmVyX2RlZiA9IHsKICAgICAgICAgIG1ldGhvZDogJ2FkYWdyYWQnLAogICAgICAgICAgbGVhcm5pbmdfcmF0ZTogbHIsCiAgICAgICAgICBiYXRjaF9zaXplOiBicywKICAgICAgICAgIGwyX2RlY2F5OiBsMgogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHJhaW5lcl9kZWYgPSB7CiAgICAgICAgICBtZXRob2Q6ICdzZ2QnLAogICAgICAgICAgbGVhcm5pbmdfcmF0ZTogbHIsCiAgICAgICAgICBtb21lbnR1bTogbW9tLAogICAgICAgICAgYmF0Y2hfc2l6ZTogYnMsCiAgICAgICAgICBsMl9kZWNheTogbDIKICAgICAgICB9OwogICAgICB9CiAgICAgIHZhciB0cmFpbmVyID0gbmV3IFRyYWluZXIobmV0LCB0cmFpbmVyX2RlZik7CiAgICAgIHZhciBjYW5kID0ge307CiAgICAgIGNhbmQuYWNjID0gW107CiAgICAgIGNhbmQuYWNjdiA9IDA7IC8vIHRoaXMgd2lsbCBtYWludGFpbmVkIGFzIHN1bShhY2MpIGZvciBjb252ZW5pZW5jZQogICAgICBjYW5kLmxheWVyX2RlZnMgPSBsYXllcl9kZWZzOwogICAgICBjYW5kLnRyYWluZXJfZGVmID0gdHJhaW5lcl9kZWY7CiAgICAgIGNhbmQubmV0ID0gbmV0OwogICAgICBjYW5kLnRyYWluZXIgPSB0cmFpbmVyOwogICAgICByZXR1cm4gY2FuZDsKICAgIH0sCiAgICAvLyBzZXRzIHRoaXMuY2FuZGlkYXRlcyB3aXRoIHRoaXMubnVtX2NhbmRpZGF0ZXMgY2FuZGlkYXRlIG5ldHMKICAgIHNhbXBsZUNhbmRpZGF0ZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5jYW5kaWRhdGVzID0gW107IC8vIGZsdXNoLCBpZiBhbnkKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm51bV9jYW5kaWRhdGVzOyBpKyspIHsKICAgICAgICB2YXIgY2FuZCA9IHRoaXMuc2FtcGxlQ2FuZGlkYXRlKCk7CiAgICAgICAgdGhpcy5jYW5kaWRhdGVzLnB1c2goY2FuZCk7CiAgICAgIH0KICAgIH0sCiAgICBzdGVwOiBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIHJ1biBhbiBleGFtcGxlIHRocm91Z2ggY3VycmVudCBjYW5kaWRhdGUKICAgICAgdGhpcy5pdGVyKys7CgogICAgICAvLyBzdGVwIGFsbCBjYW5kaWRhdGVzIG9uIGEgcmFuZG9tIGRhdGEgcG9pbnQKICAgICAgdmFyIGZvbGQgPSB0aGlzLmZvbGRzW3RoaXMuZm9sZGl4XTsgLy8gYWN0aXZlIGZvbGQKICAgICAgdmFyIGRhdGFpeCA9IGZvbGQudHJhaW5faXhbcmFuZGkoMCwgZm9sZC50cmFpbl9peC5sZW5ndGgpXTsKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmNhbmRpZGF0ZXMubGVuZ3RoOyBrKyspIHsKICAgICAgICB2YXIgeCA9IHRoaXMuZGF0YVtkYXRhaXhdOwogICAgICAgIHZhciBsID0gdGhpcy5sYWJlbHNbZGF0YWl4XTsKICAgICAgICB0aGlzLmNhbmRpZGF0ZXNba10udHJhaW5lci50cmFpbih4LCBsKTsKICAgICAgfQoKICAgICAgLy8gcHJvY2VzcyBjb25zZXF1ZW5jZXM6IHNhbXBsZSBuZXcgZm9sZHMsIG9yIGNhbmRpZGF0ZXMKICAgICAgdmFyIGxhc3RpdGVyID0gdGhpcy5udW1fZXBvY2hzICogZm9sZC50cmFpbl9peC5sZW5ndGg7CiAgICAgIGlmICh0aGlzLml0ZXIgPj0gbGFzdGl0ZXIpIHsKICAgICAgICAvLyBmaW5pc2hlZCBldmFsdWF0aW9uIG9mIHRoaXMgZm9sZC4gR2V0IGZpbmFsIHZhbGlkYXRpb24KICAgICAgICAvLyBhY2N1cmFjaWVzLCByZWNvcmQgdGhlbSwgYW5kIGdvIG9uIHRvIG5leHQgZm9sZC4KICAgICAgICB2YXIgdmFsX2FjYyA9IHRoaXMuZXZhbFZhbEVycm9ycygpOwogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGhpcy5jYW5kaWRhdGVzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICB2YXIgYyA9IHRoaXMuY2FuZGlkYXRlc1trXTsKICAgICAgICAgIGMuYWNjLnB1c2godmFsX2FjY1trXSk7CiAgICAgICAgICBjLmFjY3YgKz0gdmFsX2FjY1trXTsKICAgICAgICB9CiAgICAgICAgdGhpcy5pdGVyID0gMDsgLy8gcmVzZXQgc3RlcCBudW1iZXIKICAgICAgICB0aGlzLmZvbGRpeCsrOyAvLyBpbmNyZW1lbnQgZm9sZAoKICAgICAgICBpZiAodGhpcy5maW5pc2hfZm9sZF9jYWxsYmFjayAhPT0gbnVsbCkgewogICAgICAgICAgdGhpcy5maW5pc2hfZm9sZF9jYWxsYmFjaygpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5mb2xkaXggPj0gdGhpcy5mb2xkcy5sZW5ndGgpIHsKICAgICAgICAgIC8vIHdlIGZpbmlzaGVkIGFsbCBmb2xkcyBhcyB3ZWxsISBSZWNvcmQgdGhlc2UgY2FuZGlkYXRlcwogICAgICAgICAgLy8gYW5kIHNhbXBsZSBuZXcgb25lcyB0byBldmFsdWF0ZS4KICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdGhpcy5jYW5kaWRhdGVzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIHRoaXMuZXZhbHVhdGVkX2NhbmRpZGF0ZXMucHVzaCh0aGlzLmNhbmRpZGF0ZXNba10pOwogICAgICAgICAgfQogICAgICAgICAgLy8gc29ydCBldmFsdWF0ZWQgY2FuZGlkYXRlcyBhY2NvcmRpbmcgdG8gYWNjdXJhY3kgYWNoaWV2ZWQKICAgICAgICAgIHRoaXMuZXZhbHVhdGVkX2NhbmRpZGF0ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5hY2N2IC8gYS5hY2MubGVuZ3RoID4gYi5hY2N2IC8gYi5hY2MubGVuZ3RoID8gLTEgOiAxOwogICAgICAgICAgfSk7CiAgICAgICAgICAvLyBhbmQgY2xpcCBvbmx5IHRvIHRoZSB0b3AgZmV3IG9uZXMgKGxldHMgcGxhY2UgbGltaXQgYXQgMyplbnNlbWJsZV9zaXplKQogICAgICAgICAgLy8gb3RoZXJ3aXNlIHRoZXJlIGFyZSBjb25jZXJucyB3aXRoIGtlZXBpbmcgdGhlc2UgYWxsIGluIG1lbW9yeSAKICAgICAgICAgIC8vIGlmIE1hZ2ljTmV0IGlzIGJlaW5nIGV2YWx1YXRlZCBmb3IgYSB2ZXJ5IGxvbmcgdGltZQogICAgICAgICAgaWYgKHRoaXMuZXZhbHVhdGVkX2NhbmRpZGF0ZXMubGVuZ3RoID4gMyAqIHRoaXMuZW5zZW1ibGVfc2l6ZSkgewogICAgICAgICAgICB0aGlzLmV2YWx1YXRlZF9jYW5kaWRhdGVzID0gdGhpcy5ldmFsdWF0ZWRfY2FuZGlkYXRlcy5zbGljZSgwLCAzICogdGhpcy5lbnNlbWJsZV9zaXplKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmZpbmlzaF9iYXRjaF9jYWxsYmFjayAhPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmZpbmlzaF9iYXRjaF9jYWxsYmFjaygpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zYW1wbGVDYW5kaWRhdGVzKCk7IC8vIGJlZ2luIHdpdGggbmV3IGNhbmRpZGF0ZXMKICAgICAgICAgIHRoaXMuZm9sZGl4ID0gMDsgLy8gcmVzZXQgdGhpcwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyB3ZSB3aWxsIGdvIG9uIHRvIGFub3RoZXIgZm9sZC4gcmVzZXQgYWxsIGNhbmRpZGF0ZXMgbmV0cwogICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmNhbmRpZGF0ZXMubGVuZ3RoOyBrKyspIHsKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmNhbmRpZGF0ZXNba107CiAgICAgICAgICAgIHZhciBuZXQgPSBuZXcgTmV0KCk7CiAgICAgICAgICAgIG5ldC5tYWtlTGF5ZXJzKGMubGF5ZXJfZGVmcyk7CiAgICAgICAgICAgIHZhciB0cmFpbmVyID0gbmV3IFRyYWluZXIobmV0LCBjLnRyYWluZXJfZGVmKTsKICAgICAgICAgICAgYy5uZXQgPSBuZXQ7CiAgICAgICAgICAgIGMudHJhaW5lciA9IHRyYWluZXI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZXZhbFZhbEVycm9yczogZnVuY3Rpb24gKCkgewogICAgICAvLyBldmFsdWF0ZSBjYW5kaWRhdGVzIG9uIHZhbGlkYXRpb24gZGF0YSBhbmQgcmV0dXJuIHBlcmZvcm1hbmNlIG9mIGN1cnJlbnQgbmV0d29ya3MKICAgICAgLy8gYXMgc2ltcGxlIGxpc3QKICAgICAgdmFyIHZhbHMgPSBbXTsKICAgICAgdmFyIGZvbGQgPSB0aGlzLmZvbGRzW3RoaXMuZm9sZGl4XTsgLy8gYWN0aXZlIGZvbGQKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmNhbmRpZGF0ZXMubGVuZ3RoOyBrKyspIHsKICAgICAgICB2YXIgbmV0ID0gdGhpcy5jYW5kaWRhdGVzW2tdLm5ldDsKICAgICAgICB2YXIgdiA9IDAuMDsKICAgICAgICBmb3IgKHZhciBxID0gMDsgcSA8IGZvbGQudGVzdF9peC5sZW5ndGg7IHErKykgewogICAgICAgICAgdmFyIHggPSB0aGlzLmRhdGFbZm9sZC50ZXN0X2l4W3FdXTsKICAgICAgICAgIHZhciBsID0gdGhpcy5sYWJlbHNbZm9sZC50ZXN0X2l4W3FdXTsKICAgICAgICAgIG5ldC5mb3J3YXJkKHgpOwogICAgICAgICAgdmFyIHloYXQgPSBuZXQuZ2V0UHJlZGljdGlvbigpOwogICAgICAgICAgdiArPSB5aGF0ID09PSBsID8gMS4wIDogMC4wOyAvLyAwIDEgbG9zcwogICAgICAgIH0KICAgICAgICB2IC89IGZvbGQudGVzdF9peC5sZW5ndGg7IC8vIG5vcm1hbGl6ZQogICAgICAgIHZhbHMucHVzaCh2KTsKICAgICAgfQogICAgICByZXR1cm4gdmFsczsKICAgIH0sCiAgICAvLyByZXR1cm5zIHByZWRpY3Rpb24gc2NvcmVzIGZvciBnaXZlbiB0ZXN0IGRhdGEgcG9pbnQsIGFzIFZvbAogICAgLy8gdXNlcyBhbiBhdmVyYWdlZCBwcmVkaWN0aW9uIGZyb20gdGhlIGJlc3QgZW5zZW1ibGVfc2l6ZSBtb2RlbHMKICAgIC8vIHggaXMgYSBWb2wuCiAgICBwcmVkaWN0X3NvZnQ6IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIC8vIGZvcndhcmQgcHJvcCB0aGUgYmVzdCBuZXR3b3JrcwogICAgICAvLyBhbmQgYWNjdW11bGF0ZSBwcm9iYWJpbGl0aWVzIGF0IGxhc3QgbGF5ZXIgaW50byBhIGFuIG91dHB1dCBWb2wKCiAgICAgIHZhciBldmFsX2NhbmRpZGF0ZXMgPSBbXTsKICAgICAgdmFyIG52ID0gMDsKICAgICAgaWYgKHRoaXMuZXZhbHVhdGVkX2NhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgLy8gbm90IHN1cmUgd2hhdCB0byBkbyBoZXJlLCBmaXJzdCBiYXRjaCBvZiBuZXRzIGhhc250IGV2YWx1YXRlZCB5ZXQKICAgICAgICAvLyBsZXRzIGp1c3QgcHJlZGljdCB3aXRoIGN1cnJlbnQgY2FuZGlkYXRlcy4KICAgICAgICBudiA9IHRoaXMuY2FuZGlkYXRlcy5sZW5ndGg7CiAgICAgICAgZXZhbF9jYW5kaWRhdGVzID0gdGhpcy5jYW5kaWRhdGVzOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGZvcndhcmQgcHJvcCB0aGUgYmVzdCBuZXR3b3JrcyBmcm9tIGV2YWx1YXRlZF9jYW5kaWRhdGVzCiAgICAgICAgbnYgPSBNYXRoLm1pbih0aGlzLmVuc2VtYmxlX3NpemUsIHRoaXMuZXZhbHVhdGVkX2NhbmRpZGF0ZXMubGVuZ3RoKTsKICAgICAgICBldmFsX2NhbmRpZGF0ZXMgPSB0aGlzLmV2YWx1YXRlZF9jYW5kaWRhdGVzOwogICAgICB9CgogICAgICAvLyBmb3J3YXJkIG5ldHMgb2YgYWxsIGNhbmRpZGF0ZXMgYW5kIGF2ZXJhZ2UgdGhlIHByZWRpY3Rpb25zCiAgICAgIHZhciB4b3V0LCBuOwogICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG52OyBqKyspIHsKICAgICAgICB2YXIgbmV0ID0gZXZhbF9jYW5kaWRhdGVzW2pdLm5ldDsKICAgICAgICB2YXIgeCA9IG5ldC5mb3J3YXJkKGRhdGEpOwogICAgICAgIGlmIChqID09PSAwKSB7CiAgICAgICAgICB4b3V0ID0geDsKICAgICAgICAgIG4gPSB4LncubGVuZ3RoOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBhZGQgaXQgb24KICAgICAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgbjsgZCsrKSB7CiAgICAgICAgICAgIHhvdXQud1tkXSArPSB4LndbZF07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIHByb2R1Y2UgYXZlcmFnZQogICAgICBmb3IgKHZhciBkID0gMDsgZCA8IG47IGQrKykgewogICAgICAgIHhvdXQud1tkXSAvPSBudjsKICAgICAgfQogICAgICByZXR1cm4geG91dDsKICAgIH0sCiAgICBwcmVkaWN0OiBmdW5jdGlvbiAoZGF0YSkgewogICAgICB2YXIgeG91dCA9IHRoaXMucHJlZGljdF9zb2Z0KGRhdGEpOwogICAgICBpZiAoeG91dC53Lmxlbmd0aCAhPT0gMCkgewogICAgICAgIHZhciBzdGF0cyA9IG1heG1pbih4b3V0LncpOwogICAgICAgIHZhciBwcmVkaWN0ZWRfbGFiZWwgPSBzdGF0cy5tYXhpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBwcmVkaWN0ZWRfbGFiZWwgPSAtMTsgLy8gZXJyb3Igb3V0CiAgICAgIH0KICAgICAgcmV0dXJuIHByZWRpY3RlZF9sYWJlbDsKICAgIH0sCiAgICB0b0pTT046IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gZHVtcCB0aGUgdG9wIGVuc2VtYmxlX3NpemUgbmV0d29ya3MgYXMgYSBsaXN0CiAgICAgIHZhciBudiA9IE1hdGgubWluKHRoaXMuZW5zZW1ibGVfc2l6ZSwgdGhpcy5ldmFsdWF0ZWRfY2FuZGlkYXRlcy5sZW5ndGgpOwogICAgICB2YXIganNvbiA9IHt9OwogICAgICBqc29uLm5ldHMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudjsgaSsrKSB7CiAgICAgICAganNvbi5uZXRzLnB1c2godGhpcy5ldmFsdWF0ZWRfY2FuZGlkYXRlc1tpXS5uZXQudG9KU09OKCkpOwogICAgICB9CiAgICAgIHJldHVybiBqc29uOwogICAgfSwKICAgIGZyb21KU09OOiBmdW5jdGlvbiAoanNvbikgewogICAgICB0aGlzLmVuc2VtYmxlX3NpemUgPSBqc29uLm5ldHMubGVuZ3RoOwogICAgICB0aGlzLmV2YWx1YXRlZF9jYW5kaWRhdGVzID0gW107CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5lbnNlbWJsZV9zaXplOyBpKyspIHsKICAgICAgICB2YXIgbmV0ID0gbmV3IE5ldCgpOwogICAgICAgIG5ldC5mcm9tSlNPTihqc29uLm5ldHNbaV0pOwogICAgICAgIHZhciBkdW1teV9jYW5kaWRhdGUgPSB7fTsKICAgICAgICBkdW1teV9jYW5kaWRhdGUubmV0ID0gbmV0OwogICAgICAgIHRoaXMuZXZhbHVhdGVkX2NhbmRpZGF0ZXMucHVzaChkdW1teV9jYW5kaWRhdGUpOwogICAgICB9CiAgICB9LAogICAgLy8gY2FsbGJhY2sgZnVuY3Rpb25zCiAgICAvLyBjYWxsZWQgd2hlbiBhIGZvbGQgaXMgZmluaXNoZWQsIHdoaWxlIGV2YWx1YXRpbmcgYSBiYXRjaAogICAgb25GaW5pc2hGb2xkOiBmdW5jdGlvbiAoZikgewogICAgICB0aGlzLmZpbmlzaF9mb2xkX2NhbGxiYWNrID0gZjsKICAgIH0sCiAgICAvLyBjYWxsZWQgd2hlbiBhIGJhdGNoIG9mIGNhbmRpZGF0ZXMgaGFzIGZpbmlzaGVkIGV2YWx1YXRpbmcKICAgIG9uRmluaXNoQmF0Y2g6IGZ1bmN0aW9uIChmKSB7CiAgICAgIHRoaXMuZmluaXNoX2JhdGNoX2NhbGxiYWNrID0gZjsKICAgIH0KICB9OwogIGdsb2JhbC5NYWdpY05ldCA9IE1hZ2ljTmV0Owp9KShjb252bmV0anMpOwooZnVuY3Rpb24gKGxpYikgewogICJ1c2Ugc3RyaWN0IjsKCiAgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBtb2R1bGUuZXhwb3J0cyA9PT0gInVuZGVmaW5lZCIpIHsKICAgIHdpbmRvdy5jb252bmV0anMgPSBsaWI7IC8vIGluIG9yZGluYXJ5IGJyb3dzZXIgYXR0YWNoIGxpYnJhcnkgdG8gd2luZG93CiAgfSBlbHNlIHsKICAgIG1vZHVsZS5leHBvcnRzID0gbGliOyAvLyBpbiBub2RlanMKICB9Cn0pKGNvbnZuZXRqcyk7Ci8qIGVzbGludC1lbmFibGUgbm8tdW51c2VkLXZhcnMgKi8KLyogZXNsaW50LWVpc2FibGUgbm8tcmVkZWNsYXJlICov"},{"version":3,"names":["convnetjs","REVISION","global","return_v","v_val","gaussRandom","u","Math","random","v","r","c","sqrt","log","randf","a","b","randi","floor","randn","mu","std","zeros","n","isNaN","ArrayBuffer","arr","Array","i","Float64Array","arrContains","elt","length","arrUnique","push","maxmin","w","maxv","minv","maxi","mini","dv","randperm","j","temp","array","q","weightedSample","lst","probs","p","cumprob","k","getopt","opt","field_name","default_value","ret","f","assert","condition","message","Error","Vol","sx","sy","depth","Object","prototype","toString","call","dw","scale","get","x","y","d","ix","set","add","get_grad","set_grad","add_grad","cloneAndZero","clone","V","addFrom","addFromScaled","setConst","toJSON","json","fromJSON","augment","crop","dx","dy","fliplr","W","W2","img_to_vol","img","convert_grayscale","canvas","document","createElement","width","height","ctx","getContext","drawImage","e","name","img_data","getImageData","data","H","pv","x1","ConvLayer","out_depth","filters","in_depth","in_sx","in_sy","stride","pad","l1_decay_mul","l2_decay_mul","out_sx","out_sy","layer_type","bias","bias_pref","biases","forward","is_training","in_act","A","V_sx","V_sy","xy_stride","ay","ax","fy","oy","fx","ox","fd","out_act","backward","chain_grad","ix1","ix2","getParamsAndGrads","response","params","grads","FullyConnLayer","num_neurons","num_inputs","Vw","wi","tfi","PoolLayer","switchx","switchy","winx","winy","InputLayer","SoftmaxLayer","as","amax","es","esum","exp","indicator","mul","RegressionLayer","loss","dim","yi","val","SVMLayer","yscore","margin","ydiff","ReluLayer","V2","N","V2w","SigmoidLayer","v2wi","MaxoutLayer","group_size","switches","ai","a2","tanh","TanhLayer","DropoutLayer","drop_prob","dropped","LocalResponseNormalizationLayer","alpha","beta","console","S_cache_","n2","den","max","min","aa","pow","S","SB","SB2","aj","g","Net","options","layers","makeLayers","defs","type","desugar","new_defs","def","num_classes","activation","gs","prev","act","getCostLoss","layer_reponse","getPrediction","Lj","t","L","Trainer","net","learning_rate","l1_decay","l2_decay","batch_size","method","momentum","ro","eps","beta1","beta2","lambda","gsum","xsum","train","start","Date","getTime","end","fwd_time","cost_loss","l2_decay_loss","l1_decay_loss","bwd_time","pglist","pg","plen","abs","l1grad","l2grad","gij","gsumi","xsumi","bt1","denom","biasCorr1","biasCorr2","stepSize","softmax_loss","SGDTrainer","MagicNet","labels","train_ratio","num_folds","num_candidates","num_epochs","ensemble_size","batch_size_min","batch_size_max","l2_decay_min","l2_decay_max","learning_rate_min","learning_rate_max","momentum_min","momentum_max","neurons_min","neurons_max","folds","candidates","evaluated_candidates","unique_labels","iter","foldix","finish_fold_callback","finish_batch_callback","sampleFolds","sampleCandidates","num_train","train_ix","slice","test_ix","sampleCandidate","input_depth","layer_defs","nl","ni","dp","bs","l2","lr","mom","tp","trainer_def","trainer","cand","acc","accv","step","fold","dataix","l","lastiter","val_acc","evalValErrors","sort","vals","yhat","predict_soft","eval_candidates","nv","xout","predict","stats","predicted_label","nets","dummy_candidate","onFinishFold","onFinishBatch","lib","module","exports","window"],"sources":["/home/burny/projects/ml-playground/auto-picbreeder/nbenko1/nbenko1.github.io/picbreeder-dev/src/lib/convnet.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\r\n/* eslint-disable no-redeclare */\r\n\r\nvar convnetjs = convnetjs || { REVISION: 'ALPHA' };\r\n(function(global) {\r\n  \"use strict\";\r\n\r\n  // Random number utilities\r\n  var return_v = false;\r\n  var v_val = 0.0;\r\n  var gaussRandom = function() {\r\n    if(return_v) { \r\n      return_v = false;\r\n      return v_val; \r\n    }\r\n    var u = 2*Math.random()-1;\r\n    var v = 2*Math.random()-1;\r\n    var r = u*u + v*v;\r\n    if(r == 0 || r > 1) return gaussRandom();\r\n    var c = Math.sqrt(-2*Math.log(r)/r);\r\n    v_val = v*c; // cache this\r\n    return_v = true;\r\n    return u*c;\r\n  }\r\n  var randf = function(a, b) { return Math.random()*(b-a)+a; }\r\n  var randi = function(a, b) { return Math.floor(Math.random()*(b-a)+a); }\r\n  var randn = function(mu, std){ return mu+gaussRandom()*std; }\r\n\r\n  // Array utilities\r\n  var zeros = function(n) {\r\n    if(typeof(n)==='undefined' || isNaN(n)) { return []; }\r\n    if(typeof ArrayBuffer === 'undefined') {\r\n      // lacking browser support\r\n      var arr = new Array(n);\r\n      for(var i=0;i<n;i++) { arr[i]= 0; }\r\n      return arr;\r\n    } else {\r\n      return new Float64Array(n);\r\n    }\r\n  }\r\n\r\n  var arrContains = function(arr, elt) {\r\n    for(var i=0,n=arr.length;i<n;i++) {\r\n      if(arr[i]===elt) return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  var arrUnique = function(arr) {\r\n    var b = [];\r\n    for(var i=0,n=arr.length;i<n;i++) {\r\n      if(!arrContains(b, arr[i])) {\r\n        b.push(arr[i]);\r\n      }\r\n    }\r\n    return b;\r\n  }\r\n\r\n  // return max and min of a given non-empty array.\r\n  var maxmin = function(w) {\r\n    if(w.length === 0) { return {}; } // ... ;s\r\n    var maxv = w[0];\r\n    var minv = w[0];\r\n    var maxi = 0;\r\n    var mini = 0;\r\n    var n = w.length;\r\n    for(var i=1;i<n;i++) {\r\n      if(w[i] > maxv) { maxv = w[i]; maxi = i; } \r\n      if(w[i] < minv) { minv = w[i]; mini = i; } \r\n    }\r\n    return {maxi: maxi, maxv: maxv, mini: mini, minv: minv, dv:maxv-minv};\r\n  }\r\n\r\n  // create random permutation of numbers, in range [0...n-1]\r\n  var randperm = function(n) {\r\n    var i = n,\r\n        j = 0,\r\n        temp;\r\n    var array = [];\r\n    for(var q=0;q<n;q++)array[q]=q;\r\n    while (i--) {\r\n        j = Math.floor(Math.random() * (i+1));\r\n        temp = array[i];\r\n        array[i] = array[j];\r\n        array[j] = temp;\r\n    }\r\n    return array;\r\n  }\r\n\r\n  // sample from list lst according to probabilities in list probs\r\n  // the two lists are of same size, and probs adds up to 1\r\n  var weightedSample = function(lst, probs) {\r\n    var p = randf(0, 1.0);\r\n    var cumprob = 0.0;\r\n    for(var k=0,n=lst.length;k<n;k++) {\r\n      cumprob += probs[k];\r\n      if(p < cumprob) { return lst[k]; }\r\n    }\r\n  }\r\n\r\n  // syntactic sugar function for getting default parameter values\r\n  var getopt = function(opt, field_name, default_value) {\r\n    if(typeof field_name === 'string') {\r\n      // case of single string\r\n      return (typeof opt[field_name] !== 'undefined') ? opt[field_name] : default_value;\r\n    } else {\r\n      // assume we are given a list of string instead\r\n      var ret = default_value;\r\n      for(var i=0;i<field_name.length;i++) {\r\n        var f = field_name[i];\r\n        if (typeof opt[f] !== 'undefined') {\r\n          ret = opt[f]; // overwrite return value\r\n        }\r\n      }\r\n      return ret;\r\n    }\r\n  }\r\n\r\n  function assert(condition, message) {\r\n    if (!condition) {\r\n      message = message || \"Assertion failed\";\r\n      if (typeof Error !== \"undefined\") {\r\n        throw new Error(message);\r\n      }\r\n      throw message; // Fallback\r\n    }\r\n  }\r\n\r\n  global.randf = randf;\r\n  global.randi = randi;\r\n  global.randn = randn;\r\n  global.zeros = zeros;\r\n  global.maxmin = maxmin;\r\n  global.randperm = randperm;\r\n  global.weightedSample = weightedSample;\r\n  global.arrUnique = arrUnique;\r\n  global.arrContains = arrContains;\r\n  global.getopt = getopt;\r\n  global.assert = assert;\r\n  \r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n\r\n  // Vol is the basic building block of all data in a net.\r\n  // it is essentially just a 3D volume of numbers, with a\r\n  // width (sx), height (sy), and depth (depth).\r\n  // it is used to hold data for all filters, all volumes,\r\n  // all weights, and also stores all gradients w.r.t. \r\n  // the data. c is optionally a value to initialize the volume\r\n  // with. If c is missing, fills the Vol with random numbers.\r\n  var Vol = function(sx, sy, depth, c) {\r\n    // this is how you check if a variable is an array. Oh, Javascript :)\r\n    if(Object.prototype.toString.call(sx) === '[object Array]') {\r\n      // we were given a list in sx, assume 1D volume and fill it up\r\n      this.sx = 1;\r\n      this.sy = 1;\r\n      this.depth = sx.length;\r\n      // we have to do the following copy because we want to use\r\n      // fast typed arrays, not an ordinary javascript array\r\n      this.w = global.zeros(this.depth);\r\n      this.dw = global.zeros(this.depth);\r\n      for(var i=0;i<this.depth;i++) {\r\n        this.w[i] = sx[i];\r\n      }\r\n    } else {\r\n      // we were given dimensions of the vol\r\n      this.sx = sx;\r\n      this.sy = sy;\r\n      this.depth = depth;\r\n      var n = sx*sy*depth;\r\n      this.w = global.zeros(n);\r\n      this.dw = global.zeros(n);\r\n      if(typeof c === 'undefined') {\r\n        // weight normalization is done to equalize the output\r\n        // variance of every neuron, otherwise neurons with a lot\r\n        // of incoming connections have outputs of larger variance\r\n        var scale = Math.sqrt(1.0/(sx*sy*depth));\r\n        for(var i=0;i<n;i++) { \r\n          this.w[i] = global.randn(0.0, scale);\r\n        }\r\n      } else {\r\n        for(var i=0;i<n;i++) { \r\n          this.w[i] = c;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  Vol.prototype = {\r\n    get: function(x, y, d) { \r\n      var ix=((this.sx * y)+x)*this.depth+d;\r\n      return this.w[ix];\r\n    },\r\n    set: function(x, y, d, v) { \r\n      var ix=((this.sx * y)+x)*this.depth+d;\r\n      this.w[ix] = v; \r\n    },\r\n    add: function(x, y, d, v) { \r\n      var ix=((this.sx * y)+x)*this.depth+d;\r\n      this.w[ix] += v; \r\n    },\r\n    get_grad: function(x, y, d) { \r\n      var ix = ((this.sx * y)+x)*this.depth+d;\r\n      return this.dw[ix]; \r\n    },\r\n    set_grad: function(x, y, d, v) { \r\n      var ix = ((this.sx * y)+x)*this.depth+d;\r\n      this.dw[ix] = v; \r\n    },\r\n    add_grad: function(x, y, d, v) { \r\n      var ix = ((this.sx * y)+x)*this.depth+d;\r\n      this.dw[ix] += v; \r\n    },\r\n    cloneAndZero: function() { return new Vol(this.sx, this.sy, this.depth, 0.0)},\r\n    clone: function() {\r\n      var V = new Vol(this.sx, this.sy, this.depth, 0.0);\r\n      var n = this.w.length;\r\n      for(var i=0;i<n;i++) { V.w[i] = this.w[i]; }\r\n      return V;\r\n    },\r\n    addFrom: function(V) { for(var k=0;k<this.w.length;k++) { this.w[k] += V.w[k]; }},\r\n    addFromScaled: function(V, a) { for(var k=0;k<this.w.length;k++) { this.w[k] += a*V.w[k]; }},\r\n    setConst: function(a) { for(var k=0;k<this.w.length;k++) { this.w[k] = a; }},\r\n\r\n    toJSON: function() {\r\n      // todo: we may want to only save d most significant digits to save space\r\n      var json = {}\r\n      json.sx = this.sx; \r\n      json.sy = this.sy;\r\n      json.depth = this.depth;\r\n      json.w = this.w;\r\n      return json;\r\n      // we wont back up gradients to save space\r\n    },\r\n    fromJSON: function(json) {\r\n      this.sx = json.sx;\r\n      this.sy = json.sy;\r\n      this.depth = json.depth;\r\n\r\n      var n = this.sx*this.sy*this.depth;\r\n      this.w = global.zeros(n);\r\n      this.dw = global.zeros(n);\r\n      // copy over the elements.\r\n      for(var i=0;i<n;i++) {\r\n        this.w[i] = json.w[i];\r\n      }\r\n    }\r\n  }\r\n\r\n  global.Vol = Vol;\r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n\r\n  // Volume utilities\r\n  // intended for use with data augmentation\r\n  // crop is the size of output\r\n  // dx,dy are offset wrt incoming volume, of the shift\r\n  // fliplr is boolean on whether we also want to flip left<->right\r\n  var augment = function(V, crop, dx, dy, fliplr) {\r\n    // note assumes square outputs of size crop x crop\r\n    if(typeof(fliplr)==='undefined') var fliplr = false;\r\n    if(typeof(dx)==='undefined') var dx = global.randi(0, V.sx - crop);\r\n    if(typeof(dy)==='undefined') var dy = global.randi(0, V.sy - crop);\r\n    \r\n    // randomly sample a crop in the input volume\r\n    var W;\r\n    if(crop !== V.sx || dx!==0 || dy!==0) {\r\n      W = new Vol(crop, crop, V.depth, 0.0);\r\n      for(var x=0;x<crop;x++) {\r\n        for(var y=0;y<crop;y++) {\r\n          if(x+dx<0 || x+dx>=V.sx || y+dy<0 || y+dy>=V.sy) continue; // oob\r\n          for(var d=0;d<V.depth;d++) {\r\n           W.set(x,y,d,V.get(x+dx,y+dy,d)); // copy data over\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      W = V;\r\n    }\r\n\r\n    if(fliplr) {\r\n      // flip volume horziontally\r\n      var W2 = W.cloneAndZero();\r\n      for(var x=0;x<W.sx;x++) {\r\n        for(var y=0;y<W.sy;y++) {\r\n          for(var d=0;d<W.depth;d++) {\r\n           W2.set(x,y,d,W.get(W.sx - x - 1,y,d)); // copy data over\r\n          }\r\n        }\r\n      }\r\n      W = W2; //swap\r\n    }\r\n    return W;\r\n  }\r\n\r\n  // img is a DOM element that contains a loaded image\r\n  // returns a Vol of size (W, H, 4). 4 is for RGBA\r\n  var img_to_vol = function(img, convert_grayscale) {\r\n\r\n    if(typeof(convert_grayscale)==='undefined') var convert_grayscale = false;\r\n\r\n    var canvas = document.createElement('canvas');\r\n    canvas.width = img.width;\r\n    canvas.height = img.height;\r\n    var ctx = canvas.getContext(\"2d\");\r\n\r\n    // due to a Firefox bug\r\n    try {\r\n      ctx.drawImage(img, 0, 0);\r\n    } catch (e) {\r\n      if (e.name === \"NS_ERROR_NOT_AVAILABLE\") {\r\n        // sometimes happens, lets just abort\r\n        return false;\r\n      } else {\r\n        throw e;\r\n      }\r\n    }\r\n\r\n    try {\r\n      var img_data = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    } catch (e) {\r\n      if(e.name === 'IndexSizeError') {\r\n        return false; // not sure what causes this sometimes but okay abort\r\n      } else {\r\n        throw e;\r\n      }\r\n    }\r\n\r\n    // prepare the input: get pixels and normalize them\r\n    var p = img_data.data;\r\n    var W = img.width;\r\n    var H = img.height;\r\n    var pv = []\r\n    for(var i=0;i<p.length;i++) {\r\n      pv.push(p[i]/255.0-0.5); // normalize image pixels to [-0.5, 0.5]\r\n    }\r\n    var x = new Vol(W, H, 4, 0.0); //input volume (image)\r\n    x.w = pv;\r\n\r\n    if(convert_grayscale) {\r\n      // flatten into depth=1 array\r\n      var x1 = new Vol(W, H, 1, 0.0);\r\n      for(var i=0;i<W;i++) {\r\n        for(var j=0;j<H;j++) {\r\n          x1.set(i,j,0,x.get(i,j,0));\r\n        }\r\n      }\r\n      x = x1;\r\n    }\r\n\r\n    return x;\r\n  }\r\n  \r\n  global.augment = augment;\r\n  global.img_to_vol = img_to_vol;\r\n\r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n\r\n  // This file contains all layers that do dot products with input,\r\n  // but usually in a different connectivity pattern and weight sharing\r\n  // schemes: \r\n  // - FullyConn is fully connected dot products \r\n  // - ConvLayer does convolutions (so weight sharing spatially)\r\n  // putting them together in one file because they are very similar\r\n  var ConvLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // required\r\n    this.out_depth = opt.filters;\r\n    this.sx = opt.sx; // filter size. Should be odd if possible, it's cleaner.\r\n    this.in_depth = opt.in_depth;\r\n    this.in_sx = opt.in_sx;\r\n    this.in_sy = opt.in_sy;\r\n    \r\n    // optional\r\n    this.sy = typeof opt.sy !== 'undefined' ? opt.sy : this.sx;\r\n    this.stride = typeof opt.stride !== 'undefined' ? opt.stride : 1; // stride at which we apply filters to input volume\r\n    this.pad = typeof opt.pad !== 'undefined' ? opt.pad : 0; // amount of 0 padding to add around borders of input volume\r\n    this.l1_decay_mul = typeof opt.l1_decay_mul !== 'undefined' ? opt.l1_decay_mul : 0.0;\r\n    this.l2_decay_mul = typeof opt.l2_decay_mul !== 'undefined' ? opt.l2_decay_mul : 1.0;\r\n\r\n    // computed\r\n    // note we are doing floor, so if the strided convolution of the filter doesnt fit into the input\r\n    // volume exactly, the output volume will be trimmed and not contain the (incomplete) computed\r\n    // final application.\r\n    this.out_sx = Math.floor((this.in_sx + this.pad * 2 - this.sx) / this.stride + 1);\r\n    this.out_sy = Math.floor((this.in_sy + this.pad * 2 - this.sy) / this.stride + 1);\r\n    this.layer_type = 'conv';\r\n\r\n    // initializations\r\n    var bias = typeof opt.bias_pref !== 'undefined' ? opt.bias_pref : 0.0;\r\n    this.filters = [];\r\n    for(var i=0;i<this.out_depth;i++) { this.filters.push(new Vol(this.sx, this.sy, this.in_depth)); }\r\n    this.biases = new Vol(1, 1, this.out_depth, bias);\r\n  }\r\n  ConvLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      // optimized code by @mdda that achieves 2x speedup over previous version\r\n\r\n      this.in_act = V;\r\n      var A = new Vol(this.out_sx |0, this.out_sy |0, this.out_depth |0, 0.0);\r\n      \r\n      var V_sx = V.sx |0;\r\n      var V_sy = V.sy |0;\r\n      var xy_stride = this.stride |0;\r\n\r\n      for(var d=0;d<this.out_depth;d++) {\r\n        var f = this.filters[d];\r\n        var x = -this.pad |0;\r\n        var y = -this.pad |0;\r\n        for(var ay=0; ay<this.out_sy; y+=xy_stride,ay++) {  // xy_stride\r\n          x = -this.pad |0;\r\n          for(var ax=0; ax<this.out_sx; x+=xy_stride,ax++) {  // xy_stride\r\n\r\n            // convolve centered at this particular location\r\n            var a = 0.0;\r\n            for(var fy=0;fy<f.sy;fy++) {\r\n              var oy = y+fy; // coordinates in the original input array coordinates\r\n              for(var fx=0;fx<f.sx;fx++) {\r\n                var ox = x+fx;\r\n                if(oy>=0 && oy<V_sy && ox>=0 && ox<V_sx) {\r\n                  for(var fd=0;fd<f.depth;fd++) {\r\n                    // avoid function call overhead (x2) for efficiency, compromise modularity :(\r\n                    a += f.w[((f.sx * fy)+fx)*f.depth+fd] * V.w[((V_sx * oy)+ox)*V.depth+fd];\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            a += this.biases.w[d];\r\n            A.set(ax, ay, d, a);\r\n          }\r\n        }\r\n      }\r\n      this.out_act = A;\r\n      return this.out_act;\r\n    },\r\n    backward: function() {\r\n\r\n      var V = this.in_act;\r\n      V.dw = global.zeros(V.w.length); // zero out gradient wrt bottom data, we're about to fill it\r\n\r\n      var V_sx = V.sx |0;\r\n      var V_sy = V.sy |0;\r\n      var xy_stride = this.stride |0;\r\n\r\n      for(var d=0;d<this.out_depth;d++) {\r\n        var f = this.filters[d];\r\n        var x = -this.pad |0;\r\n        var y = -this.pad |0;\r\n        for(var ay=0; ay<this.out_sy; y+=xy_stride,ay++) {  // xy_stride\r\n          x = -this.pad |0;\r\n          for(var ax=0; ax<this.out_sx; x+=xy_stride,ax++) {  // xy_stride\r\n\r\n            // convolve centered at this particular location\r\n            var chain_grad = this.out_act.get_grad(ax,ay,d); // gradient from above, from chain rule\r\n            for(var fy=0;fy<f.sy;fy++) {\r\n              var oy = y+fy; // coordinates in the original input array coordinates\r\n              for(var fx=0;fx<f.sx;fx++) {\r\n                var ox = x+fx;\r\n                if(oy>=0 && oy<V_sy && ox>=0 && ox<V_sx) {\r\n                  for(var fd=0;fd<f.depth;fd++) {\r\n                    // avoid function call overhead (x2) for efficiency, compromise modularity :(\r\n                    var ix1 = ((V_sx * oy)+ox)*V.depth+fd;\r\n                    var ix2 = ((f.sx * fy)+fx)*f.depth+fd;\r\n                    f.dw[ix2] += V.w[ix1]*chain_grad;\r\n                    V.dw[ix1] += f.w[ix2]*chain_grad;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            this.biases.dw[d] += chain_grad;\r\n          }\r\n        }\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      var response = [];\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        response.push({params: this.filters[i].w, grads: this.filters[i].dw, l2_decay_mul: this.l2_decay_mul, l1_decay_mul: this.l1_decay_mul});\r\n      }\r\n      response.push({params: this.biases.w, grads: this.biases.dw, l1_decay_mul: 0.0, l2_decay_mul: 0.0});\r\n      return response;\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.sx = this.sx; // filter size in x, y dims\r\n      json.sy = this.sy;\r\n      json.stride = this.stride;\r\n      json.in_depth = this.in_depth;\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.l1_decay_mul = this.l1_decay_mul;\r\n      json.l2_decay_mul = this.l2_decay_mul;\r\n      json.pad = this.pad;\r\n      json.filters = [];\r\n      for(var i=0;i<this.filters.length;i++) {\r\n        json.filters.push(this.filters[i].toJSON());\r\n      }\r\n      json.biases = this.biases.toJSON();\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type;\r\n      this.sx = json.sx; // filter size in x, y dims\r\n      this.sy = json.sy;\r\n      this.stride = json.stride;\r\n      this.in_depth = json.in_depth; // depth of input volume\r\n      this.filters = [];\r\n      this.l1_decay_mul = typeof json.l1_decay_mul !== 'undefined' ? json.l1_decay_mul : 1.0;\r\n      this.l2_decay_mul = typeof json.l2_decay_mul !== 'undefined' ? json.l2_decay_mul : 1.0;\r\n      this.pad = typeof json.pad !== 'undefined' ? json.pad : 0;\r\n      for(var i=0;i<json.filters.length;i++) {\r\n        var v = new Vol(0,0,0,0);\r\n        v.fromJSON(json.filters[i]);\r\n        this.filters.push(v);\r\n      }\r\n      this.biases = new Vol(0,0,0,0);\r\n      this.biases.fromJSON(json.biases);\r\n    }\r\n  }\r\n\r\n  var FullyConnLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // required\r\n    // ok fine we will allow 'filters' as the word as well\r\n    this.out_depth = typeof opt.num_neurons !== 'undefined' ? opt.num_neurons : opt.filters;\r\n\r\n    // optional \r\n    this.l1_decay_mul = typeof opt.l1_decay_mul !== 'undefined' ? opt.l1_decay_mul : 0.0;\r\n    this.l2_decay_mul = typeof opt.l2_decay_mul !== 'undefined' ? opt.l2_decay_mul : 1.0;\r\n\r\n    // computed\r\n    this.num_inputs = opt.in_sx * opt.in_sy * opt.in_depth;\r\n    this.out_sx = 1;\r\n    this.out_sy = 1;\r\n    this.layer_type = 'fc';\r\n\r\n    // initializations\r\n    var bias = typeof opt.bias_pref !== 'undefined' ? opt.bias_pref : 0.0;\r\n    this.filters = [];\r\n    for(var i=0;i<this.out_depth ;i++) { this.filters.push(new Vol(1, 1, this.num_inputs)); }\r\n    this.biases = new Vol(1, 1, this.out_depth, bias);\r\n  }\r\n\r\n  FullyConnLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      var A = new Vol(1, 1, this.out_depth, 0.0);\r\n      var Vw = V.w;\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        var a = 0.0;\r\n        var wi = this.filters[i].w;\r\n        for(var d=0;d<this.num_inputs;d++) {\r\n          a += Vw[d] * wi[d]; // for efficiency use Vols directly for now\r\n        }\r\n        a += this.biases.w[i];\r\n        A.w[i] = a;\r\n      }\r\n      this.out_act = A;\r\n      return this.out_act;\r\n    },\r\n    backward: function() {\r\n      var V = this.in_act;\r\n      V.dw = global.zeros(V.w.length); // zero out the gradient in input Vol\r\n      \r\n      // compute gradient wrt weights and data\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        var tfi = this.filters[i];\r\n        var chain_grad = this.out_act.dw[i];\r\n        for(var d=0;d<this.num_inputs;d++) {\r\n          V.dw[d] += tfi.w[d]*chain_grad; // grad wrt input data\r\n          tfi.dw[d] += V.w[d]*chain_grad; // grad wrt params\r\n        }\r\n        this.biases.dw[i] += chain_grad;\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      var response = [];\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        response.push({params: this.filters[i].w, grads: this.filters[i].dw, l1_decay_mul: this.l1_decay_mul, l2_decay_mul: this.l2_decay_mul});\r\n      }\r\n      response.push({params: this.biases.w, grads: this.biases.dw, l1_decay_mul: 0.0, l2_decay_mul: 0.0});\r\n      return response;\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.num_inputs = this.num_inputs;\r\n      json.l1_decay_mul = this.l1_decay_mul;\r\n      json.l2_decay_mul = this.l2_decay_mul;\r\n      json.filters = [];\r\n      for(var i=0;i<this.filters.length;i++) {\r\n        json.filters.push(this.filters[i].toJSON());\r\n      }\r\n      json.biases = this.biases.toJSON();\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type;\r\n      this.num_inputs = json.num_inputs;\r\n      this.l1_decay_mul = typeof json.l1_decay_mul !== 'undefined' ? json.l1_decay_mul : 1.0;\r\n      this.l2_decay_mul = typeof json.l2_decay_mul !== 'undefined' ? json.l2_decay_mul : 1.0;\r\n      this.filters = [];\r\n      for(var i=0;i<json.filters.length;i++) {\r\n        var v = new Vol(0,0,0,0);\r\n        v.fromJSON(json.filters[i]);\r\n        this.filters.push(v);\r\n      }\r\n      this.biases = new Vol(0,0,0,0);\r\n      this.biases.fromJSON(json.biases);\r\n    }\r\n  }\r\n\r\n  global.ConvLayer = ConvLayer;\r\n  global.FullyConnLayer = FullyConnLayer;\r\n  \r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n  \r\n  var PoolLayer = function(opt) {\r\n\r\n    var opt = opt || {};\r\n\r\n    // required\r\n    this.sx = opt.sx; // filter size\r\n    this.in_depth = opt.in_depth;\r\n    this.in_sx = opt.in_sx;\r\n    this.in_sy = opt.in_sy;\r\n\r\n    // optional\r\n    this.sy = typeof opt.sy !== 'undefined' ? opt.sy : this.sx;\r\n    this.stride = typeof opt.stride !== 'undefined' ? opt.stride : 2;\r\n    this.pad = typeof opt.pad !== 'undefined' ? opt.pad : 0; // amount of 0 padding to add around borders of input volume\r\n\r\n    // computed\r\n    this.out_depth = this.in_depth;\r\n    this.out_sx = Math.floor((this.in_sx + this.pad * 2 - this.sx) / this.stride + 1);\r\n    this.out_sy = Math.floor((this.in_sy + this.pad * 2 - this.sy) / this.stride + 1);\r\n    this.layer_type = 'pool';\r\n    // store switches for x,y coordinates for where the max comes from, for each output neuron\r\n    this.switchx = global.zeros(this.out_sx*this.out_sy*this.out_depth);\r\n    this.switchy = global.zeros(this.out_sx*this.out_sy*this.out_depth);\r\n  }\r\n\r\n  PoolLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n\r\n      var A = new Vol(this.out_sx, this.out_sy, this.out_depth, 0.0);\r\n      \r\n      var n=0; // a counter for switches\r\n      for(var d=0;d<this.out_depth;d++) {\r\n        var x = -this.pad;\r\n        var y = -this.pad;\r\n        for(var ax=0; ax<this.out_sx; x+=this.stride,ax++) {\r\n          y = -this.pad;\r\n          for(var ay=0; ay<this.out_sy; y+=this.stride,ay++) {\r\n\r\n            // convolve centered at this particular location\r\n            var a = -99999; // hopefully small enough ;\\\r\n            var winx=-1,winy=-1;\r\n            for(var fx=0;fx<this.sx;fx++) {\r\n              for(var fy=0;fy<this.sy;fy++) {\r\n                var oy = y+fy;\r\n                var ox = x+fx;\r\n                if(oy>=0 && oy<V.sy && ox>=0 && ox<V.sx) {\r\n                  var v = V.get(ox, oy, d);\r\n                  // perform max pooling and store pointers to where\r\n                  // the max came from. This will speed up backprop \r\n                  // and can help make nice visualizations in future\r\n                  if(v > a) { a = v; winx=ox; winy=oy;}\r\n                }\r\n              }\r\n            }\r\n            this.switchx[n] = winx;\r\n            this.switchy[n] = winy;\r\n            n++;\r\n            A.set(ax, ay, d, a);\r\n          }\r\n        }\r\n      }\r\n      this.out_act = A;\r\n      return this.out_act;\r\n    },\r\n    backward: function() { \r\n      // pooling layers have no parameters, so simply compute \r\n      // gradient wrt data here\r\n      var V = this.in_act;\r\n      V.dw = global.zeros(V.w.length); // zero out gradient wrt data\r\n      var A = this.out_act; // computed in forward pass \r\n\r\n      var n = 0;\r\n      for(var d=0;d<this.out_depth;d++) {\r\n        var x = -this.pad;\r\n        var y = -this.pad;\r\n        for(var ax=0; ax<this.out_sx; x+=this.stride,ax++) {\r\n          y = -this.pad;\r\n          for(var ay=0; ay<this.out_sy; y+=this.stride,ay++) {\r\n\r\n            var chain_grad = this.out_act.get_grad(ax,ay,d);\r\n            V.add_grad(this.switchx[n], this.switchy[n], d, chain_grad);\r\n            n++;\r\n\r\n          }\r\n        }\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.sx = this.sx;\r\n      json.sy = this.sy;\r\n      json.stride = this.stride;\r\n      json.in_depth = this.in_depth;\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.pad = this.pad;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type;\r\n      this.sx = json.sx;\r\n      this.sy = json.sy;\r\n      this.stride = json.stride;\r\n      this.in_depth = json.in_depth;\r\n      this.pad = typeof json.pad !== 'undefined' ? json.pad : 0; // backwards compatibility\r\n      this.switchx = global.zeros(this.out_sx*this.out_sy*this.out_depth); // need to re-init these appropriately\r\n      this.switchy = global.zeros(this.out_sx*this.out_sy*this.out_depth);\r\n    }\r\n  }\r\n\r\n  global.PoolLayer = PoolLayer;\r\n\r\n})(convnetjs);\r\n\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n  var getopt = global.getopt;\r\n\r\n  var InputLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // required: depth\r\n    this.out_depth = getopt(opt, ['out_depth', 'depth'], 0);\r\n\r\n    // optional: default these dimensions to 1\r\n    this.out_sx = getopt(opt, ['out_sx', 'sx', 'width'], 1);\r\n    this.out_sy = getopt(opt, ['out_sy', 'sy', 'height'], 1);\r\n    \r\n    // computed\r\n    this.layer_type = 'input';\r\n  }\r\n  InputLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      this.out_act = V;\r\n      return this.out_act; // simply identity function for now\r\n    },\r\n    backward: function() { },\r\n    getParamsAndGrads: function() {\r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type; \r\n    }\r\n  }\r\n\r\n  global.InputLayer = InputLayer;\r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n  \r\n  // Layers that implement a loss. Currently these are the layers that \r\n  // can initiate a backward() pass. In future we probably want a more \r\n  // flexible system that can accomodate multiple losses to do multi-task\r\n  // learning, and stuff like that. But for now, one of the layers in this\r\n  // file must be the final layer in a Net.\r\n\r\n  // This is a classifier, with N discrete classes from 0 to N-1\r\n  // it gets a stream of N incoming numbers and computes the softmax\r\n  // function (exponentiate and normalize to sum to 1 as probabilities should)\r\n  var SoftmaxLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // computed\r\n    this.num_inputs = opt.in_sx * opt.in_sy * opt.in_depth;\r\n    this.out_depth = this.num_inputs;\r\n    this.out_sx = 1;\r\n    this.out_sy = 1;\r\n    this.layer_type = 'softmax';\r\n  }\r\n\r\n  SoftmaxLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n\r\n      var A = new Vol(1, 1, this.out_depth, 0.0);\r\n\r\n      // compute max activation\r\n      var as = V.w;\r\n      var amax = V.w[0];\r\n      for(var i=1;i<this.out_depth;i++) {\r\n        if(as[i] > amax) amax = as[i];\r\n      }\r\n\r\n      // compute exponentials (carefully to not blow up)\r\n      var es = global.zeros(this.out_depth);\r\n      var esum = 0.0;\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        var e = Math.exp(as[i] - amax);\r\n        esum += e;\r\n        es[i] = e;\r\n      }\r\n\r\n      // normalize and output to sum to one\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        es[i] /= esum;\r\n        A.w[i] = es[i];\r\n      }\r\n\r\n      this.es = es; // save these for backprop\r\n      this.out_act = A;\r\n      return this.out_act;\r\n    },\r\n    backward: function(y) {\r\n\r\n      // compute and accumulate gradient wrt weights and bias of this layer\r\n      var x = this.in_act;\r\n      x.dw = global.zeros(x.w.length); // zero out the gradient of input Vol\r\n\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        var indicator = i === y ? 1.0 : 0.0;\r\n        var mul = -(indicator - this.es[i]);\r\n        x.dw[i] = mul;\r\n      }\r\n\r\n      // loss is the class negative log likelihood\r\n      return -Math.log(this.es[y]);\r\n    },\r\n    getParamsAndGrads: function() { \r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.num_inputs = this.num_inputs;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type;\r\n      this.num_inputs = json.num_inputs;\r\n    }\r\n  }\r\n\r\n  // implements an L2 regression cost layer,\r\n  // so penalizes \\sum_i(||x_i - y_i||^2), where x is its input\r\n  // and y is the user-provided array of \"correct\" values.\r\n  var RegressionLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // computed\r\n    this.num_inputs = opt.in_sx * opt.in_sy * opt.in_depth;\r\n    this.out_depth = this.num_inputs;\r\n    this.out_sx = 1;\r\n    this.out_sy = 1;\r\n    this.layer_type = 'regression';\r\n  }\r\n\r\n  RegressionLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      this.out_act = V;\r\n      return V; // identity function\r\n    },\r\n    // y is a list here of size num_inputs\r\n    // or it can be a number if only one value is regressed\r\n    // or it can be a struct {dim: i, val: x} where we only want to \r\n    // regress on dimension i and asking it to have value x\r\n    backward: function(y) { \r\n\r\n      // compute and accumulate gradient wrt weights and bias of this layer\r\n      var x = this.in_act;\r\n      x.dw = global.zeros(x.w.length); // zero out the gradient of input Vol\r\n      var loss = 0.0;\r\n      if(y instanceof Array || y instanceof Float64Array) {\r\n        for(var i=0;i<this.out_depth;i++) {\r\n          var dy = x.w[i] - y[i];\r\n          x.dw[i] = dy;\r\n          loss += 0.5*dy*dy;\r\n        }\r\n      } else if(typeof y === 'number') {\r\n        // lets hope that only one number is being regressed\r\n        var dy = x.w[0] - y;\r\n        x.dw[0] = dy;\r\n        loss += 0.5*dy*dy;\r\n      } else {\r\n        // assume it is a struct with entries .dim and .val\r\n        // and we pass gradient only along dimension dim to be equal to val\r\n        var i = y.dim;\r\n        var yi = y.val;\r\n        var dy = x.w[i] - yi;\r\n        x.dw[i] = dy;\r\n        loss += 0.5*dy*dy;\r\n      }\r\n      return loss;\r\n    },\r\n    getParamsAndGrads: function() { \r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.num_inputs = this.num_inputs;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type;\r\n      this.num_inputs = json.num_inputs;\r\n    }\r\n  }\r\n\r\n  var SVMLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // computed\r\n    this.num_inputs = opt.in_sx * opt.in_sy * opt.in_depth;\r\n    this.out_depth = this.num_inputs;\r\n    this.out_sx = 1;\r\n    this.out_sy = 1;\r\n    this.layer_type = 'svm';\r\n  }\r\n\r\n  SVMLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      this.out_act = V; // nothing to do, output raw scores\r\n      return V;\r\n    },\r\n    backward: function(y) {\r\n\r\n      // compute and accumulate gradient wrt weights and bias of this layer\r\n      var x = this.in_act;\r\n      x.dw = global.zeros(x.w.length); // zero out the gradient of input Vol\r\n\r\n      // we're using structured loss here, which means that the score\r\n      // of the ground truth should be higher than the score of any other \r\n      // class, by a margin\r\n      var yscore = x.w[y]; // score of ground truth\r\n      var margin = 1.0;\r\n      var loss = 0.0;\r\n      for(var i=0;i<this.out_depth;i++) {\r\n        if(y === i) { continue; }\r\n        var ydiff = -yscore + x.w[i] + margin;\r\n        if(ydiff > 0) {\r\n          // violating dimension, apply loss\r\n          x.dw[i] += 1;\r\n          x.dw[y] -= 1;\r\n          loss += ydiff;\r\n        }\r\n      }\r\n\r\n      return loss;\r\n    },\r\n    getParamsAndGrads: function() { \r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.num_inputs = this.num_inputs;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type;\r\n      this.num_inputs = json.num_inputs;\r\n    }\r\n  }\r\n  \r\n  global.RegressionLayer = RegressionLayer;\r\n  global.SoftmaxLayer = SoftmaxLayer;\r\n  global.SVMLayer = SVMLayer;\r\n\r\n})(convnetjs);\r\n\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n  \r\n  // Implements ReLU nonlinearity elementwise\r\n  // x -> max(0, x)\r\n  // the output is in [0, inf)\r\n  var ReluLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // computed\r\n    this.out_sx = opt.in_sx;\r\n    this.out_sy = opt.in_sy;\r\n    this.out_depth = opt.in_depth;\r\n    this.layer_type = 'relu';\r\n  }\r\n  ReluLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      var V2 = V.clone();\r\n      var N = V.w.length;\r\n      var V2w = V2.w;\r\n      for(var i=0;i<N;i++) { \r\n        if(V2w[i] < 0) V2w[i] = 0; // threshold at 0\r\n      }\r\n      this.out_act = V2;\r\n      return this.out_act;\r\n    },\r\n    backward: function() {\r\n      var V = this.in_act; // we need to set dw of this\r\n      var V2 = this.out_act;\r\n      var N = V.w.length;\r\n      V.dw = global.zeros(N); // zero out gradient wrt data\r\n      for(var i=0;i<N;i++) {\r\n        if(V2.w[i] <= 0) V.dw[i] = 0; // threshold\r\n        else V.dw[i] = V2.dw[i];\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type; \r\n    }\r\n  }\r\n\r\n  // Implements Sigmoid nnonlinearity elementwise\r\n  // x -> 1/(1+e^(-x))\r\n  // so the output is between 0 and 1.\r\n  var SigmoidLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // computed\r\n    this.out_sx = opt.in_sx;\r\n    this.out_sy = opt.in_sy;\r\n    this.out_depth = opt.in_depth;\r\n    this.layer_type = 'sigmoid';\r\n  }\r\n  SigmoidLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      var V2 = V.cloneAndZero();\r\n      var N = V.w.length;\r\n      var V2w = V2.w;\r\n      var Vw = V.w;\r\n      for(var i=0;i<N;i++) { \r\n        V2w[i] = 1.0/(1.0+Math.exp(-Vw[i]));\r\n      }\r\n      this.out_act = V2;\r\n      return this.out_act;\r\n    },\r\n    backward: function() {\r\n      var V = this.in_act; // we need to set dw of this\r\n      var V2 = this.out_act;\r\n      var N = V.w.length;\r\n      V.dw = global.zeros(N); // zero out gradient wrt data\r\n      for(var i=0;i<N;i++) {\r\n        var v2wi = V2.w[i];\r\n        V.dw[i] =  v2wi * (1.0 - v2wi) * V2.dw[i];\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type; \r\n    }\r\n  }\r\n\r\n  // Implements Maxout nnonlinearity that computes\r\n  // x -> max(x)\r\n  // where x is a vector of size group_size. Ideally of course,\r\n  // the input size should be exactly divisible by group_size\r\n  var MaxoutLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // required\r\n    this.group_size = typeof opt.group_size !== 'undefined' ? opt.group_size : 2;\r\n\r\n    // computed\r\n    this.out_sx = opt.in_sx;\r\n    this.out_sy = opt.in_sy;\r\n    this.out_depth = Math.floor(opt.in_depth / this.group_size);\r\n    this.layer_type = 'maxout';\r\n\r\n    this.switches = global.zeros(this.out_sx*this.out_sy*this.out_depth); // useful for backprop\r\n  }\r\n  MaxoutLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      var N = this.out_depth; \r\n      var V2 = new Vol(this.out_sx, this.out_sy, this.out_depth, 0.0);\r\n\r\n      // optimization branch. If we're operating on 1D arrays we dont have\r\n      // to worry about keeping track of x,y,d coordinates inside\r\n      // input volumes. In convnets we do :(\r\n      if(this.out_sx === 1 && this.out_sy === 1) {\r\n        for(var i=0;i<N;i++) {\r\n          var ix = i * this.group_size; // base index offset\r\n          var a = V.w[ix];\r\n          var ai = 0;\r\n          for(var j=1;j<this.group_size;j++) {\r\n            var a2 = V.w[ix+j];\r\n            if(a2 > a) {\r\n              a = a2;\r\n              ai = j;\r\n            }\r\n          }\r\n          V2.w[i] = a;\r\n          this.switches[i] = ix + ai;\r\n        }\r\n      } else {\r\n        var n=0; // counter for switches\r\n        for(var x=0;x<V.sx;x++) {\r\n          for(var y=0;y<V.sy;y++) {\r\n            for(var i=0;i<N;i++) {\r\n              var ix = i * this.group_size;\r\n              var a = V.get(x, y, ix);\r\n              var ai = 0;\r\n              for(var j=1;j<this.group_size;j++) {\r\n                var a2 = V.get(x, y, ix+j);\r\n                if(a2 > a) {\r\n                  a = a2;\r\n                  ai = j;\r\n                }\r\n              }\r\n              V2.set(x,y,i,a);\r\n              this.switches[n] = ix + ai;\r\n              n++;\r\n            }\r\n          }\r\n        }\r\n\r\n      }\r\n      this.out_act = V2;\r\n      return this.out_act;\r\n    },\r\n    backward: function() {\r\n      var V = this.in_act; // we need to set dw of this\r\n      var V2 = this.out_act;\r\n      var N = this.out_depth;\r\n      V.dw = global.zeros(V.w.length); // zero out gradient wrt data\r\n\r\n      // pass the gradient through the appropriate switch\r\n      if(this.out_sx === 1 && this.out_sy === 1) {\r\n        for(var i=0;i<N;i++) {\r\n          var chain_grad = V2.dw[i];\r\n          V.dw[this.switches[i]] = chain_grad;\r\n        }\r\n      } else {\r\n        // bleh okay, lets do this the hard way\r\n        var n=0; // counter for switches\r\n        for(var x=0;x<V2.sx;x++) {\r\n          for(var y=0;y<V2.sy;y++) {\r\n            for(var i=0;i<N;i++) {\r\n              var chain_grad = V2.get_grad(x,y,i);\r\n              V.set_grad(x,y,this.switches[n],chain_grad);\r\n              n++;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.group_size = this.group_size;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type; \r\n      this.group_size = json.group_size;\r\n      this.switches = global.zeros(this.group_size);\r\n    }\r\n  }\r\n\r\n  // a helper function, since tanh is not yet part of ECMAScript. Will be in v6.\r\n  function tanh(x) {\r\n    var y = Math.exp(2 * x);\r\n    return (y - 1) / (y + 1);\r\n  }\r\n  // Implements Tanh nnonlinearity elementwise\r\n  // x -> tanh(x) \r\n  // so the output is between -1 and 1.\r\n  var TanhLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // computed\r\n    this.out_sx = opt.in_sx;\r\n    this.out_sy = opt.in_sy;\r\n    this.out_depth = opt.in_depth;\r\n    this.layer_type = 'tanh';\r\n  }\r\n  TanhLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      var V2 = V.cloneAndZero();\r\n      var N = V.w.length;\r\n      for(var i=0;i<N;i++) { \r\n        V2.w[i] = tanh(V.w[i]);\r\n      }\r\n      this.out_act = V2;\r\n      return this.out_act;\r\n    },\r\n    backward: function() {\r\n      var V = this.in_act; // we need to set dw of this\r\n      var V2 = this.out_act;\r\n      var N = V.w.length;\r\n      V.dw = global.zeros(N); // zero out gradient wrt data\r\n      for(var i=0;i<N;i++) {\r\n        var v2wi = V2.w[i];\r\n        V.dw[i] = (1.0 - v2wi * v2wi) * V2.dw[i];\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type; \r\n    }\r\n  }\r\n  \r\n  global.TanhLayer = TanhLayer;\r\n  global.MaxoutLayer = MaxoutLayer;\r\n  global.ReluLayer = ReluLayer;\r\n  global.SigmoidLayer = SigmoidLayer;\r\n\r\n})(convnetjs);\r\n\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n\r\n  // An inefficient dropout layer\r\n  // Note this is not most efficient implementation since the layer before\r\n  // computed all these activations and now we're just going to drop them :(\r\n  // same goes for backward pass. Also, if we wanted to be efficient at test time\r\n  // we could equivalently be clever and upscale during train and copy pointers during test\r\n  // todo: make more efficient.\r\n  var DropoutLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // computed\r\n    this.out_sx = opt.in_sx;\r\n    this.out_sy = opt.in_sy;\r\n    this.out_depth = opt.in_depth;\r\n    this.layer_type = 'dropout';\r\n    this.drop_prob = typeof opt.drop_prob !== 'undefined' ? opt.drop_prob : 0.5;\r\n    this.dropped = global.zeros(this.out_sx*this.out_sy*this.out_depth);\r\n  }\r\n  DropoutLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n      if(typeof(is_training)==='undefined') { is_training = false; } // default is prediction mode\r\n      var V2 = V.clone();\r\n      var N = V.w.length;\r\n      if(is_training) {\r\n        // do dropout\r\n        for(var i=0;i<N;i++) {\r\n          if(Math.random()<this.drop_prob) { V2.w[i]=0; this.dropped[i] = true; } // drop!\r\n          else {this.dropped[i] = false;}\r\n        }\r\n      } else {\r\n        // scale the activations during prediction\r\n        for(var i=0;i<N;i++) { V2.w[i]*=this.drop_prob; }\r\n      }\r\n      this.out_act = V2;\r\n      return this.out_act; // dummy identity function for now\r\n    },\r\n    backward: function() {\r\n      var V = this.in_act; // we need to set dw of this\r\n      var chain_grad = this.out_act;\r\n      var N = V.w.length;\r\n      V.dw = global.zeros(N); // zero out gradient wrt data\r\n      for(var i=0;i<N;i++) {\r\n        if(!(this.dropped[i])) { \r\n          V.dw[i] = chain_grad.dw[i]; // copy over the gradient\r\n        }\r\n      }\r\n    },\r\n    getParamsAndGrads: function() {\r\n      return [];\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.out_depth = this.out_depth;\r\n      json.out_sx = this.out_sx;\r\n      json.out_sy = this.out_sy;\r\n      json.layer_type = this.layer_type;\r\n      json.drop_prob = this.drop_prob;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.out_depth = json.out_depth;\r\n      this.out_sx = json.out_sx;\r\n      this.out_sy = json.out_sy;\r\n      this.layer_type = json.layer_type; \r\n      this.drop_prob = json.drop_prob;\r\n    }\r\n  }\r\n  \r\n\r\n  global.DropoutLayer = DropoutLayer;\r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n  \r\n  // a bit experimental layer for now. I think it works but I'm not 100%\r\n  // the gradient check is a bit funky. I'll look into this a bit later.\r\n  // Local Response Normalization in window, along depths of volumes\r\n  var LocalResponseNormalizationLayer = function(opt) {\r\n    var opt = opt || {};\r\n\r\n    // required\r\n    this.k = opt.k;\r\n    this.n = opt.n;\r\n    this.alpha = opt.alpha;\r\n    this.beta = opt.beta;\r\n\r\n    // computed\r\n    this.out_sx = opt.in_sx;\r\n    this.out_sy = opt.in_sy;\r\n    this.out_depth = opt.in_depth;\r\n    this.layer_type = 'lrn';\r\n\r\n    // checks\r\n    if(this.n%2 === 0) { console.log('WARNING n should be odd for LRN layer'); }\r\n  }\r\n  LocalResponseNormalizationLayer.prototype = {\r\n    forward: function(V, is_training) {\r\n      this.in_act = V;\r\n\r\n      var A = V.cloneAndZero();\r\n      this.S_cache_ = V.cloneAndZero();\r\n      var n2 = Math.floor(this.n/2);\r\n      for(var x=0;x<V.sx;x++) {\r\n        for(var y=0;y<V.sy;y++) {\r\n          for(var i=0;i<V.depth;i++) {\r\n\r\n            var ai = V.get(x,y,i);\r\n\r\n            // normalize in a window of size n\r\n            var den = 0.0;\r\n            for(var j=Math.max(0,i-n2);j<=Math.min(i+n2,V.depth-1);j++) {\r\n              var aa = V.get(x,y,j);\r\n              den += aa*aa;\r\n            }\r\n            den *= this.alpha / this.n;\r\n            den += this.k;\r\n            this.S_cache_.set(x,y,i,den); // will be useful for backprop\r\n            den = Math.pow(den, this.beta);\r\n            A.set(x,y,i,ai/den);\r\n          }\r\n        }\r\n      }\r\n\r\n      this.out_act = A;\r\n      return this.out_act; // dummy identity function for now\r\n    },\r\n    backward: function() { \r\n      // evaluate gradient wrt data\r\n      var V = this.in_act; // we need to set dw of this\r\n      V.dw = global.zeros(V.w.length); // zero out gradient wrt data\r\n      var A = this.out_act; // computed in forward pass \r\n\r\n      var n2 = Math.floor(this.n/2);\r\n      for(var x=0;x<V.sx;x++) {\r\n        for(var y=0;y<V.sy;y++) {\r\n          for(var i=0;i<V.depth;i++) {\r\n\r\n            var chain_grad = this.out_act.get_grad(x,y,i);\r\n            var S = this.S_cache_.get(x,y,i);\r\n            var SB = Math.pow(S, this.beta);\r\n            var SB2 = SB*SB;\r\n\r\n            // normalize in a window of size n\r\n            for(var j=Math.max(0,i-n2);j<=Math.min(i+n2,V.depth-1);j++) {              \r\n              var aj = V.get(x,y,j); \r\n              var g = -aj*this.beta*Math.pow(S,this.beta-1)*this.alpha/this.n*2*aj;\r\n              if(j===i) g+= SB;\r\n              g /= SB2;\r\n              g *= chain_grad;\r\n              V.add_grad(x,y,j,g);\r\n            }\r\n\r\n          }\r\n        }\r\n      }\r\n    },\r\n    getParamsAndGrads: function() { return []; },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.k = this.k;\r\n      json.n = this.n;\r\n      json.alpha = this.alpha; // normalize by size\r\n      json.beta = this.beta;\r\n      json.out_sx = this.out_sx; \r\n      json.out_sy = this.out_sy;\r\n      json.out_depth = this.out_depth;\r\n      json.layer_type = this.layer_type;\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.k = json.k;\r\n      this.n = json.n;\r\n      this.alpha = json.alpha; // normalize by size\r\n      this.beta = json.beta;\r\n      this.out_sx = json.out_sx; \r\n      this.out_sy = json.out_sy;\r\n      this.out_depth = json.out_depth;\r\n      this.layer_type = json.layer_type;\r\n    }\r\n  }\r\n  \r\n\r\n  global.LocalResponseNormalizationLayer = LocalResponseNormalizationLayer;\r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n  var assert = global.assert;\r\n\r\n  // Net manages a set of layers\r\n  // For now constraints: Simple linear order of layers, first layer input last layer a cost layer\r\n  var Net = function(options) {\r\n    this.layers = [];\r\n  }\r\n\r\n  Net.prototype = {\r\n    \r\n    // takes a list of layer definitions and creates the network layer objects\r\n    makeLayers: function(defs) {\r\n\r\n      // few checks\r\n      assert(defs.length >= 2, 'Error! At least one input layer and one loss layer are required.');\r\n      assert(defs[0].type === 'input', 'Error! First layer must be the input layer, to declare size of inputs');\r\n\r\n      // desugar layer_defs for adding activation, dropout layers etc\r\n      var desugar = function() {\r\n        var new_defs = [];\r\n        for(var i=0;i<defs.length;i++) {\r\n          var def = defs[i];\r\n          \r\n          if(def.type==='softmax' || def.type==='svm') {\r\n            // add an fc layer here, there is no reason the user should\r\n            // have to worry about this and we almost always want to\r\n            new_defs.push({type:'fc', num_neurons: def.num_classes});\r\n          }\r\n\r\n          if(def.type==='regression') {\r\n            // add an fc layer here, there is no reason the user should\r\n            // have to worry about this and we almost always want to\r\n            new_defs.push({type:'fc', num_neurons: def.num_neurons});\r\n          }\r\n\r\n          if((def.type==='fc' || def.type==='conv') \r\n              && typeof(def.bias_pref) === 'undefined'){\r\n            def.bias_pref = 0.0;\r\n            if(typeof def.activation !== 'undefined' && def.activation === 'relu') {\r\n              def.bias_pref = 0.1; // relus like a bit of positive bias to get gradients early\r\n              // otherwise it's technically possible that a relu unit will never turn on (by chance)\r\n              // and will never get any gradient and never contribute any computation. Dead relu.\r\n            }\r\n          }\r\n\r\n          new_defs.push(def);\r\n\r\n          if(typeof def.activation !== 'undefined') {\r\n            if(def.activation==='relu') { new_defs.push({type:'relu'}); }\r\n            else if (def.activation==='sigmoid') { new_defs.push({type:'sigmoid'}); }\r\n            else if (def.activation==='tanh') { new_defs.push({type:'tanh'}); }\r\n            else if (def.activation==='maxout') {\r\n              // create maxout activation, and pass along group size, if provided\r\n              var gs = def.group_size !== 'undefined' ? def.group_size : 2;\r\n              new_defs.push({type:'maxout', group_size:gs});\r\n            }\r\n            else { console.log('ERROR unsupported activation ' + def.activation); }\r\n          }\r\n          if(typeof def.drop_prob !== 'undefined' && def.type !== 'dropout') {\r\n            new_defs.push({type:'dropout', drop_prob: def.drop_prob});\r\n          }\r\n\r\n        }\r\n        return new_defs;\r\n      }\r\n      defs = desugar(defs);\r\n\r\n      // create the layers\r\n      this.layers = [];\r\n      for(var i=0;i<defs.length;i++) {\r\n        var def = defs[i];\r\n        if(i>0) {\r\n          var prev = this.layers[i-1];\r\n          def.in_sx = prev.out_sx;\r\n          def.in_sy = prev.out_sy;\r\n          def.in_depth = prev.out_depth;\r\n        }\r\n\r\n        switch(def.type) {\r\n          case 'fc': this.layers.push(new global.FullyConnLayer(def)); break;\r\n          case 'lrn': this.layers.push(new global.LocalResponseNormalizationLayer(def)); break;\r\n          case 'dropout': this.layers.push(new global.DropoutLayer(def)); break;\r\n          case 'input': this.layers.push(new global.InputLayer(def)); break;\r\n          case 'softmax': this.layers.push(new global.SoftmaxLayer(def)); break;\r\n          case 'regression': this.layers.push(new global.RegressionLayer(def)); break;\r\n          case 'conv': this.layers.push(new global.ConvLayer(def)); break;\r\n          case 'pool': this.layers.push(new global.PoolLayer(def)); break;\r\n          case 'relu': this.layers.push(new global.ReluLayer(def)); break;\r\n          case 'sigmoid': this.layers.push(new global.SigmoidLayer(def)); break;\r\n          case 'tanh': this.layers.push(new global.TanhLayer(def)); break;\r\n          case 'maxout': this.layers.push(new global.MaxoutLayer(def)); break;\r\n          case 'svm': this.layers.push(new global.SVMLayer(def)); break;\r\n          default: console.log('ERROR: UNRECOGNIZED LAYER TYPE: ' + def.type);\r\n        }\r\n      }\r\n    },\r\n\r\n    // forward prop the network. \r\n    // The trainer class passes is_training = true, but when this function is\r\n    // called from outside (not from the trainer), it defaults to prediction mode\r\n    forward: function(V, is_training) {\r\n      if(typeof(is_training) === 'undefined') is_training = false;\r\n      var act = this.layers[0].forward(V, is_training);\r\n      for(var i=1;i<this.layers.length;i++) {\r\n        act = this.layers[i].forward(act, is_training);\r\n      }\r\n      return act;\r\n    },\r\n\r\n    getCostLoss: function(V, y) {\r\n      this.forward(V, false);\r\n      var N = this.layers.length;\r\n      var loss = this.layers[N-1].backward(y);\r\n      return loss;\r\n    },\r\n    \r\n    // backprop: compute gradients wrt all parameters\r\n    backward: function(y) {\r\n      var N = this.layers.length;\r\n      var loss = this.layers[N-1].backward(y); // last layer assumed to be loss layer\r\n      for(var i=N-2;i>=0;i--) { // first layer assumed input\r\n        this.layers[i].backward();\r\n      }\r\n      return loss;\r\n    },\r\n    getParamsAndGrads: function() {\r\n      // accumulate parameters and gradients for the entire network\r\n      var response = [];\r\n      for(var i=0;i<this.layers.length;i++) {\r\n        var layer_reponse = this.layers[i].getParamsAndGrads();\r\n        for(var j=0;j<layer_reponse.length;j++) {\r\n          response.push(layer_reponse[j]);\r\n        }\r\n      }\r\n      return response;\r\n    },\r\n    getPrediction: function() {\r\n      // this is a convenience function for returning the argmax\r\n      // prediction, assuming the last layer of the net is a softmax\r\n      var S = this.layers[this.layers.length-1];\r\n      assert(S.layer_type === 'softmax', 'getPrediction function assumes softmax as last layer of the net!');\r\n\r\n      var p = S.out_act.w;\r\n      var maxv = p[0];\r\n      var maxi = 0;\r\n      for(var i=1;i<p.length;i++) {\r\n        if(p[i] > maxv) { maxv = p[i]; maxi = i;}\r\n      }\r\n      return maxi; // return index of the class with highest class probability\r\n    },\r\n    toJSON: function() {\r\n      var json = {};\r\n      json.layers = [];\r\n      for(var i=0;i<this.layers.length;i++) {\r\n        json.layers.push(this.layers[i].toJSON());\r\n      }\r\n      return json;\r\n    },\r\n    fromJSON: function(json) {\r\n      this.layers = [];\r\n      for(var i=0;i<json.layers.length;i++) {\r\n        var Lj = json.layers[i]\r\n        var t = Lj.layer_type;\r\n        var L;\r\n        if(t==='input') { L = new global.InputLayer(); }\r\n        if(t==='relu') { L = new global.ReluLayer(); }\r\n        if(t==='sigmoid') { L = new global.SigmoidLayer(); }\r\n        if(t==='tanh') { L = new global.TanhLayer(); }\r\n        if(t==='dropout') { L = new global.DropoutLayer(); }\r\n        if(t==='conv') { L = new global.ConvLayer(); }\r\n        if(t==='pool') { L = new global.PoolLayer(); }\r\n        if(t==='lrn') { L = new global.LocalResponseNormalizationLayer(); }\r\n        if(t==='softmax') { L = new global.SoftmaxLayer(); }\r\n        if(t==='regression') { L = new global.RegressionLayer(); }\r\n        if(t==='fc') { L = new global.FullyConnLayer(); }\r\n        if(t==='maxout') { L = new global.MaxoutLayer(); }\r\n        if(t==='svm') { L = new global.SVMLayer(); }\r\n        L.fromJSON(Lj);\r\n        this.layers.push(L);\r\n      }\r\n    }\r\n  }\r\n  \r\n  global.Net = Net;\r\n})(convnetjs);\r\n(function(global) {\r\n  \"use strict\";\r\n  var Vol = global.Vol; // convenience\r\n\r\n  var Trainer = function(net, options) {\r\n\r\n    this.net = net;\r\n\r\n    var options = options || {};\r\n    this.learning_rate = typeof options.learning_rate !== 'undefined' ? options.learning_rate : 0.01;\r\n    this.l1_decay = typeof options.l1_decay !== 'undefined' ? options.l1_decay : 0.0;\r\n    this.l2_decay = typeof options.l2_decay !== 'undefined' ? options.l2_decay : 0.0;\r\n    this.batch_size = typeof options.batch_size !== 'undefined' ? options.batch_size : 1;\r\n    this.method = typeof options.method !== 'undefined' ? options.method : 'sgd'; // sgd/adam/adagrad/adadelta/windowgrad/netsterov\r\n\r\n    this.momentum = typeof options.momentum !== 'undefined' ? options.momentum : 0.9;\r\n    this.ro = typeof options.ro !== 'undefined' ? options.ro : 0.95; // used in adadelta\r\n    this.eps = typeof options.eps !== 'undefined' ? options.eps : 1e-8; // used in adam or adadelta\r\n    this.beta1 = typeof options.beta1 !== 'undefined' ? options.beta1 : 0.9; // used in adam\r\n    this.beta2 = typeof options.beta2 !== 'undefined' ? options.beta2 : 0.999; // used in adam\r\n    this.lambda = typeof options.lambda !== 'undefined' ? options.lambda : 1-1e-8; // used in adam\r\n\r\n    this.k = 0; // iteration counter\r\n    this.gsum = []; // last iteration gradients (used for momentum calculations)\r\n    this.xsum = []; // used in adam or adadelta\r\n  }\r\n\r\n  Trainer.prototype = {\r\n    train: function(x, y) {\r\n\r\n      var start = new Date().getTime();\r\n      this.net.forward(x, true); // also set the flag that lets the net know we're just training\r\n      var end = new Date().getTime();\r\n      var fwd_time = end - start;\r\n\r\n      var start = new Date().getTime();\r\n      var cost_loss = this.net.backward(y);\r\n      var l2_decay_loss = 0.0;\r\n      var l1_decay_loss = 0.0;\r\n      var end = new Date().getTime();\r\n      var bwd_time = end - start;\r\n      \r\n      this.k++;\r\n      if(this.k % this.batch_size === 0) {\r\n\r\n        var pglist = this.net.getParamsAndGrads();\r\n\r\n        // initialize lists for accumulators. Will only be done once on first iteration\r\n        if(this.gsum.length === 0 && (this.method !== 'sgd' || this.momentum > 0.0)) {\r\n          // only vanilla sgd doesnt need either lists\r\n          // momentum needs gsum\r\n          // adagrad needs gsum\r\n          // adam and adadelta needs gsum and xsum\r\n          for(var i=0;i<pglist.length;i++) {\r\n            this.gsum.push(global.zeros(pglist[i].params.length));\r\n            if(this.method === 'adam' || this.method === 'adadelta') {\r\n              this.xsum.push(global.zeros(pglist[i].params.length));\r\n            } else {\r\n              this.xsum.push([]); // conserve memory\r\n            }\r\n          }\r\n        }\r\n\r\n        // perform an update for all sets of weights\r\n        for(var i=0;i<pglist.length;i++) {\r\n          var pg = pglist[i]; // param, gradient, other options in future (custom learning rate etc)\r\n          var p = pg.params;\r\n          var g = pg.grads;\r\n\r\n          // learning rate for some parameters.\r\n          var l2_decay_mul = typeof pg.l2_decay_mul !== 'undefined' ? pg.l2_decay_mul : 1.0;\r\n          var l1_decay_mul = typeof pg.l1_decay_mul !== 'undefined' ? pg.l1_decay_mul : 1.0;\r\n          var l2_decay = this.l2_decay * l2_decay_mul;\r\n          var l1_decay = this.l1_decay * l1_decay_mul;\r\n\r\n          var plen = p.length;\r\n          for(var j=0;j<plen;j++) {\r\n            l2_decay_loss += l2_decay*p[j]*p[j]/2; // accumulate weight decay loss\r\n            l1_decay_loss += l1_decay*Math.abs(p[j]);\r\n            var l1grad = l1_decay * (p[j] > 0 ? 1 : -1);\r\n            var l2grad = l2_decay * (p[j]);\r\n\r\n            var gij = (l2grad + l1grad + g[j]) / this.batch_size; // raw batch gradient\r\n\r\n            var gsumi = this.gsum[i];\r\n            var xsumi = this.xsum[i];\r\n            if(this.method === 'adam') {\r\n              // adam update\r\n              var bt1 = this.beta1 * Math.pow(this.lambda, this.k-1); // decay first moment running average coefficient\r\n              gsumi[j] = gsumi[j] * bt1 + (1-bt1) * gij; // update biased first moment estimate\r\n              xsumi[j] = xsumi[j] * this.beta2 + (1-this.beta2) * gij * gij; // update biased second moment estimate\r\n              var denom = Math.sqrt(xsumi[j]) + this.eps;\r\n              var biasCorr1 = 1 - Math.pow(this.beta1, this.k); // correct bias\r\n              var biasCorr2 = 1 - Math.pow(this.beta2, this.k); // correct bias\r\n              var stepSize = this.learning_rate * Math.sqrt(biasCorr2) / biasCorr1;\r\n              var dx = stepSize * gsumi[j] / denom;\r\n              p[j] += dx;\r\n            } else if(this.method === 'adagrad') {\r\n              // adagrad update\r\n              gsumi[j] = gsumi[j] + gij * gij;\r\n              var dx = - this.learning_rate / Math.sqrt(gsumi[j] + this.eps) * gij;\r\n              p[j] += dx;\r\n            } else if(this.method === 'windowgrad') {\r\n              // this is adagrad but with a moving window weighted average\r\n              // so the gradient is not accumulated over the entire history of the run. \r\n              // it's also referred to as Idea #1 in Zeiler paper on Adadelta. Seems reasonable to me!\r\n              gsumi[j] = this.ro * gsumi[j] + (1-this.ro) * gij * gij;\r\n              var dx = - this.learning_rate / Math.sqrt(gsumi[j] + this.eps) * gij; // eps added for better conditioning\r\n              p[j] += dx;\r\n            } else if(this.method === 'adadelta') {\r\n              gsumi[j] = this.ro * gsumi[j] + (1-this.ro) * gij * gij;\r\n              var dx = - Math.sqrt((xsumi[j] + this.eps)/(gsumi[j] + this.eps)) * gij;\r\n              xsumi[j] = this.ro * xsumi[j] + (1-this.ro) * dx * dx; // yes, xsum lags behind gsum by 1.\r\n              p[j] += dx;\r\n            } else if(this.method === 'nesterov') {\r\n              var dx = gsumi[j];\r\n              gsumi[j] = gsumi[j] * this.momentum + this.learning_rate * gij;\r\n                dx = this.momentum * dx - (1.0 + this.momentum) * gsumi[j];\r\n                p[j] += dx;\r\n            } else {\r\n              // assume SGD\r\n              if(this.momentum > 0.0) {\r\n                // momentum update\r\n                var dx = this.momentum * gsumi[j] - this.learning_rate * gij; // step\r\n                gsumi[j] = dx; // back this up for next iteration of momentum\r\n                p[j] += dx; // apply corrected gradient\r\n              } else {\r\n                // vanilla sgd\r\n                p[j] +=  - this.learning_rate * gij;\r\n              }\r\n            }\r\n            g[j] = 0.0; // zero out gradient so that we can begin accumulating anew\r\n          }\r\n        }\r\n      }\r\n\r\n      // appending softmax_loss for backwards compatibility, but from now on we will always use cost_loss\r\n      // in future, TODO: have to completely redo the way loss is done around the network as currently \r\n      // loss is a bit of a hack. Ideally, user should specify arbitrary number of loss functions on any layer\r\n      // and it should all be computed correctly and automatically. \r\n      return {fwd_time: fwd_time, bwd_time: bwd_time, \r\n              l2_decay_loss: l2_decay_loss, l1_decay_loss: l1_decay_loss,\r\n              cost_loss: cost_loss, softmax_loss: cost_loss, \r\n              loss: cost_loss + l1_decay_loss + l2_decay_loss}\r\n    }\r\n  }\r\n  \r\n  global.Trainer = Trainer;\r\n  global.SGDTrainer = Trainer; // backwards compatibility\r\n})(convnetjs);\r\n\r\n(function(global) {\r\n  \"use strict\";\r\n\r\n  // used utilities, make explicit local references\r\n  var randf = global.randf;\r\n  var randi = global.randi;\r\n  var Net = global.Net;\r\n  var Trainer = global.Trainer;\r\n  var maxmin = global.maxmin;\r\n  var randperm = global.randperm;\r\n  var weightedSample = global.weightedSample;\r\n  var getopt = global.getopt;\r\n  var arrUnique = global.arrUnique;\r\n\r\n  /*\r\n  A MagicNet takes data: a list of convnetjs.Vol(), and labels\r\n  which for now are assumed to be class indeces 0..K. MagicNet then:\r\n  - creates data folds for cross-validation\r\n  - samples candidate networks\r\n  - evaluates candidate networks on all data folds\r\n  - produces predictions by model-averaging the best networks\r\n  */\r\n  var MagicNet = function(data, labels, opt) {\r\n    var opt = opt || {};\r\n    if(typeof data === 'undefined') { data = []; }\r\n    if(typeof labels === 'undefined') { labels = []; }\r\n\r\n    // required inputs\r\n    this.data = data; // store these pointers to data\r\n    this.labels = labels;\r\n\r\n    // optional inputs\r\n    this.train_ratio = getopt(opt, 'train_ratio', 0.7);\r\n    this.num_folds = getopt(opt, 'num_folds', 10);\r\n    this.num_candidates = getopt(opt, 'num_candidates', 50); // we evaluate several in parallel\r\n    // how many epochs of data to train every network? for every fold?\r\n    // higher values mean higher accuracy in final results, but more expensive\r\n    this.num_epochs = getopt(opt, 'num_epochs', 50); \r\n    // number of best models to average during prediction. Usually higher = better\r\n    this.ensemble_size = getopt(opt, 'ensemble_size', 10);\r\n\r\n    // candidate parameters\r\n    this.batch_size_min = getopt(opt, 'batch_size_min', 10);\r\n    this.batch_size_max = getopt(opt, 'batch_size_max', 300);\r\n    this.l2_decay_min = getopt(opt, 'l2_decay_min', -4);\r\n    this.l2_decay_max = getopt(opt, 'l2_decay_max', 2);\r\n    this.learning_rate_min = getopt(opt, 'learning_rate_min', -4);\r\n    this.learning_rate_max = getopt(opt, 'learning_rate_max', 0);\r\n    this.momentum_min = getopt(opt, 'momentum_min', 0.9);\r\n    this.momentum_max = getopt(opt, 'momentum_max', 0.9);\r\n    this.neurons_min = getopt(opt, 'neurons_min', 5);\r\n    this.neurons_max = getopt(opt, 'neurons_max', 30);\r\n\r\n    // computed\r\n    this.folds = []; // data fold indices, gets filled by sampleFolds()\r\n    this.candidates = []; // candidate networks that are being currently evaluated\r\n    this.evaluated_candidates = []; // history of all candidates that were fully evaluated on all folds\r\n    this.unique_labels = arrUnique(labels);\r\n    this.iter = 0; // iteration counter, goes from 0 -> num_epochs * num_training_data\r\n    this.foldix = 0; // index of active fold\r\n\r\n    // callbacks\r\n    this.finish_fold_callback = null;\r\n    this.finish_batch_callback = null;\r\n\r\n    // initializations\r\n    if(this.data.length > 0) {\r\n      this.sampleFolds();\r\n      this.sampleCandidates();\r\n    }\r\n  };\r\n\r\n  MagicNet.prototype = {\r\n\r\n    // sets this.folds to a sampling of this.num_folds folds\r\n    sampleFolds: function() {\r\n      var N = this.data.length;\r\n      var num_train = Math.floor(this.train_ratio * N);\r\n      this.folds = []; // flush folds, if any\r\n      for(var i=0;i<this.num_folds;i++) {\r\n        var p = randperm(N);\r\n        this.folds.push({train_ix: p.slice(0, num_train), test_ix: p.slice(num_train, N)});\r\n      }\r\n    },\r\n\r\n    // returns a random candidate network\r\n    sampleCandidate: function() {\r\n      var input_depth = this.data[0].w.length;\r\n      var num_classes = this.unique_labels.length;\r\n\r\n      // sample network topology and hyperparameters\r\n      var layer_defs = [];\r\n      layer_defs.push({type:'input', out_sx:1, out_sy:1, out_depth: input_depth});\r\n      var nl = weightedSample([0,1,2,3], [0.2, 0.3, 0.3, 0.2]); // prefer nets with 1,2 hidden layers\r\n      for(var q=0;q<nl;q++) {\r\n        var ni = randi(this.neurons_min, this.neurons_max);\r\n        var act = ['tanh','maxout','relu'][randi(0,3)];\r\n        if(randf(0,1)<0.5) {\r\n          var dp = Math.random();\r\n          layer_defs.push({type:'fc', num_neurons: ni, activation: act, drop_prob: dp});\r\n        } else {\r\n          layer_defs.push({type:'fc', num_neurons: ni, activation: act});\r\n        }\r\n      }\r\n      layer_defs.push({type:'softmax', num_classes: num_classes});\r\n      var net = new Net();\r\n      net.makeLayers(layer_defs);\r\n\r\n      // sample training hyperparameters\r\n      var bs = randi(this.batch_size_min, this.batch_size_max); // batch size\r\n      var l2 = Math.pow(10, randf(this.l2_decay_min, this.l2_decay_max)); // l2 weight decay\r\n      var lr = Math.pow(10, randf(this.learning_rate_min, this.learning_rate_max)); // learning rate\r\n      var mom = randf(this.momentum_min, this.momentum_max); // momentum. Lets just use 0.9, works okay usually ;p\r\n      var tp = randf(0,1); // trainer type\r\n      var trainer_def;\r\n      if(tp<0.33) {\r\n        trainer_def = {method:'adadelta', batch_size:bs, l2_decay:l2};\r\n      } else if(tp<0.66) {\r\n        trainer_def = {method:'adagrad', learning_rate: lr, batch_size:bs, l2_decay:l2};\r\n      } else {\r\n        trainer_def = {method:'sgd', learning_rate: lr, momentum: mom, batch_size:bs, l2_decay:l2};\r\n      }\r\n      \r\n      var trainer = new Trainer(net, trainer_def);\r\n\r\n      var cand = {};\r\n      cand.acc = [];\r\n      cand.accv = 0; // this will maintained as sum(acc) for convenience\r\n      cand.layer_defs = layer_defs;\r\n      cand.trainer_def = trainer_def;\r\n      cand.net = net;\r\n      cand.trainer = trainer;\r\n      return cand;\r\n    },\r\n\r\n    // sets this.candidates with this.num_candidates candidate nets\r\n    sampleCandidates: function() {\r\n      this.candidates = []; // flush, if any\r\n      for(var i=0;i<this.num_candidates;i++) {\r\n        var cand = this.sampleCandidate();\r\n        this.candidates.push(cand);\r\n      }\r\n    },\r\n\r\n    step: function() {\r\n      \r\n      // run an example through current candidate\r\n      this.iter++;\r\n\r\n      // step all candidates on a random data point\r\n      var fold = this.folds[this.foldix]; // active fold\r\n      var dataix = fold.train_ix[randi(0, fold.train_ix.length)];\r\n      for(var k=0;k<this.candidates.length;k++) {\r\n        var x = this.data[dataix];\r\n        var l = this.labels[dataix];\r\n        this.candidates[k].trainer.train(x, l);\r\n      }\r\n\r\n      // process consequences: sample new folds, or candidates\r\n      var lastiter = this.num_epochs * fold.train_ix.length;\r\n      if(this.iter >= lastiter) {\r\n        // finished evaluation of this fold. Get final validation\r\n        // accuracies, record them, and go on to next fold.\r\n        var val_acc = this.evalValErrors();\r\n        for(var k=0;k<this.candidates.length;k++) {\r\n          var c = this.candidates[k];\r\n          c.acc.push(val_acc[k]);\r\n          c.accv += val_acc[k];\r\n        }\r\n        this.iter = 0; // reset step number\r\n        this.foldix++; // increment fold\r\n\r\n        if(this.finish_fold_callback !== null) {\r\n          this.finish_fold_callback();\r\n        }\r\n\r\n        if(this.foldix >= this.folds.length) {\r\n          // we finished all folds as well! Record these candidates\r\n          // and sample new ones to evaluate.\r\n          for(var k=0;k<this.candidates.length;k++) {\r\n            this.evaluated_candidates.push(this.candidates[k]);\r\n          }\r\n          // sort evaluated candidates according to accuracy achieved\r\n          this.evaluated_candidates.sort(function(a, b) { \r\n            return (a.accv / a.acc.length) \r\n                 > (b.accv / b.acc.length) \r\n                 ? -1 : 1;\r\n          });\r\n          // and clip only to the top few ones (lets place limit at 3*ensemble_size)\r\n          // otherwise there are concerns with keeping these all in memory \r\n          // if MagicNet is being evaluated for a very long time\r\n          if(this.evaluated_candidates.length > 3 * this.ensemble_size) {\r\n            this.evaluated_candidates = this.evaluated_candidates.slice(0, 3 * this.ensemble_size);\r\n          }\r\n          if(this.finish_batch_callback !== null) {\r\n            this.finish_batch_callback();\r\n          }\r\n          this.sampleCandidates(); // begin with new candidates\r\n          this.foldix = 0; // reset this\r\n        } else {\r\n          // we will go on to another fold. reset all candidates nets\r\n          for(var k=0;k<this.candidates.length;k++) {\r\n            var c = this.candidates[k];\r\n            var net = new Net();\r\n            net.makeLayers(c.layer_defs);\r\n            var trainer = new Trainer(net, c.trainer_def);\r\n            c.net = net;\r\n            c.trainer = trainer;\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    evalValErrors: function() {\r\n      // evaluate candidates on validation data and return performance of current networks\r\n      // as simple list\r\n      var vals = [];\r\n      var fold = this.folds[this.foldix]; // active fold\r\n      for(var k=0;k<this.candidates.length;k++) {\r\n        var net = this.candidates[k].net;\r\n        var v = 0.0;\r\n        for(var q=0;q<fold.test_ix.length;q++) {\r\n          var x = this.data[fold.test_ix[q]];\r\n          var l = this.labels[fold.test_ix[q]];\r\n          net.forward(x);\r\n          var yhat = net.getPrediction();\r\n          v += (yhat === l ? 1.0 : 0.0); // 0 1 loss\r\n        }\r\n        v /= fold.test_ix.length; // normalize\r\n        vals.push(v);\r\n      }\r\n      return vals;\r\n    },\r\n\r\n    // returns prediction scores for given test data point, as Vol\r\n    // uses an averaged prediction from the best ensemble_size models\r\n    // x is a Vol.\r\n    predict_soft: function(data) {\r\n      // forward prop the best networks\r\n      // and accumulate probabilities at last layer into a an output Vol\r\n\r\n      var eval_candidates = [];\r\n      var nv = 0;\r\n      if(this.evaluated_candidates.length === 0) {\r\n        // not sure what to do here, first batch of nets hasnt evaluated yet\r\n        // lets just predict with current candidates.\r\n        nv = this.candidates.length;\r\n        eval_candidates = this.candidates;\r\n      } else {\r\n        // forward prop the best networks from evaluated_candidates\r\n        nv = Math.min(this.ensemble_size, this.evaluated_candidates.length);\r\n        eval_candidates = this.evaluated_candidates\r\n      }\r\n\r\n      // forward nets of all candidates and average the predictions\r\n      var xout, n;\r\n      for(var j=0;j<nv;j++) {\r\n        var net = eval_candidates[j].net;\r\n        var x = net.forward(data);\r\n        if(j===0) { \r\n          xout = x; \r\n          n = x.w.length; \r\n        } else {\r\n          // add it on\r\n          for(var d=0;d<n;d++) {\r\n            xout.w[d] += x.w[d];\r\n          }\r\n        }\r\n      }\r\n      // produce average\r\n      for(var d=0;d<n;d++) {\r\n        xout.w[d] /= nv;\r\n      }\r\n      return xout;\r\n    },\r\n\r\n    predict: function(data) {\r\n      var xout = this.predict_soft(data);\r\n      if(xout.w.length !== 0) {\r\n        var stats = maxmin(xout.w);\r\n        var predicted_label = stats.maxi; \r\n      } else {\r\n        var predicted_label = -1; // error out\r\n      }\r\n      return predicted_label;\r\n\r\n    },\r\n\r\n    toJSON: function() {\r\n      // dump the top ensemble_size networks as a list\r\n      var nv = Math.min(this.ensemble_size, this.evaluated_candidates.length);\r\n      var json = {};\r\n      json.nets = [];\r\n      for(var i=0;i<nv;i++) {\r\n        json.nets.push(this.evaluated_candidates[i].net.toJSON());\r\n      }\r\n      return json;\r\n    },\r\n\r\n    fromJSON: function(json) {\r\n      this.ensemble_size = json.nets.length;\r\n      this.evaluated_candidates = [];\r\n      for(var i=0;i<this.ensemble_size;i++) {\r\n        var net = new Net();\r\n        net.fromJSON(json.nets[i]);\r\n        var dummy_candidate = {};\r\n        dummy_candidate.net = net;\r\n        this.evaluated_candidates.push(dummy_candidate);\r\n      }\r\n    },\r\n\r\n    // callback functions\r\n    // called when a fold is finished, while evaluating a batch\r\n    onFinishFold: function(f) { this.finish_fold_callback = f; },\r\n    // called when a batch of candidates has finished evaluating\r\n    onFinishBatch: function(f) { this.finish_batch_callback = f; }\r\n    \r\n  };\r\n\r\n  global.MagicNet = MagicNet;\r\n})(convnetjs);\r\n(function(lib) {\r\n  \"use strict\";\r\n  if (typeof module === \"undefined\" || typeof module.exports === \"undefined\") {\r\n    window.convnetjs = lib; // in ordinary browser attach library to window\r\n  } else {\r\n    module.exports = lib; // in nodejs\r\n  }\r\n})(convnetjs);\r\n/* eslint-enable no-unused-vars */\r\n/* eslint-eisable no-redeclare */"],"mappings":"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","ignoreList":[]}]}